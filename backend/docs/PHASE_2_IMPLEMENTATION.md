# Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Phase 2 - ML Service, Risk Management, WebSocket, Trading Cycle

## Ğ’ĞµÑ€ÑĞ¸Ñ: v0.1.22

## Ğ”Ğ°Ñ‚Ğ°: 2025-11-13

---

## ğŸ“‹ Ğ§Ñ‚Ğ¾ Ğ±Ñ‹Ğ»Ğ¾ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¾

### 1. âœ… ML Service Integration

**Ğ¤Ğ°Ğ¹Ğ»:** `backend/src/services/mlService.ts`

**ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:** HTTP-ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ´Ğ»Ñ Ğ²Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ Ñ Python ML microservice

**ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸:**
- `checkHealth()` - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚Ğ¸ ML Service
- `predict(features, ohlcv)` - ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ğ° Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ğ¿Ñ€Ğ¸Ğ·Ğ½Ğ°ĞºĞ¾Ğ²
- `prepareFeatures(ohlcv)` - ĞŸĞ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ° Ğ¿Ñ€Ğ¸Ğ·Ğ½Ğ°ĞºĞ¾Ğ² Ğ¸Ğ· OHLCV Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- `isServiceAvailable()` - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ

**Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Trading Bot:**
```typescript
// Ğ’ executeTradingCycle():
if (this.mlService.isServiceAvailable()) {
  const features = this.mlService.prepareFeatures(ohlcv);
  mlSignal = await this.mlService.predict(features, ohlcv);
}
```

**ĞšĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ²:**
- Ğ•ÑĞ»Ğ¸ EMA Ğ¸ ML ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ñ‹ ÑĞ¾Ğ²Ğ¿Ğ°Ğ´Ğ°ÑÑ‚ â†’ ÑƒÑÑ€ĞµĞ´Ğ½ÑĞµĞ¼ confidence
- Ğ•ÑĞ»Ğ¸ Ğ¿Ñ€Ğ¾Ñ‚Ğ¸Ğ²Ğ¾Ñ€ĞµÑ‡Ğ°Ñ‚ â†’ Ğ±ĞµÑ€ĞµĞ¼ ÑĞ¸Ğ³Ğ½Ğ°Ğ» Ñ Ğ±Ğ¾Ğ»ÑŒÑˆĞµĞ¹ ÑƒĞ²ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒÑ, ÑĞ½Ğ¸Ğ¶Ğ°Ñ confidence Ğ½Ğ° 30%

---

### 2. âœ… Risk Management

**Ğ¤Ğ°Ğ¹Ğ»:** `backend/src/core/riskManager.ts`

**ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:** ĞŸĞ¾Ğ»Ğ½Ğ¾Ñ†ĞµĞ½Ğ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ñ€Ğ¸ÑĞºĞ°Ğ¼Ğ¸

**ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸:**

#### Position Sizing
```typescript
calculatePositionSize(balance, price, side)
```
- Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸ ĞºĞ°Ğº % Ğ¾Ñ‚ Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ° (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ 10%)
- ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµÑ‚ Stop Loss (-2%) Ğ¸ Take Profit (+5%)
- Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ğ² USDT Ğ¸ Ğ² Ğ²Ğ°Ğ»ÑÑ‚Ğµ Ñ‚Ğ¾Ñ€Ğ³Ğ¾Ğ²Ğ»Ğ¸

#### Trade Limits
```typescript
canOpenTrade()
```
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ´Ğ½ĞµĞ²Ğ½Ğ¾Ğ¹ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ ÑĞ´ĞµĞ»Ğ¾Ğº (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ 10)
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ» Ğ¼ĞµĞ¶Ğ´Ñƒ ÑĞ´ĞµĞ»ĞºĞ°Ğ¼Ğ¸ (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚)
- Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ `{ allowed: boolean, reason?: string }`

#### Stop Loss / Take Profit
```typescript
shouldClosePosition(entryPrice, currentPrice, side, stopLoss, takeProfit)
```
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ Stop Loss Ğ¸Ğ»Ğ¸ Take Profit
- Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ğ´Ğ»Ñ Long Ğ¸ Short Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¹
- Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ `{ shouldClose: boolean, reason?: string }`

#### P&L Calculation
```typescript
calculateProfitLoss(entryPrice, currentPrice, amount, side)
```
- Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»ÑŒ/ÑƒĞ±Ñ‹Ñ‚Ğ¾Ğº Ğ² USD Ğ¸ Ğ¿Ñ€Ğ¾Ñ†ĞµĞ½Ñ‚Ğ°Ñ…
- ĞšĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Long Ğ¸ Short Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸

**ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ:**
```typescript
new RiskManager({
  maxPositionPercent: 10,      // ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ 10% Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ° Ğ½Ğ° Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ
  stopLossPercent: 2,          // Stop Loss Ğ½Ğ° -2%
  takeProfitPercent: 5,        // Take Profit Ğ½Ğ° +5%
  maxDailyTrades: 10,          // ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ 10 ÑĞ´ĞµĞ»Ğ¾Ğº Ğ² Ğ´ĞµĞ½ÑŒ
  minTradeInterval: 300        // ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ğ¼ĞµĞ¶Ğ´Ñƒ ÑĞ´ĞµĞ»ĞºĞ°Ğ¼Ğ¸
});
```

---

### 3. âœ… Full Trading Cycle

**Ğ¤Ğ°Ğ¹Ğ»:** `backend/src/core/bot.ts`

**ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:** ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ñ†Ğ¸ĞºĞ» Ñ‚Ğ¾Ñ€Ğ³Ğ¾Ğ²Ğ»Ğ¸

#### Ğ¦Ğ¸ĞºĞ» Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ÑÑ ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 30 ÑĞµĞºÑƒĞ½Ğ´:
```typescript
private runTradingLoop(): void {
  this.tradingLoopInterval = setInterval(async () => {
    await this.executeTradingCycle();
  }, 30000);
}
```

#### Ğ­Ñ‚Ğ°Ğ¿Ñ‹ Ñ‚Ğ¾Ñ€Ğ³Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ñ†Ğ¸ĞºĞ»Ğ°:

**1. ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…**
- Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ñ†ĞµĞ½Ğ° Ñ‡ĞµÑ€ĞµĞ· `getTicker()`
- OHLCV Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ·Ğ° 100 ÑĞ²ĞµÑ‡ĞµĞ¹ Ñ‡ĞµÑ€ĞµĞ· `getOHLCV()`

**2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ñ… Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¹**
- Ğ•ÑĞ»Ğ¸ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ° â†’ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Stop Loss / Take Profit
- ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ P&L
- Ğ—Ğ°ĞºÑ€Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¸ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¸ SL/TP

**3. ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ñ€Ñ‹Ğ½ĞºĞ° (ĞµÑĞ»Ğ¸ Ğ½ĞµÑ‚ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ñ… Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¹)**
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ‚Ğ¾Ñ€Ğ³Ğ¾Ğ²Ğ»Ğ¸ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ğ°/Ğ²Ñ‹ĞºĞ»ÑÑ‡ĞµĞ½Ğ°
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ»Ğ¸ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ½Ğ¾Ğ²ÑƒÑ ÑĞ´ĞµĞ»ĞºÑƒ (Risk Manager)
- EMA Strategy Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· â†’ ÑĞ¸Ğ³Ğ½Ğ°Ğ» + confidence
- ML Service Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· (ĞµÑĞ»Ğ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½) â†’ ÑĞ¸Ğ³Ğ½Ğ°Ğ» + confidence
- ĞšĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ²

**4. ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸**
- Ğ•ÑĞ»Ğ¸ Ñ„Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¸Ğ³Ğ½Ğ°Ğ» BUY/SELL Ñ confidence > 60%
- ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ°
- Ğ Ğ°ÑÑ‡ĞµÑ‚ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ° Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸ Ñ‡ĞµÑ€ĞµĞ· Risk Manager
- Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¾Ñ€Ğ´ĞµÑ€Ğ° (Ğ·Ğ°ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾ Ğ´Ğ»Ñ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸)
- Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸ Ñ SL/TP
- Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ ÑĞ´ĞµĞ»ĞºĞ¸ Ğ² Risk Manager

**5. Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸**
- Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸Ñ‡Ğ¸Ğ½Ñ‹ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ñ
- Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ñ‚Ğ¸Ğ²Ğ¾Ğ¿Ğ¾Ğ»Ğ¾Ğ¶Ğ½Ğ¾Ğ³Ğ¾ Ğ¾Ñ€Ğ´ĞµÑ€Ğ° (Ğ·Ğ°ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾)
- ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸

**ĞœĞµÑ‚Ğ¾Ğ´Ñ‹:**
- `executeTradingCycle()` - Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ñ†Ğ¸ĞºĞ»
- `combineSignals(ema, ml)` - ĞºĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ²
- `openPosition(side, price, reason)` - Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸
- `checkPositionExit(price)` - Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ°
- `closePosition(reason)` - Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸

---

### 4. âœ… WebSocket Broadcasting

**Ğ¤Ğ°Ğ¹Ğ»:** `backend/src/index.ts`

**ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:** Real-time Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´Ğ°

**Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ:**

#### `status` (ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 5 ÑĞµĞºÑƒĞ½Ğ´)
```typescript
{
  bot: { isRunning, tradingEnabled, strategy },
  exchange: { connected, testnet },
  balance: { total, available, used },
  positions: { current, total, profit },
  uptime,
  timestamp
}
```

#### `market` (ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 10 ÑĞµĞºÑƒĞ½Ğ´)
```typescript
{
  symbol,
  price,
  change24h,
  changePercent24h,
  volume,
  high24h,
  low24h,
  bid,
  ask,
  timestamp
}
```

#### ĞŸÑ€Ğ¸ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°:
- ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ÑÑ Ğ½Ğ°Ñ‡Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ±Ğ¾Ñ‚Ğ°

**Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ broadcasting:**
```typescript
function startWebSocketBroadcasting() {
  // Status ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 5 ÑĞµĞº
  setInterval(async () => {
    const status = await tradingBot.getStatus();
    io.emit('status', status);
  }, 5000);

  // Market data ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 10 ÑĞµĞº
  setInterval(async () => {
    const marketData = await tradingBot.getMarketData();
    io.emit('market', marketData);
  }, 10000);
}
```

---

## ğŸ§ª Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

**Ğ¤Ğ°Ğ¹Ğ»:** `backend/tests/integration.test.ts`

**ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ:** `backend/jest.config.js`

### Ğ—Ğ°Ğ¿ÑƒÑĞº Ñ‚ĞµÑÑ‚Ğ¾Ğ²:
```bash
cd backend
npm test
```

### Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹:
```
âœ“ Bot should initialize correctly (43 ms)
âœ“ Bot should have all required methods (20 ms)
âœ“ Bot should enable/disable trading (27 ms)
âœ“ Bot should return null position when no trades (23 ms)
âœ“ Bot should update configuration (17 ms)
âœ“ Bot uptime should increase (1124 ms)
âœ“ Risk Manager should be initialized in Bot (13 ms)

Test Suites: 1 passed, 1 total
Tests: 3 skipped, 7 passed, 10 total
```

**ĞŸÑ€Ğ¾Ğ¿ÑƒÑ‰ĞµĞ½Ğ½Ñ‹Ğµ Ñ‚ĞµÑÑ‚Ñ‹** (Ñ‚Ñ€ĞµĞ±ÑƒÑÑ‚ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğº Ğ±Ğ¸Ñ€Ğ¶Ğµ):
- Bot should start and connect to exchange
- Bot should get market data
- Bot should get status

---

## ğŸ“Š ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Frontend (React)                â”‚
â”‚         WebSocket Client                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ Socket.io Events
               â”‚ (status, market)
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Backend (Express + Socket.io)      â”‚
â”‚       - WebSocket Broadcasting           â”‚
â”‚       - REST API                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Trading Bot Manager              â”‚
â”‚  - runTradingLoop() [30s interval]       â”‚
â”‚  - executeTradingCycle()                 â”‚
â”‚  - openPosition() / closePosition()      â”‚
â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
  â”‚          â”‚          â”‚              â”‚
  â†“          â†“          â†“              â†“
â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EMA â”‚  â”‚  ML  â”‚  â”‚   Risk   â”‚  â”‚Exchangeâ”‚
â”‚ Str â”‚  â”‚Serviceâ”‚ â”‚ Manager  â”‚  â”‚Manager â”‚
â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                        â”‚
             â†“                        â†“
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Flask   â”‚            â”‚  KuCoin  â”‚
      â”‚ML Serviceâ”‚            â”‚   API    â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

### Ğ ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¾Ñ€Ğ´ĞµÑ€Ğ° ĞĞ¢ĞšĞ›Ğ®Ğ§Ğ•ĞĞ«
Ğ’ÑĞµ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ñ‹ `createMarketOrder()` Ğ·Ğ°ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹:

```typescript
// Ğ’ĞĞ–ĞĞ: Ğ’ production Ğ·Ğ´ĞµÑÑŒ ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ÑÑ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ñ€Ğ´ĞµÑ€
// const order = await this.exchange.createMarketOrder(
//   this.config.symbol,
//   side,
//   tradeSize.amountInCurrency
// );
```

### Ğ”Ğ»Ñ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ñ‚Ğ¾Ñ€Ğ³Ğ¾Ğ²Ğ»Ğ¸:
1. Ğ Ğ°ÑĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ñ‹ `createMarketOrder()` Ğ² `openPosition()` Ğ¸ `closePosition()`
2. Ğ£Ğ±ĞµĞ´Ğ¸Ñ‚ÑŒÑÑ, Ñ‡Ñ‚Ğ¾ KuCoin API credentials Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ
3. Ğ¢Ñ‰Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ¿Ñ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ½Ğ° testnet
4. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ°Ğ´ĞµĞºĞ²Ğ°Ñ‚Ğ½Ñ‹Ğµ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹ Ğ² Risk Manager

---

## ğŸš€ Ğ—Ğ°Ğ¿ÑƒÑĞº

### 1. Backend Ñ Trading Bot:
```bash
cd backend
npm run dev
```

### 2. ML Service (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾):
```bash
cd ml-service
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
python app.py
```

### 3. Frontend:
```bash
cd frontend
npm run dev
```

---

## ğŸ“ ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ

**Backend `.env`:**
```env
# KuCoin API
KUCOIN_API_KEY=your_api_key
KUCOIN_API_SECRET=your_api_secret
KUCOIN_API_PASSPHRASE=your_passphrase
KUCOIN_TESTNET=true

# Trading
TRADING_SYMBOL=BTC/USDT
TRADING_TIMEFRAME=1h

# ML Service
ML_SERVICE_URL=http://localhost:5000

# Server
PORT=3000
NODE_ENV=development
```

---

## âš¡ ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

### Ğ¢Ğ¾Ñ€Ğ³Ğ¾Ğ²Ñ‹Ğ¹ Ñ†Ğ¸ĞºĞ»: 30 ÑĞµĞºÑƒĞ½Ğ´
- Ğ”Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾ Ğ´Ğ»Ñ Ñ€ĞµĞ°ĞºÑ†Ğ¸Ğ¸ Ğ½Ğ° Ñ€Ñ‹Ğ½Ğ¾Ğº
- ĞĞµ Ğ¿ĞµÑ€ĞµĞ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ API Ğ±Ğ¸Ñ€Ğ¶Ğ¸
- ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¹ Ğ½Ğ° 1h timeframe

### WebSocket: 5-10 ÑĞµĞºÑƒĞ½Ğ´
- Status: 5 ÑĞµĞº (ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ Ğ´Ğ»Ñ UI)
- Market: 10 ÑĞµĞº (Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°)

### Risk Management:
- Ğ›Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹ Ğ¿Ñ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰Ğ°ÑÑ‚ overtrading
- Position sizing Ğ·Ğ°Ñ‰Ğ¸Ñ‰Ğ°ĞµÑ‚ ĞºĞ°Ğ¿Ğ¸Ñ‚Ğ°Ğ»
- SL/TP Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ¸Ñ€ÑƒÑÑ‚ Ğ²Ñ‹Ñ…Ğ¾Ğ´

---

## ğŸ”§ Ğ”Ğ°Ğ»ÑŒĞ½ĞµĞ¹ÑˆĞ¸Ğµ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ

1. **Backtesting**
   - Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¹
   - ĞÑ†ĞµĞ½ĞºĞ° ÑÑ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ ĞºĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ°Ñ†Ğ¸Ğ¸ EMA + ML

2. **ĞœĞ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ€Ñ‹**
   - Ğ¢Ğ¾Ñ€Ğ³Ğ¾Ğ²Ğ»Ñ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ğ¼Ğ¸ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ°Ğ¼Ğ¸ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾
   - Ğ”Ğ¸Ğ²ĞµÑ€ÑĞ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ñ€Ğ¸ÑĞºĞ¾Ğ²

3. **Advanced ML**
   - LSTM/GRU Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ´Ğ»Ñ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ñ€ÑĞ´Ğ¾Ğ²
   - Feature engineering (RSI, MACD, Bollinger)
   - ĞĞ½ÑĞ°Ğ¼Ğ±Ğ»ÑŒ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹

4. **Notifications**
   - Telegram ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ¾ ÑĞ´ĞµĞ»ĞºĞ°Ñ…
   - Email alerts Ğ´Ğ»Ñ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹

5. **Analytics Dashboard**
   - Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ ÑĞ´ĞµĞ»Ğ¾Ğº
   - Ğ“Ñ€Ğ°Ñ„Ğ¸Ğº P&L
   - ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ ÑÑ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ (Sharpe Ratio, Win Rate)

---

## âœ… Checklist Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ñ Phase 2

- [x] ML Service HTTP client Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½
- [x] Risk Manager Ñ position sizing Ğ¸ SL/TP
- [x] Ğ¢Ğ¾Ñ€Ğ³Ğ¾Ğ²Ñ‹Ğ¹ Ñ†Ğ¸ĞºĞ» Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¼Ğ¸ ÑĞ´ĞµĞ»ĞºĞ°Ğ¼Ğ¸
- [x] WebSocket broadcasting (status, market)
- [x] ĞšĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ EMA + ML ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ²
- [x] Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ Ñ‚ĞµÑÑ‚Ñ‹ (7/10 passed)
- [x] Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ

---

## ğŸ¯ Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

**Backend MVP:** âœ… Ğ“Ğ¾Ñ‚Ğ¾Ğ² Ğº Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° testnet

**Frontend:** â³ Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ WebSocket ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°

**ML Service:** â³ Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ RandomForest

**Deployment:** â³ Docker Compose Ğ³Ğ¾Ñ‚Ğ¾Ğ², Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° CI/CD
