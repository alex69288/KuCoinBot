<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }

    .card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    h1 {
      color: #333;
      margin-bottom: 20px;
    }

    .btn {
      padding: 12px 24px;
      margin: 10px 5px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.2s;
    }

    .btn:hover {
      opacity: 0.8;
    }

    .btn-start {
      background: #4CAF50;
      color: white;
    }

    .btn-stop {
      background: #f44336;
      color: white;
    }

    .btn-test {
      background: #2196F3;
      color: white;
    }

    .result {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      background: #e3f2fd;
      color: #1565c0;
    }

    .error {
      background: #ffebee;
      color: #c62828;
    }

    .success {
      background: #e8f5e9;
      color: #2e7d32;
    }
  </style>
</head>

<body>
  <div class="card">
    <h1>üß™ –¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫ Web App</h1>
    <p>–≠—Ç–æ—Ç —Ñ–∞–π–ª —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å Telegram Web App API.</p>

    <div>
      <button class="btn btn-test" onclick="testOldMethod()">–°—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥ (showAlert - –æ—à–∏–±–∫–∞)</button>
      <button class="btn btn-test" onclick="testNewMethod()">–ù–æ–≤—ã–π –º–µ—Ç–æ–¥ (showPopup - –ø—Ä–∞–≤–∏–ª—å–Ω–æ)</button>
    </div>

    <div>
      <button class="btn btn-start" onclick="testStartBot()">–¢–µ—Å—Ç: –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞</button>
      <button class="btn btn-stop" onclick="testStopBot()">–¢–µ—Å—Ç: –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞</button>
    </div>

    <div id="result"></div>
  </div>

  <div class="card">
    <h2>üìã –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
    <p><strong>–ü—Ä–æ–±–ª–µ–º–∞:</strong> –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ <code>tg.showAlert(message)</code> –≤—ã–∑—ã–≤–∞–ª–æ –æ—à–∏–±–∫—É
      <code>WebAppPopupParamInvalid</code></p>
    <p><strong>–†–µ—à–µ–Ω–∏–µ:</strong> –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ <code>tg.showPopup({ title, message, buttons })</code> —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏
      –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏</p>
    <p><strong>–§–æ—Ä–º–∞—Ç showPopup:</strong></p>
    <pre>tg.showPopup({
  title: '–ó–∞–≥–æ–ª–æ–≤–æ–∫',
  message: '–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è',
  buttons: [{ type: 'ok' }]
});</pre>
  </div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    const tg = window.Telegram?.WebApp || {
      showAlert: (msg) => alert(`showAlert: ${msg}`),
      showPopup: (params) => alert(`showPopup: ${params.title}\n${params.message}`)
    };

    function showResult(message, isError = false) {
      const resultDiv = document.getElementById('result');
      resultDiv.className = 'result ' + (isError ? 'error' : 'success');
      resultDiv.innerHTML = `<strong>${isError ? '‚ùå –û—à–∏–±–∫–∞:' : '‚úÖ –£—Å–ø–µ—à–Ω–æ:'}</strong> ${message}`;
    }

    // –°—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥ (–≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É)
    function testOldMethod() {
      try {
        tg.showAlert('–≠—Ç–æ –≤—ã–∑–æ–≤–µ—Ç –æ—à–∏–±–∫—É WebAppPopupParamInvalid');
        showResult('showAlert –≤—ã–∑–≤–∞–Ω, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—à–∏–±–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º Telegram');
      } catch (error) {
        showResult(`–û—à–∏–±–∫–∞: ${error.message}`, true);
      }
    }

    // –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π)
    function testNewMethod() {
      try {
        tg.showPopup({
          title: '–¢–µ—Å—Ç',
          message: '–≠—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π!',
          buttons: [{ type: 'ok' }]
        });
        showResult('showPopup –≤—ã–∑–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ!');
      } catch (error) {
        showResult(`–û—à–∏–±–∫–∞: ${error.message}`, true);
      }
    }

    // –¢–µ—Å—Ç –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞
    async function testStartBot() {
      try {
        showResult('–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞...');
        const response = await fetch('/api/bot/start', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ init_data: 'test' })
        });

        const result = await response.json();

        tg.showPopup({
          title: '–ë–æ—Ç',
          message: result.message || '–ì–æ—Ç–æ–≤–æ',
          buttons: [{ type: 'ok' }]
        });

        showResult(`–û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω: ${result.message}`);
      } catch (error) {
        tg.showPopup({
          title: '–û—à–∏–±–∫–∞',
          message: error.message || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞',
          buttons: [{ type: 'ok' }]
        });
        showResult(`–û—à–∏–±–∫–∞: ${error.message}`, true);
      }
    }

    // –¢–µ—Å—Ç –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–æ—Ç–∞
    async function testStopBot() {
      try {
        showResult('–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫—É –±–æ—Ç–∞...');
        const response = await fetch('/api/bot/stop', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ init_data: 'test' })
        });

        const result = await response.json();

        tg.showPopup({
          title: '–ë–æ—Ç',
          message: result.message || '–ì–æ—Ç–æ–≤–æ',
          buttons: [{ type: 'ok' }]
        });

        showResult(`–û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω: ${result.message}`);
      } catch (error) {
        tg.showPopup({
          title: '–û—à–∏–±–∫–∞',
          message: error.message || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞',
          buttons: [{ type: 'ok' }]
        });
        showResult(`–û—à–∏–±–∫–∞: ${error.message}`, true);
      }
    }

    // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.addEventListener('load', () => {
      showResult('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ú–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫–∏.', false);
    });
  </script>
</body>

</html>