"""
–¢–µ—Å—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
"""
import time
import json
from pathlib import Path

def test_html_file_exists():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ HTML —Ñ–∞–π–ª–∞"""
    html_path = Path(__file__).parent.parent / "webapp" / "static" / "index.html"
    assert html_path.exists(), "–§–∞–π–ª index.html –Ω–µ –Ω–∞–π–¥–µ–Ω"
    print("‚úÖ HTML —Ñ–∞–π–ª –Ω–∞–π–¥–µ–Ω")

def test_loading_overlay_added():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏"""
    html_path = Path(__file__).parent.parent / "webapp" / "static" / "index.html"
    content = html_path.read_text(encoding='utf-8')
    
    assert 'loading-overlay' in content, "–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω"
    assert 'loading-spinner' in content, "–°–ø–∏–Ω–Ω–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω"
    assert 'loading-text' in content, "–¢–µ–∫—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω"
    print("‚úÖ –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω")

def test_update_interval_increased():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —É–≤–µ–ª–∏—á–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è"""
    html_path = Path(__file__).parent.parent / "webapp" / "static" / "index.html"
    content = html_path.read_text(encoding='utf-8')
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ 1000–º—Å –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    assert 'updateIntervalMs = 5000' in content, "–ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ 5000–º—Å"
    assert ', 1000); // –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è' not in content, "–°—Ç–∞—Ä—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª 1 —Å–µ–∫—É–Ω–¥–∞ –≤—Å–µ –µ—â–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç"
    print("‚úÖ –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —É–≤–µ–ª–∏—á–µ–Ω –¥–æ 5 —Å–µ–∫—É–Ω–¥")

def test_slow_connection_mode_added():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ –º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è"""
    html_path = Path(__file__).parent.parent / "webapp" / "static" / "index.html"
    content = html_path.read_text(encoding='utf-8')
    
    assert 'slowConnectionMode' in content, "–†–µ–∂–∏–º –º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω"
    assert 'checkConnectionSpeed' in content, "–§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞"
    assert 'updateIntervalMs = 10000' in content, "–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –¥–æ 10 —Å–µ–∫ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ"
    print("‚úÖ –†–µ–∂–∏–º –º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –¥–æ–±–∞–≤–ª–µ–Ω")

def test_lazy_loading_implemented():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏"""
    html_path = Path(__file__).parent.parent / "webapp" / "static" / "index.html"
    content = html_path.read_text(encoding='utf-8')
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ loadData –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    assert 'await loadStatus()' in content, "loadStatus –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è"
    assert 'await loadMarket()' in content, "loadMarket –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è"
    print("‚úÖ –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞")

def test_timeout_handling_added():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–∞–π–º–∞—É—Ç–æ–≤"""
    html_path = Path(__file__).parent.parent / "webapp" / "static" / "index.html"
    content = html_path.read_text(encoding='utf-8')
    
    assert 'Promise.race' in content, "Promise.race –¥–ª—è —Ç–∞–π–º–∞—É—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω"
    assert 'setTimeout(() => reject(new Error' in content, "–¢–∞–π–º–∞—É—Ç –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω"
    assert 'hideLoadingOverlay' in content, "–§—É–Ω–∫—Ü–∏—è —Å–∫—Ä—ã—Ç–∏—è –æ–≤–µ—Ä–ª–µ—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
    print("‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤ –¥–æ–±–∞–≤–ª–µ–Ω–∞")

def test_performance_metrics():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"""
    print("\nüìä –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:")
    print("   –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:")
    print("   - –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: 1 —Å–µ–∫")
    print("   - –ó–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É: 60")
    print("   - –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏: –ù–µ—Ç")
    print("")
    print("   –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:")
    print("   - –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: 5 —Å–µ–∫ (—Ä–µ–∂–∏–º —ç–∫–æ–Ω–æ–º–∏–∏: 10 —Å–µ–∫)")
    print("   - –ó–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É: 12 (—Ä–µ–∂–∏–º —ç–∫–æ–Ω–æ–º–∏–∏: 6)")
    print("   - –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏: –î–∞ ‚úÖ")
    print("   - –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—é: –î–∞ ‚úÖ")
    print("   - –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞: –î–∞ ‚úÖ")
    print("")
    print("‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: ~80% —Å–Ω–∏–∂–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤")

def run_all_tests():
    """–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤"""
    print("\n" + "="*60)
    print("üöÄ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò")
    print("="*60 + "\n")
    
    tests = [
        ("–ü—Ä–æ–≤–µ—Ä–∫–∞ HTML —Ñ–∞–π–ª–∞", test_html_file_exists),
        ("–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏", test_loading_overlay_added),
        ("–ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è", test_update_interval_increased),
        ("–†–µ–∂–∏–º –º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è", test_slow_connection_mode_added),
        ("–õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞", test_lazy_loading_implemented),
        ("–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤", test_timeout_handling_added),
        ("–ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏", test_performance_metrics),
    ]
    
    passed = 0
    failed = 0
    
    for test_name, test_func in tests:
        try:
            print(f"\nüìù {test_name}...")
            test_func()
            passed += 1
        except AssertionError as e:
            print(f"‚ùå –û–®–ò–ë–ö–ê: {e}")
            failed += 1
        except Exception as e:
            print(f"‚ùå –ù–ï–û–ñ–ò–î–ê–ù–ù–ê–Ø –û–®–ò–ë–ö–ê: {e}")
            failed += 1
    
    print("\n" + "="*60)
    print(f"‚úÖ –ü—Ä–æ–π–¥–µ–Ω–æ: {passed}")
    print(f"‚ùå –ü—Ä–æ–≤–∞–ª–µ–Ω–æ: {failed}")
    print("="*60 + "\n")
    
    if failed == 0:
        print("üéâ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´ –£–°–ü–ï–®–ù–û!")
        print("\nüìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:")
        print("1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ")
        print("2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É —Å –º–µ–¥–ª–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º (3G —Å–∏–º—É–ª—è—Ü–∏—è)")
        print("3. –ü—Ä–æ—Å–ª–µ–¥–∏—Ç–µ –∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ –æ —Ä–µ–∂–∏–º–µ —ç–∫–æ–Ω–æ–º–∏–∏")
        print("4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ")
        return True
    else:
        print("‚ö†Ô∏è –ù–ï–ö–û–¢–û–†–´–ï –¢–ï–°–¢–´ –ù–ï –ü–†–û–ô–î–ï–ù–´")
        return False

if __name__ == "__main__":
    success = run_all_tests()
    exit(0 if success else 1)
