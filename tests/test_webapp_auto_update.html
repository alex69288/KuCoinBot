<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–¢–µ—Å—Ç –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è WebApp</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #1a1a1a;
      color: #fff;
    }

    .test-card {
      background: #2a2a2a;
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
    }

    .test-title {
      font-size: 24px;
      margin-bottom: 20px;
      color: #4CAF50;
    }

    .counter {
      font-size: 48px;
      font-weight: bold;
      text-align: center;
      margin: 20px 0;
      color: #2196F3;
    }

    .log {
      background: #1a1a1a;
      padding: 15px;
      border-radius: 8px;
      max-height: 300px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 12px;
    }

    .log-entry {
      margin: 5px 0;
      padding: 5px;
      border-left: 3px solid #4CAF50;
      padding-left: 10px;
    }

    .status {
      display: inline-block;
      padding: 5px 15px;
      border-radius: 20px;
      margin: 10px 0;
    }

    .status.running {
      background: #4CAF50;
      color: white;
    }

    .status.stopped {
      background: #f44336;
      color: white;
    }

    button {
      padding: 10px 20px;
      margin: 5px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
    }

    .btn-start {
      background: #4CAF50;
      color: white;
    }

    .btn-stop {
      background: #f44336;
      color: white;
    }

    .btn-clear {
      background: #2196F3;
      color: white;
    }
  </style>
</head>

<body>
  <div class="test-card">
    <div class="test-title">üß™ –¢–µ—Å—Ç –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è WebApp</div>

    <div>
      <span class="status running" id="status">–†–∞–±–æ—Ç–∞–µ—Ç</span>
    </div>

    <div>
      <button class="btn-start" onclick="startTest()">‚ñ∂Ô∏è –°—Ç–∞—Ä—Ç</button>
      <button class="btn-stop" onclick="stopTest()">‚èπÔ∏è –°—Ç–æ–ø</button>
      <button class="btn-clear" onclick="clearLog()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
    </div>

    <div class="counter" id="counter">0</div>
    <div style="text-align: center; color: #888;">
      –°—á–µ—Ç—á–∏–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π (–∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É)
    </div>
  </div>

  <div class="test-card">
    <div class="test-title">üìã –õ–æ–≥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π</div>
    <div class="log" id="log"></div>
  </div>

  <div class="test-card">
    <div class="test-title">‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ—Å—Ç–µ</div>
    <div style="line-height: 1.8;">
      <strong>–ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:</strong> 1000 –º—Å (1 —Å–µ–∫—É–Ω–¥–∞)<br>
      <strong>–ù–∞—á–∞–ª–æ —Ç–µ—Å—Ç–∞:</strong> <span id="startTime">-</span><br>
      <strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</strong> <span id="lastUpdate">-</span><br>
      <strong>–í—Å–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:</strong> <span id="totalUpdates">0</span><br>
      <strong>–°—Ä–µ–¥–Ω–∏–π –∏–Ω—Ç–µ—Ä–≤–∞–ª:</strong> <span id="avgInterval">-</span>
    </div>
  </div>

  <script>
    let counter = 0;
    let updateInterval = null;
    let startTime = null;
    let lastUpdateTime = null;
    let intervals = [];

    function addLog(message) {
      const logDiv = document.getElementById('log');
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      const now = new Date();
      entry.textContent = `[${now.toLocaleTimeString()}.${now.getMilliseconds().toString().padStart(3, '0')}] ${message}`;
      logDiv.appendChild(entry);
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function updateCounter() {
      const now = Date.now();

      if (lastUpdateTime) {
        const interval = now - lastUpdateTime;
        intervals.push(interval);
        addLog(`–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ #${counter + 1} (–∏–Ω—Ç–µ—Ä–≤–∞–ª: ${interval} –º—Å)`);
      } else {
        addLog(`–ü–µ—Ä–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ`);
      }

      lastUpdateTime = now;
      counter++;
      document.getElementById('counter').textContent = counter;
      document.getElementById('lastUpdate').textContent = new Date(now).toLocaleTimeString();
      document.getElementById('totalUpdates').textContent = counter;

      if (intervals.length > 0) {
        const avg = intervals.reduce((a, b) => a + b, 0) / intervals.length;
        document.getElementById('avgInterval').textContent = `${avg.toFixed(2)} –º—Å`;
      }
    }

    function startTest() {
      if (updateInterval) {
        addLog('‚ö†Ô∏è –¢–µ—Å—Ç —É–∂–µ –∑–∞–ø—É—â–µ–Ω');
        return;
      }

      startTime = new Date();
      lastUpdateTime = null;
      document.getElementById('startTime').textContent = startTime.toLocaleTimeString();
      document.getElementById('status').textContent = '–†–∞–±–æ—Ç–∞–µ—Ç';
      document.getElementById('status').className = 'status running';

      addLog('‚úÖ –¢–µ—Å—Ç –∑–∞–ø—É—â–µ–Ω');

      // –ü–µ—Ä–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ä–∞–∑—É
      updateCounter();

      // –ó–∞—Ç–µ–º –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
      updateInterval = setInterval(() => {
        updateCounter();
      }, 1000);
    }

    function stopTest() {
      if (!updateInterval) {
        addLog('‚ö†Ô∏è –¢–µ—Å—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω');
        return;
      }

      clearInterval(updateInterval);
      updateInterval = null;

      document.getElementById('status').textContent = '–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω';
      document.getElementById('status').className = 'status stopped';

      addLog('‚èπÔ∏è –¢–µ—Å—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');

      if (intervals.length > 0) {
        const min = Math.min(...intervals);
        const max = Math.max(...intervals);
        const avg = intervals.reduce((a, b) => a + b, 0) / intervals.length;
        addLog(`üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: –ú–∏–Ω=${min}–º—Å, –ú–∞–∫—Å=${max}–º—Å, –°—Ä–µ–¥–Ω=${avg.toFixed(2)}–º—Å`);
      }
    }

    function clearLog() {
      document.getElementById('log').innerHTML = '';
      addLog('üóëÔ∏è –õ–æ–≥ –æ—á–∏—â–µ–Ω');
    }

    // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.addEventListener('load', () => {
      addLog('üîß –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
      startTest();
    });

    // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
    window.addEventListener('beforeunload', () => {
      if (updateInterval) {
        clearInterval(updateInterval);
      }
    });
  </script>
</body>

</html>