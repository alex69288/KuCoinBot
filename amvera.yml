# Конфигурация для деплоя KuCoin Bot на Amvera Cloud
# Документация: https://docs.amvera.ru/

meta:
  environment: nodejs
  toolchain:
    name: npm
    version: 20

build:
  # Команды для сборки проекта
  # Каждая команда выполняется из корня проекта
  args:
    - echo "=== Installing dependencies ==="
    - npm install --prefix backend
    - echo "=== Building TypeScript ==="
    - npm run build --prefix backend
    - echo "=== Checking build output ==="
    - ls -la backend/dist/ || echo "dist folder not found"
    - test -f backend/dist/index.js && echo "✓ index.js created successfully" || echo "✗ ERROR: index.js not found!"

run:
  # Запуск приложения из директории backend
  workdir: backend
  command: node dist/index.js
  # Монтирование данных для персистентности
  persistenceMount: /data
  # Порт контейнера
  containerPort: 3000

# Health check для проверки работоспособности
healthcheck:
  path: /health
  interval: 30
  timeout: 10
  retries: 3

# Переменные окружения устанавливаются в панели Amvera:
# - KUCOIN_API_KEY
# - KUCOIN_API_SECRET
# - KUCOIN_API_PASSPHRASE
# - KUCOIN_TESTNET=false
# - NODE_ENV=production
# - TELEGRAM_BOT_TOKEN
# - TELEGRAM_CHAT_ID
