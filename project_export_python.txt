üöÄ –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ô –≠–ö–°–ü–û–†–¢ –ü–†–û–ï–ö–¢–ê (PYTHON)
============================================================

üìÅ –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê:
==============================
üìÅ ./
üìÑ calculate_min_trade.py
üìÑ check_telegram.py
üìÑ check_trading.py
üìÑ debug_bot.py
üìÑ debug_trading.py
üìÑ main.py
üìÑ README.md
üìÑ requirements.txt
üìÑ telegram_fix.py
üìÑ test_trading_fix.py
üìÑ universal_export.py
üìÅ analytics/
  üìÑ metrics.py
  üìÑ reporter.py
  üìÑ __init__.py
üìÅ config/
  üìÑ constants.py
  üìÑ settings.py
  üìÑ __init__.py
üìÅ core/
  üìÑ bot.py
  üìÑ exchange.py
  üìÑ risk_manager.py
  üìÑ __init__.py
üìÅ ml/
  üìÑ features.py
  üìÑ model.py
  üìÑ __init__.py
üìÅ strategies/
  üìÑ base_strategy.py
  üìÑ bollinger.py
  üìÑ ema_ml.py
  üìÑ macd_rsi.py
  üìÑ price_action.py
  üìÑ __init__.py
üìÅ telegram/
  üìÑ bot.py
  üìÑ handlers.py
  üìÑ menus.py
  üìÑ __init__.py
üìÅ utils/
  üìÑ helpers.py
  üìÑ logger.py
  üìÑ __init__.py


============================================================
üìÑ –°–û–î–ï–†–ñ–ê–ù–ò–ï –§–ê–ô–õ–û–í:
============================================================

[FILE_NAME]: calculate_min_trade.py
[FILE_CONTENT_BEGIN]
"""
–†–ê–°–ß–ï–¢ –ú–ò–ù–ò–ú–ê–õ–¨–ù–´–• –°–¢–ê–í–û–ö –î–õ–Ø –¢–û–†–ì–û–í–´–• –ü–ê–†
"""
import sys
import os

sys.path.append(os.path.dirname(os.path.abspath(__file__)))

def calculate_min_trades():
    """–†–∞—Å—á–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫ –¥–ª—è –≤—Å–µ—Ö –ø–∞—Ä"""
    from core.exchange import ExchangeManager
    
    print("üí∞ –†–ê–°–ß–ï–¢ –ú–ò–ù–ò–ú–ê–õ–¨–ù–´–• –°–¢–ê–í–û–ö")
    print("=" * 60)
    
    exchange = ExchangeManager()
    
    if not exchange.connected:
        print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∏—Ä–∂–µ")
        return
    
    # üîß –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–ª—è KuCoin
    min_amounts = {
        'BTC/USDT': 0.00001,  # üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: 0.00001 BTC
        'ETH/USDT': 0.001,
        'SOL/USDT': 0.1,
        'ADA/USDT': 1.0,
        'DOT/USDT': 0.1,
        'LINK/USDT': 0.1
    }
    
    print("üìä –ú–ò–ù–ò–ú–ê–õ–¨–ù–´–ï –°–¢–ê–í–ö–ò –î–õ–Ø –¢–û–†–ì–û–í–õ–ò:")
    print("-" * 60)
    
    for symbol, min_amount in min_amounts.items():
        # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é —Ü–µ–Ω—É
        market_data = exchange.get_market_data(symbol)
        if market_data:
            current_price = market_data['current_price']
            min_usdt = min_amount * current_price
            
            print(f"üîπ {symbol}:")
            print(f"   –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: {min_amount} {symbol.split('/')[0]}")
            print(f"   –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞: {current_price:.2f} USDT")
            print(f"   –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞: {min_usdt:.4f} USDT")
            
            # –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä —Å—Ç–∞–≤–∫–∏ (–º–∏–Ω–∏–º—É–º + 10%)
            recommended_usdt = min_usdt * 1.1
            print(f"   –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ç–∞–≤–∫–∞: {recommended_usdt:.4f} USDT")
            print()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å
    balance = exchange.get_balance()
    if balance:
        print("üí∞ –í–ê–® –ë–ê–õ–ê–ù–°:")
        print(f"   USDT: {balance['free_usdt']:.2f} —Å–≤–æ–±–æ–¥–Ω–æ")
        print(f"   BTC: {balance['free_btc']:.6f} —Å–≤–æ–±–æ–¥–Ω–æ")
        print()
        
        # –ö–∞–∫–∏–µ –ø–∞—Ä—ã –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏
        print("üéØ –î–û–°–¢–£–ü–ù–´–ï –î–õ–Ø –¢–û–†–ì–û–í–õ–ò –ü–ê–†–´:")
        available_pairs = []
        
        for symbol, min_amount in min_amounts.items():
            market_data = exchange.get_market_data(symbol)
            if market_data:
                min_usdt = min_amount * market_data['current_price']
                if balance['free_usdt'] >= min_usdt:
                    available_pairs.append((symbol, min_usdt))
        
        if available_pairs:
            for symbol, min_usdt in available_pairs:
                print(f"   ‚úÖ {symbol} - –º–∏–Ω. {min_usdt:.4f} USDT")
        else:
            print("   ‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–∞—Ä - –ø–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å!")
            
        # üîß –†–ê–°–ß–ï–¢ –î–õ–Ø BTC/USDT –° –¢–ï–ö–£–©–ò–ú –ë–ê–õ–ê–ù–°–û–ú
        btc_min_amount = 0.00001
        btc_price = exchange.get_market_data('BTC/USDT')['current_price']
        btc_min_usdt = btc_min_amount * btc_price
        
        print(f"\nüéØ –†–ê–°–ß–ï–¢ –î–õ–Ø BTC/USDT:")
        print(f"   –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞: {btc_min_usdt:.4f} USDT")
        print(f"   –í–∞—à –±–∞–ª–∞–Ω—Å: {balance['free_usdt']:.2f} USDT")
        print(f"   –î–æ—Å—Ç—É–ø–Ω–æ —Å—Ç–∞–≤–æ–∫: {int(balance['free_usdt'] / btc_min_usdt)}")
        
        # –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏
        recommended_percent = (btc_min_usdt / balance['free_usdt']) * 100
        print(f"   –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏: {recommended_percent:.1f}%")
    
    print("=" * 60)
    print("üí° –¢–µ–ø–µ—Ä—å –±–æ—Ç —Å–º–æ–∂–µ—Ç —Ç–æ—Ä–≥–æ–≤–∞—Ç—å —Å –≤–∞—à–∏–º —Ç–µ–∫—É—â–∏–º –±–∞–ª–∞–Ω—Å–æ–º!")

if __name__ == "__main__":
    calculate_min_trades()
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: check_telegram.py
[FILE_CONTENT_BEGIN]
"""
–ü–†–û–í–ï–†–ö–ê –ù–ê–°–¢–†–û–ô–ö–ò TELEGRAM
"""
import os
import sys
from dotenv import load_dotenv

sys.path.append(os.path.dirname(os.path.abspath(__file__)))
load_dotenv()

def check_telegram():
    print("üîç –ü–†–û–í–ï–†–ö–ê –ù–ê–°–¢–†–û–ô–ö–ò TELEGRAM")
    print("=" * 40)
    
    token = os.getenv('TELEGRAM_BOT_TOKEN')
    chat_id = os.getenv('TELEGRAM_CHAT_ID')
    
    print(f"üì± TELEGRAM_BOT_TOKEN: {'‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω' if token else '‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}")
    print(f"üë§ TELEGRAM_CHAT_ID: {'‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω' if chat_id else '‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}")
    
    if not token or not chat_id:
        print("\n‚ùå Telegram –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω!")
        print("üí° –î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª .env:")
        print("TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞")
        print("TELEGRAM_CHAT_ID=–≤–∞—à_chat_id")
        return False
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞
    import requests
    try:
        url = f"https://api.telegram.org/bot{token}/getMe"
        response = requests.get(url, timeout=10)
        if response.status_code == 200:
            data = response.json()
            if data['ok']:
                print(f"‚úÖ –ë–æ—Ç: @{data['result']['username']}")
                print(f"‚úÖ –ò–º—è: {data['result']['first_name']}")
                return True
        print(f"‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω: {response.text}")
        return False
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: {e}")
        return False

if __name__ == "__main__":
    check_telegram()
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: check_trading.py
[FILE_CONTENT_BEGIN]
"""
–ü–†–û–í–ï–†–ö–ê –ù–ê–°–¢–†–û–ï–ö –¢–û–†–ì–û–í–õ–ò
"""
import os
import sys
from dotenv import load_dotenv

sys.path.append(os.path.dirname(os.path.abspath(__file__)))
load_dotenv()

def check_trading_settings():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ç–æ—Ä–≥–æ–≤–ª–∏"""
    print("üîß –ü–†–û–í–ï–†–ö–ê –ù–ê–°–¢–†–û–ï–ö –¢–û–†–ì–û–í–õ–ò")
    print("=" * 50)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º API –∫–ª—é—á–∏
    api_key = os.getenv('KUCOIN_API_KEY')
    secret_key = os.getenv('KUCOIN_SECRET_KEY')
    passphrase = os.getenv('KUCOIN_PASSPHRASE')
    
    print(f"üîë KUCOIN_API_KEY: {'‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω' if api_key else '‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}")
    print(f"üîë KUCOIN_SECRET_KEY: {'‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω' if secret_key else '‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}")
    print(f"üîë KUCOIN_PASSPHRASE: {'‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω' if passphrase else '‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}")
    
    if not all([api_key, secret_key, passphrase]):
        print("\n‚ùå API –∫–ª—é—á–∏ KuCoin –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã!")
        print("üí° –î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª .env:")
        print("KUCOIN_API_KEY=–≤–∞—à_api_key")
        print("KUCOIN_SECRET_KEY=–≤–∞—à_secret_key")
        print("KUCOIN_PASSPHRASE=–≤–∞—à_passphrase")
        return False
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∏—Ä–∂–µ
    try:
        from core.exchange import ExchangeManager
        exchange = ExchangeManager()
        
        if exchange.connected:
            print("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ KuCoin: –£–°–ü–ï–®–ù–û")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å
            balance = exchange.get_balance()
            if balance:
                print(f"üí∞ –ë–∞–ª–∞–Ω—Å USDT: {balance['free_usdt']:.2f} —Å–≤–æ–±–æ–¥–Ω–æ")
                print(f"üí∞ –ë–∞–ª–∞–Ω—Å BTC: {balance['free_btc']:.6f} —Å–≤–æ–±–æ–¥–Ω–æ")
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—ä–µ–º
                if balance['free_usdt'] < 0.1:
                    print("‚ùå –ù–ï–î–û–°–¢–ê–¢–û–ß–ù–û –°–†–ï–î–°–¢–í: –ú–∏–Ω–∏–º—É–º 0.1 USDT —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏")
                    print("üí° –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å –Ω–∞ KuCoin")
                    return False
                else:
                    print("‚úÖ –ë–∞–ª–∞–Ω—Å –¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏")
            else:
                print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å")
                return False
                
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä—ã–Ω–∫–µ
            symbol = 'BTC/USDT'
            market_info = exchange.get_market_info(symbol)
            if market_info:
                print(f"üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä—ã–Ω–∫–µ {symbol}:")
                print(f"   –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: {market_info['min_amount']}")
                print(f"   –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞: {market_info['min_cost']} USDT")
                print(f"   –¢–æ—á–Ω–æ—Å—Ç—å —Ü–µ–Ω—ã: {market_info['price_precision']}")
                print(f"   –¢–æ—á–Ω–æ—Å—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞: {market_info['amount_precision']}")
            else:
                print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä—ã–Ω–∫–µ")
                
        else:
            print("‚ùå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ KuCoin: –ù–ï–£–î–ê–ß–ù–û")
            return False
            
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ—Ä–≥–æ–≤–ª–∏: {e}")
        return False
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞
    try:
        from config.settings import SettingsManager
        settings = SettingsManager()
        
        print(f"\n‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò –ë–û–¢–ê:")
        print(f"   –†–µ–∂–∏–º —Ç–æ—Ä–≥–æ–≤–ª–∏: {'üü¢ –î–ï–ú–û' if settings.settings['demo_mode'] else 'üî¥ –†–ï–ê–õ–¨–ù–´–ô'}")
        print(f"   –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏: {settings.settings['trade_amount_percent']*100:.1f}%")
        print(f"   –¢–æ—Ä–≥–æ–≤–ª—è –≤–∫–ª—é—á–µ–Ω–∞: {'‚úÖ –î–ê' if settings.settings['trading_enabled'] else '‚ùå –ù–ï–¢'}")
        
        # –†–∞—Å—á–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏
        if balance:
            min_position_usdt = balance['free_usdt'] * settings.settings['trade_amount_percent']
            print(f"   –¢–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä —Å—Ç–∞–≤–∫–∏: {min_position_usdt:.2f} USDT")
            
            if min_position_usdt < 0.1:
                print("‚ùå –†–ê–ó–ú–ï–† –°–¢–ê–í–ö–ò –ú–ê–õ: –£–≤–µ–ª–∏—á—å—Ç–µ trade_amount_percent –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö")
                recommended_percent = (0.1 / balance['free_usdt']) * 100
                print(f"üí° –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: {recommended_percent:.1f}%")
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫: {e}")
        return False
    
    print("\n‚úÖ –ü–†–û–í–ï–†–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û")
    print("üí° –ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!")
    return True

if __name__ == "__main__":
    check_trading_settings()
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: debug_bot.py
[FILE_CONTENT_BEGIN]
"""
–î–ï–ë–ê–ì –ó–ê–ü–£–°–ö–ê –ë–û–¢–ê
"""
import sys
import os
import time
import traceback

sys.path.append(os.path.dirname(os.path.abspath(__file__)))

def debug_bot():
    print("üîß –î–ï–ë–ê–ì –†–ï–ñ–ò–ú –ó–ê–ü–£–°–ö–ê –ë–û–¢–ê")
    print("=" * 50)
    
    try:
        # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∏ —Å–æ–∑–¥–∞–µ–º –±–æ—Ç–∞
        from core.bot import AdvancedTradingBot
        from utils.logger import log_info
        print("1. –ò–º–ø–æ—Ä—Ç –±–æ—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ")
        
        bot = AdvancedTradingBot()
        print("2. –≠–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞ —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã
        print(f"3. –ù–∞—Å—Ç—Ä–æ–π–∫–∏: {type(bot.settings)}")
        print(f"4. –ë–∏—Ä–∂–∞: {type(bot.exchange)}")
        print(f"5. –ú–µ–Ω–µ–¥–∂–µ—Ä —Ä–∏—Å–∫–æ–≤: {type(bot.risk_manager)}")
        print(f"6. –ú–µ—Ç—Ä–∏–∫–∏: {type(bot.metrics)}")
        print(f"7. is_running: {bot.is_running}")
        print(f"8. trading_enabled: {bot.settings.settings.get('trading_enabled', 'NOT SET')}")
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –æ–¥–∏–Ω —Ç–æ—Ä–≥–æ–≤—ã–π —Ü–∏–∫–ª –≤—Ä—É—á–Ω—É—é
        print("9. –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–æ—Ä–≥–æ–≤—ã–π —Ü–∏–∫–ª...")
        bot.execute_trading_cycle()
        print("10. –¢–æ—Ä–≥–æ–≤—ã–π —Ü–∏–∫–ª –∑–∞–≤–µ—Ä—à–µ–Ω")
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª
        print("11. –ó–ê–ü–£–°–ö–ê–ï–ú –û–°–ù–û–í–ù–û–ô –¶–ò–ö–õ...")
        bot.run()
        
    except Exception as e:
        print(f"‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: {e}")
        traceback.print_exc()

if __name__ == "__main__":
    debug_bot()
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: debug_trading.py
[FILE_CONTENT_BEGIN]
"""
–î–ï–ë–ê–ì –¢–û–†–ì–û–í–û–ô –õ–û–ì–ò–ö–ò
"""
import sys
import os
import time

sys.path.append(os.path.dirname(os.path.abspath(__file__)))

def debug_trading_logic():
    """–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ç–æ—Ä–≥–æ–≤–æ–π –ª–æ–≥–∏–∫–∏"""
    from core.bot import AdvancedTradingBot
    from utils.logger import log_info
    
    print("üîß –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –¢–û–†–ì–û–í–û–ô –õ–û–ì–ò–ö–ò")
    print("=" * 50)
    
    bot = AdvancedTradingBot()
    
    # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Ç–µ—Å—Ç–∞
    bot.position = None
    bot.last_signal = None
    bot.entry_price = 0
    bot.current_position_size_usdt = 0
    bot.last_trade_time = 0
    
    print("ü§ñ –°–æ—Å—Ç–æ—è–Ω–∏–µ –±–æ—Ç–∞ —Å–±—Ä–æ—à–µ–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è")
    print(f"üìä –ü–æ–∑–∏—Ü–∏—è: {bot.position}")
    print(f"üìä Last signal: {bot.last_signal}")
    print(f"üí∞ Entry price: {bot.entry_price}")
    print(f"‚è∞ Last trade time: {bot.last_trade_time}")
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –æ–¥–∏–Ω —Ü–∏–∫–ª —Ç–æ—Ä–≥–æ–≤–ª–∏
    print("\nüöÄ –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–æ—Ä–≥–æ–≤—ã–π —Ü–∏–∫–ª...")
    bot.execute_trading_cycle()
    
    print("\nüìä –†–µ–∑—É–ª—å—Ç–∞—Ç:")
    print(f"üìä –ü–æ–∑–∏—Ü–∏—è: {bot.position}")
    print(f"üìä Last signal: {bot.last_signal}")
    print(f"üí∞ Entry price: {bot.entry_price}")
    print(f"‚è∞ Last trade time: {bot.last_trade_time}")

def force_buy_signal():
    """–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —É—Å–ª–æ–≤–∏–π –¥–ª—è –ø–æ–∫—É–ø–∫–∏"""
    from core.bot import AdvancedTradingBot
    from utils.logger import log_info
    
    print("üü¢ –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–ê–Ø –ü–û–ö–£–ü–ö–ê")
    print("=" * 50)
    
    bot = AdvancedTradingBot()
    
    # –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    bot.position = None
    bot.last_signal = None
    bot.entry_price = 0
    bot.current_position_size_usdt = 0
    bot.last_trade_time = 0
    
    # –ü–æ–ª—É—á–∞–µ–º —Ä—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    symbol = bot.settings.trading_pairs['active_pair']
    market_data = bot.exchange.get_market_data(symbol)
    
    if market_data:
        # –ò–º–∏—Ç–∏—Ä—É–µ–º –∏–¥–µ–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è –ø–æ–∫—É–ø–∫–∏
        market_data['ema_diff_percent'] = 0.01  # –°–∏–ª—å–Ω—ã–π –≤–æ—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–µ–Ω–¥
        
        print(f"üìä –°–æ–∑–¥–∞–Ω—ã –∏–¥–µ–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è:")
        print(f"   –¶–µ–Ω–∞: {market_data['current_price']:.2f}")
        print(f"   EMA diff: {market_data['ema_diff_percent']:.4f}")
        print(f"   –ü–æ–∑–∏—Ü–∏—è: {bot.position}")
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º —Ü–∏–∫–ª
        bot.execute_trading_cycle()
        
        print(f"\nüìä –†–µ–∑—É–ª—å—Ç–∞—Ç:")
        print(f"   –ü–æ–∑–∏—Ü–∏—è: {bot.position}")
        print(f"   Last signal: {bot.last_signal}")
        
        if bot.position == 'long':
            print("‚úÖ –ü–û–ö–£–ü–ö–ê –í–´–ü–û–õ–ù–ï–ù–ê –£–°–ü–ï–®–ù–û!")
        else:
            print("‚ùå –ü–û–ö–£–ü–ö–ê –ù–ï –í–´–ü–û–õ–ù–ï–ù–ê")

if __name__ == "__main__":
    debug_trading_logic()
    print("\n" + "="*50)
    force_buy_signal()
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: main.py
[FILE_CONTENT_BEGIN]
"""
–û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–´–ô –ó–ê–ü–£–°–ö –ë–û–¢–ê
"""
import sys
import os
import time
import traceback

# –ü–µ—Ä–µ–Ω–æ—Å–∏–º –∏–º–ø–æ—Ä—Ç –ª–æ–≥–≥–µ—Ä–∞ –í–ù–ï —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –î–û try
sys.path.append(os.path.dirname(os.path.abspath(__file__)))
from utils.logger import log_info, log_error

def quick_start():
    """–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π"""
    start_time = time.time()
    print("‚ö° –ë–´–°–¢–†–´–ô –ó–ê–ü–£–°–ö –¢–û–†–ì–û–í–û–ì–û –ë–û–¢–ê")
    print("=" * 40)
    try:
        from core.bot import AdvancedTradingBot
        log_info("–°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞...")
        bot = AdvancedTradingBot()
        init_time = time.time() - start_time
        log_info(f"‚úÖ –ë–æ—Ç –≥–æ—Ç–æ–≤ –∑–∞ {init_time:.2f} —Å–µ–∫")
        log_info("–ó–∞–ø—É—Å–∫–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã...")
        bot.run()
    except KeyboardInterrupt:
        log_info("üõë –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
    except Exception as e:
        log_error(f"‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}")
        traceback.print_exc()
        sys.exit(1)

if __name__ == "__main__":
    quick_start()
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: README.md
[FILE_CONTENT_BEGIN]
# ü§ñ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –¢–æ—Ä–≥–æ–≤—ã–π –ë–æ—Ç v4.0

–ú–Ω–æ–≥–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–æ—Ä–≥–æ–≤—ã–π –±–æ—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π, –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –∏ Telegram –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **üéØ 5 —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π**: EMA+ML, Price Action, MACD+RSI, Bollinger Bands, –ì–∏–±—Ä–∏–¥–Ω–∞—è
- **üí± –ú—É–ª—å—Ç–∏-–ø–∞—Ä—ã**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 6+ —Ç–æ—Ä–≥–æ–≤—ã—Ö –ø–∞—Ä
- **ü§ñ Machine Learning**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Random Forest –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è —Ü–µ–Ω—ã
- **‚ö° –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram**: –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å —á–µ—Ä–µ–∑ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä
- **üìä –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞**: –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç—ã
- **üîí –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∏—Å–∫–∞–º–∏**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å —Ä–∏—Å–∫–æ–≤

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:

```bash
git clone <repository-url>
cd trading-bot
```
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: requirements.txt
[FILE_CONTENT_BEGIN]
ccxt
python-dotenv
requests
pandas
numpy
scikit-learn
joblib
python-telegram-bot
matplotlib
seaborn
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: telegram_fix.py
[FILE_CONTENT_BEGIN]
"""
–§–ò–ö–° –ü–†–û–ë–õ–ï–ú –° TELEGRAM
"""
import os
import sys
import requests
from dotenv import load_dotenv

sys.path.append(os.path.dirname(os.path.abspath(__file__)))
load_dotenv()

def test_telegram_connection():
    print("üîß –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø –ö TELEGRAM")
    print("=" * 50)
    
    token = os.getenv('TELEGRAM_BOT_TOKEN')
    
    if not token:
        print("‚ùå TELEGRAM_BOT_TOKEN –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ .env —Ñ–∞–π–ª–µ")
        return False
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ä–∞–∑–Ω—ã–µ –º–µ—Ç–æ–¥—ã
    methods = [
        f"https://api.telegram.org/bot{token}/getMe",
        f"https://api.telegram.org/bot{token}/getUpdates",
    ]
    
    for method in methods:
        try:
            print(f"üîç –¢–µ—Å—Ç–∏—Ä—É–µ–º: {method.split('/')[-1]}")
            response = requests.get(method, timeout=15)
            print(f"‚úÖ –°—Ç–∞—Ç—É—Å: {response.status_code}")
            if response.status_code == 200:
                data = response.json()
                if data.get('ok'):
                    print("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ!")
                    return True
                else:
                    print(f"‚ùå –û—à–∏–±–∫–∞ API: {data}")
            else:
                print(f"‚ùå HTTP –æ—à–∏–±–∫–∞: {response.status_code}")
        except requests.exceptions.ConnectTimeout:
            print("‚ùå –¢–∞–π–º–∞—É—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (15 —Å–µ–∫)")
            print("üí° –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:")
            print("   - –ü—Ä–æ–±–ª–µ–º—ã —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º")
            print("   - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ Telegram –≤ –≤–∞—à–µ–π —Å–µ—Ç–∏")
            print("   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ VPN –µ—Å–ª–∏ Telegram –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω")
        except requests.exceptions.ConnectionError:
            print("‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è")
            print("üí° –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ")
        except Exception as e:
            print(f"‚ùå –î—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞: {e}")
    
    return False

if __name__ == "__main__":
    test_telegram_connection()
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: test_trading_fix.py
[FILE_CONTENT_BEGIN]
"""
–¢–ï–°–¢ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô –¢–û–†–ì–û–í–õ–ò
"""
import sys
import os

sys.path.append(os.path.dirname(os.path.abspath(__file__)))

def test_min_amount_fix():
    """–¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤"""
    from core.bot import AdvancedTradingBot
    
    print("üß™ –¢–ï–°–¢ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô –ú–ò–ù–ò–ú–ê–õ–¨–ù–´–• –ö–û–õ–ò–ß–ï–°–¢–í")
    print("=" * 50)
    
    bot = AdvancedTradingBot()
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–ª—è –≤—Å–µ—Ö –ø–∞—Ä
    test_pairs = ['BTC/USDT', 'ETH/USDT', 'SOL/USDT', 'ADA/USDT', 'DOT/USDT', 'LINK/USDT']
    
    for symbol in test_pairs:
        min_amount = bot.get_min_amount(symbol)
        market_data = bot.exchange.get_market_data(symbol)
        
        if market_data:
            current_price = market_data['current_price']
            min_usdt = min_amount * current_price
            
            print(f"üîπ {symbol}:")
            print(f"   –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: {min_amount}")
            print(f"   –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞: {current_price:.2f} USDT")
            print(f"   –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞: {min_usdt:.4f} USDT")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å
            balance = bot.exchange.get_balance()
            if balance:
                if balance['free_usdt'] >= min_usdt:
                    print(f"   ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏")
                else:
                    print(f"   ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ (–Ω—É–∂–Ω–æ: {min_usdt:.4f} USDT)")
            print()

def test_btc_calculation():
    """–¢–µ—Å—Ç —Ä–∞—Å—á–µ—Ç–∞ –¥–ª—è BTC/USDT"""
    from core.exchange import ExchangeManager
    
    print("üß™ –¢–ï–°–¢ –†–ê–°–ß–ï–¢–ê BTC/USDT")
    print("=" * 50)
    
    exchange = ExchangeManager()
    balance = exchange.get_balance()
    market_data = exchange.get_market_data('BTC/USDT')
    
    if balance and market_data:
        current_price = market_data['current_price']
        min_amount = 0.00001  # –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
        min_usdt = min_amount * current_price
        
        print(f"üí∞ –ë–∞–ª–∞–Ω—Å: {balance['free_usdt']:.2f} USDT")
        print(f"üí∞ –¶–µ–Ω–∞ BTC: {current_price:.2f} USDT")
        print(f"üí∞ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞: {min_usdt:.4f} USDT")
        print(f"üéØ –î–æ—Å—Ç—É–ø–Ω–æ —Å—Ç–∞–≤–æ–∫: {int(balance['free_usdt'] / min_usdt)}")
        
        # –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏
        trade_percent = 0.1  # 10%
        calculated_position = balance['free_usdt'] * trade_percent
        calculated_amount = calculated_position / current_price
        
        print(f"\nüìä –†–ê–°–ß–ï–¢ –ü–û–ó–ò–¶–ò–ò (10%):")
        print(f"   –†–∞–∑–º–µ—Ä —Å—Ç–∞–≤–∫–∏: {calculated_position:.4f} USDT")
        print(f"   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ BTC: {calculated_amount:.6f}")
        
        if calculated_amount >= min_amount:
            print(f"   ‚úÖ –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞")
        else:
            print(f"   ‚ùå –ú–µ–Ω—å—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞")
            
            # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ
            required_position = min_amount * current_price
            print(f"   üí° –ê–≤—Ç–æ-—É–≤–µ–ª–∏—á–µ–Ω–∏–µ –¥–æ: {required_position:.4f} USDT")

if __name__ == "__main__":
    test_min_amount_fix()
    print("\n" + "="*50)
    test_btc_calculation()
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: universal_export.py
[FILE_CONTENT_BEGIN]
"""
–£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ô –≠–ö–°–ü–û–†–¢–ï–† –î–õ–Ø –õ–Æ–ë–´–• –ü–†–û–ï–ö–¢–û–í
"""
import os
import json
from pathlib import Path

class UniversalProjectExporter:
    def __init__(self):
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –ø—Ä–æ–µ–∫—Ç–æ–≤
        self.presets = {
            'python': {
                'include_ext': ['.py', '.txt', '.md', '.yml', '.yaml', '.ini', '.cfg'],
                'exclude_dirs': {'.git', '__pycache__', 'venv', 'env', '.vscode', '.idea', 'logs', 'dist', 'build'},
                'exclude_files': {'.pyc', '.pkl', '.log', '.zip', '.db', '.so'}
            },
            'javascript': {
                'include_ext': ['.js', '.ts', '.jsx', '.tsx', '.json', '.html', '.css', '.md'],
                'exclude_dirs': {'.git', 'node_modules', 'dist', 'build', '.vscode'},
                'exclude_files': {'.log', '.zip'}
            },
            'java': {
                'include_ext': ['.java', '.xml', '.properties', '.md'],
                'exclude_dirs': {'.git', 'target', 'build', '.gradle'},
                'exclude_files': {'.class', '.jar', '.log'}
            },
            'all_files': {
                'include_ext': [],  # –í—Å–µ —Ñ–∞–π–ª—ã
                'exclude_dirs': {'.git', '__pycache__', 'node_modules', 'venv'},
                'exclude_files': {'.pyc', '.class', '.log', '.zip'}
            }
        }
    
    def detect_project_type(self):
        """–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –ø—Ä–æ–µ–∫—Ç–∞"""
        files = os.listdir('.')
        
        if 'package.json' in files:
            return 'javascript'
        elif 'pom.xml' in files or 'build.gradle' in files:
            return 'java'
        elif 'requirements.txt' in files or 'setup.py' in files:
            return 'python'
        else:
            return 'all_files'
    
    def export_project(self, project_type=None, custom_settings=None):
        """–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –ø—Ä–æ–µ–∫—Ç"""
        if not project_type:
            project_type = self.detect_project_type()
        
        if custom_settings:
            settings = custom_settings
        else:
            settings = self.presets.get(project_type, self.presets['all_files'])
        
        print(f"üéØ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –ø—Ä–æ–µ–∫—Ç —Ç–∏–ø–∞: {project_type}")
        
        export_content = f"üöÄ –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ô –≠–ö–°–ü–û–†–¢ –ü–†–û–ï–ö–¢–ê ({project_type.upper()})\n"
        export_content += "=" * 60 + "\n\n"
        
        # –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
        export_content += "üìÅ –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê:\n"
        export_content += "=" * 30 + "\n"
        
        file_count = 0
        
        for root, dirs, files in os.walk('.'):
            # –§–∏–ª—å—Ç—Ä—É–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
            dirs[:] = [d for d in dirs if d not in settings['exclude_dirs']]
            
            level = root.count(os.sep) - 1
            indent = '  ' * level
            folder_name = os.path.basename(root) if os.path.basename(root) else 'ROOT'
            export_content += f"{indent}üìÅ {folder_name}/\n"
            
            # –§–∞–π–ª—ã –≤ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
            sub_indent = '  ' * (level + 1)
            for file in files:
                file_ext = os.path.splitext(file)[1]
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
                if settings['include_ext'] and file_ext not in settings['include_ext']:
                    continue
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏—è
                if any(file.endswith(ext) for ext in settings['exclude_files']):
                    continue
                
                export_content += f"{sub_indent}üìÑ {file}\n"
        
        export_content += "\n\n" + "=" * 60 + "\n"
        export_content += "üìÑ –°–û–î–ï–†–ñ–ê–ù–ò–ï –§–ê–ô–õ–û–í:\n"
        export_content += "=" * 60 + "\n\n"
        
        # –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–æ–≤
        for root, dirs, files in os.walk('.'):
            dirs[:] = [d for d in dirs if d not in settings['exclude_dirs']]
            
            for file in files:
                file_ext = os.path.splitext(file)[1]
                file_path = Path(root) / file
                
                # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é
                if settings['include_ext'] and file_ext not in settings['include_ext']:
                    continue
                
                # –ò—Å–∫–ª—é—á–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤
                if any(file.endswith(ext) for ext in settings['exclude_files']):
                    continue
                
                try:
                    with open(file_path, 'r', encoding='utf-8') as f:
                        content = f.read().strip()
                    
                    if content:
                        export_content += f"[FILE_NAME]: {file_path}\n"
                        export_content += "[FILE_CONTENT_BEGIN]\n"
                        export_content += content
                        export_content += "\n[FILE_CONTENT_END]\n\n"
                        export_content += "‚îÄ" * 50 + "\n\n"
                        
                        file_count += 1
                        
                except UnicodeDecodeError:
                    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –±–∏–Ω–∞—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã
                    continue
                except Exception as e:
                    export_content += f"[FILE_NAME]: {file_path}\n"
                    export_content += f"[ERROR]: {e}\n\n"
                    export_content += "‚îÄ" * 50 + "\n\n"
        
        export_content += f"\n‚úÖ –í—Å–µ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ —Ñ–∞–π–ª–æ–≤: {file_count}\n"
        export_content += f"üéØ –¢–∏–ø –ø—Ä–æ–µ–∫—Ç–∞: {project_type}\n"
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º
        filename = f'project_export_{project_type}.txt'
        with open(filename, 'w', encoding='utf-8') as f:
            f.write(export_content)
        
        print(f"‚úÖ –ü—Ä–æ–µ–∫—Ç —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ {filename}")
        print(f"üìä –§–∞–π–ª–æ–≤: {file_count}")
        
        return export_content
    
    def show_available_presets(self):
        """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–µ—Å–µ—Ç—ã"""
        print("\nüéØ –î–û–°–¢–£–ü–ù–´–ï –ü–†–ï–°–ï–¢–´:")
        for preset_name, settings in self.presets.items():
            print(f"  {preset_name}: {settings['include_ext']}")

def main():
    exporter = UniversalProjectExporter()
    
    print("üöÄ –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ô –≠–ö–°–ü–û–†–¢–ï–† –ü–†–û–ï–ö–¢–û–í")
    print("=" * 50)
    
    # –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –ø—Ä–æ–µ–∫—Ç–∞
    detected_type = exporter.detect_project_type()
    print(f"üîç –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω —Ç–∏–ø –ø—Ä–æ–µ–∫—Ç–∞: {detected_type}")
    
    exporter.show_available_presets()
    
    # –°–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    user_choice = input(f"\nüéØ –í—ã–±–µ—Ä–∏ —Ç–∏–ø –ø—Ä–æ–µ–∫—Ç–∞ (Enter –¥–ª—è {detected_type}): ").strip()
    project_type = user_choice if user_choice else detected_type
    
    # –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º
    exporter.export_project(project_type)

if __name__ == "__main__":
    main()
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: analytics\metrics.py
[FILE_CONTENT_BEGIN]
"""
–ú–ï–¢–†–ò–ö–ò –ò –°–¢–ê–¢–ò–°–¢–ò–ö–ê
"""
from datetime import datetime, timedelta
from utils.logger import log_info

class AnalyticsMetrics:
    def __init__(self):
        self.reset_metrics()
    
    def reset_metrics(self):
        """–°–±—Ä–æ—Å –º–µ—Ç—Ä–∏–∫"""
        self.total_trades = 0
        self.winning_trades = 0
        self.losing_trades = 0
        self.total_profit = 0.0
        self.total_profit_usdt = 0.0
        self.max_drawdown = 0.0
        self.current_drawdown = 0.0
        self.consecutive_wins = 0
        self.consecutive_losses = 0
        self.best_trade = 0.0
        self.worst_trade = 0.0
        self.best_trade_usdt = 0.0
        self.worst_trade_usdt = 0.0
        self.average_win = 0.0
        self.average_loss = 0.0
        self.average_win_usdt = 0.0
        self.average_loss_usdt = 0.0
        self.win_rate = 0.0
        self.profit_factor = 0.0
        self.sharpe_ratio = 0.0
        self.trade_history = []
        self.daily_performance = {}
        self.weekly_performance = {}
        
        self.peak_equity = 0.0
        self.current_equity = 10000.0  # –ù–∞—á–∞–ª—å–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –ø—Ä–æ—Å–∞–¥–∫–∏
        self.daily_profit = 0.0
        self.daily_profit_usdt = 0.0
        self.last_reset_date = datetime.now().date()
    
    def get_current_time(self):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏"""
        return datetime.now().strftime("%H:%M:%S")
    
    def update_metrics(self, trade_result):
        """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –ø–æ—Å–ª–µ —Å–¥–µ–ª–∫–∏ —Å USDT"""
        try:
            self.total_trades += 1
            profit = trade_result.get('profit', 0)
            profit_percent = trade_result.get('profit_percent', 0)
            profit_usdt = trade_result.get('profit_usdt', 0)
            position_size_usdt = trade_result.get('position_size_usdt', 0)
            
            # –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â—É—é –ø—Ä–∏–±—ã–ª—å –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö –∏ USDT
            self.total_profit += profit
            self.total_profit_usdt += profit_usdt
            
            # –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏ –ø–æ–±–µ–¥/–ø–æ—Ä–∞–∂–µ–Ω–∏–π
            if profit > 0:
                self.winning_trades += 1
                self.consecutive_wins += 1
                self.consecutive_losses = 0
            else:
                self.losing_trades += 1
                self.consecutive_losses += 1
                self.consecutive_wins = 0
            
            # –û–±–Ω–æ–≤–ª—è–µ–º –ª—É—á—à—É—é/—Ö—É–¥—à—É—é —Å–¥–µ–ª–∫—É –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
            if profit > self.best_trade:
                self.best_trade = profit
            if profit < self.worst_trade:
                self.worst_trade = profit
            
            # –û–±–Ω–æ–≤–ª—è–µ–º –ª—É—á—à—É—é/—Ö—É–¥—à—É—é —Å–¥–µ–ª–∫—É –≤ USDT
            if profit_usdt > self.best_trade_usdt:
                self.best_trade_usdt = profit_usdt
            if profit_usdt < self.worst_trade_usdt:
                self.worst_trade_usdt = profit_usdt
            
            # –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
            if self.winning_trades > 0:
                self.average_win = self.total_profit / self.winning_trades
            if self.losing_trades > 0:
                self.average_loss = abs(self.total_profit) / self.losing_trades
            
            # –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ USDT
            if self.winning_trades > 0:
                self.average_win_usdt = self.total_profit_usdt / self.winning_trades
            if self.losing_trades > 0:
                self.average_loss_usdt = abs(self.total_profit_usdt) / self.losing_trades
            
            # –†–∞—Å—á–µ—Ç Win Rate
            if self.total_trades > 0:
                self.win_rate = (self.winning_trades / self.total_trades) * 100
            
            # –†–∞—Å—á–µ—Ç Profit Factor
            if self.average_loss > 0:
                self.profit_factor = self.average_win / self.average_loss
            
            # –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ—Å–∞–¥–∫—É
            self.current_equity += profit
            if self.current_equity > self.peak_equity:
                self.peak_equity = self.current_equity
            
            # –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –°–¢–†–û–ö–ê - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å —Ç–µ—Ä–Ω–∞—Ä–Ω–æ–≥–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
            if self.peak_equity > 0:
                drawdown = ((self.peak_equity - self.current_equity) / self.peak_equity * 100)
            else:
                drawdown = 0
            
            self.current_drawdown = drawdown
            if drawdown > self.max_drawdown:
                self.max_drawdown = drawdown
            
            # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é —Å USDT
            trade_record = {
                'timestamp': datetime.now(),
                'symbol': trade_result.get('symbol', ''),
                'signal': trade_result.get('signal', ''),
                'profit': profit,
                'profit_percent': profit_percent,
                'profit_usdt': profit_usdt,
                'position_size_usdt': position_size_usdt,
                'price': trade_result.get('price', 0),
                'position_size': trade_result.get('position_size', 0)
            }
            self.trade_history.append(trade_record)
            
            # –û–±–Ω–æ–≤–ª—è–µ–º –¥–Ω–µ–≤–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            today = datetime.now().date()
            if today not in self.daily_performance:
                self.daily_performance[today] = {
                    'trades': 0,
                    'profit': 0.0,
                    'profit_usdt': 0.0,
                    'winning_trades': 0,
                    'losing_trades': 0
                }
            
            self.daily_performance[today]['trades'] += 1
            self.daily_performance[today]['profit'] += profit
            self.daily_performance[today]['profit_usdt'] += profit_usdt
            if profit > 0:
                self.daily_performance[today]['winning_trades'] += 1
            else:
                self.daily_performance[today]['losing_trades'] += 1
            
            log_info(f"üìä –ú–µ—Ç—Ä–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã: —Å–¥–µ–ª–æ–∫ {self.total_trades}, "
                    f"Win Rate {self.win_rate:.1f}%, –ø—Ä–∏–±—ã–ª—å {self.total_profit:.2f}% ({self.total_profit_usdt:.2f} USDT)")
                    
        except Exception as e:
            log_info(f"‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫: {e}")
    
    def get_summary(self):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–≤–æ–¥–∫–∏ –º–µ—Ç—Ä–∏–∫"""
        return {
            'total_trades': self.total_trades,
            'winning_trades': self.winning_trades,
            'losing_trades': self.losing_trades,
            'total_profit': self.total_profit,
            'total_profit_usdt': self.total_profit_usdt,
            'win_rate': self.win_rate,
            'profit_factor': self.profit_factor,
            'max_drawdown': self.max_drawdown,
            'current_drawdown': self.current_drawdown,
            'best_trade': self.best_trade,
            'worst_trade': self.worst_trade,
            'best_trade_usdt': self.best_trade_usdt,
            'worst_trade_usdt': self.worst_trade_usdt,
            'average_win': self.average_win,
            'average_loss': self.average_loss,
            'average_win_usdt': self.average_win_usdt,
            'average_loss_usdt': self.average_loss_usdt,
            'consecutive_wins': self.consecutive_wins,
            'consecutive_losses': self.consecutive_losses
        }
    
    def get_performance_report(self, period='all'):
        """–û—Ç—á–µ—Ç –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å USDT"""
        summary = self.get_summary()
        
        report = f"""
üìä <b>–ê–ù–ê–õ–ò–¢–ò–ö–ê –¢–û–†–ì–û–í–õ–ò</b>

üìà <b>–û–°–ù–û–í–ù–´–ï –ú–ï–¢–†–ò–ö–ò:</b>
‚Ä¢ –í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫: <b>{summary['total_trades']}</b>
‚Ä¢ Win Rate: <b>{summary['win_rate']:.1f}%</b>
‚Ä¢ Profit Factor: <b>{summary['profit_factor']:.2f}</b>
‚Ä¢ –û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å: <b>{summary['total_profit']:.2f}% ({summary['total_profit_usdt']:.2f} USDT)</b>

üí∞ <b>–°–¢–ê–¢–ò–°–¢–ò–ö–ê –°–î–ï–õ–û–ö:</b>
‚Ä¢ –ü—Ä–∏–±—ã–ª—å–Ω—ã—Ö: <b>{summary['winning_trades']}</b>
‚Ä¢ –£–±—ã—Ç–æ—á–Ω—ã—Ö: <b>{summary['losing_trades']}</b>
‚Ä¢ –°—Ä–µ–¥–Ω—è—è –ø—Ä–∏–±—ã–ª—å: <b>{summary['average_win']:.2f}% ({summary['average_win_usdt']:.2f} USDT)</b>
‚Ä¢ –°—Ä–µ–¥–Ω–∏–π —É–±—ã—Ç–æ–∫: <b>{summary['average_loss']:.2f}% ({summary['average_loss_usdt']:.2f} USDT)</b>

üéØ <b>–†–ï–ö–û–†–î–´:</b>
‚Ä¢ –õ—É—á—à–∞—è —Å–¥–µ–ª–∫–∞: <b>{summary['best_trade']:.2f}% ({summary['best_trade_usdt']:.2f} USDT)</b>
‚Ä¢ –•—É–¥—à–∞—è —Å–¥–µ–ª–∫–∞: <b>{summary['worst_trade']:.2f}% ({summary['worst_trade_usdt']:.2f} USDT)</b>
‚Ä¢ –°–µ—Ä–∏—è –ø–æ–±–µ–¥: <b>{summary['consecutive_wins']}</b>
‚Ä¢ –°–µ—Ä–∏—è –ø–æ—Ä–∞–∂–µ–Ω–∏–π: <b>{summary['consecutive_losses']}</b>

‚ö° <b>–†–ò–°–ö–ò:</b>
‚Ä¢ –ú–∞–∫—Å –ø—Ä–æ—Å–∞–¥–∫–∞: <b>{summary['max_drawdown']:.2f}%</b>
‚Ä¢ –¢–µ–∫—É—â–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞: <b>{summary['current_drawdown']:.2f}%</b>
"""
        return report
    
    def get_daily_summary(self):
        """–°–≤–æ–¥–∫–∞ –∑–∞ —Å–µ–≥–æ–¥–Ω—è"""
        today = datetime.now().date()
        daily_data = self.daily_performance.get(today, {})
        
        trades_today = daily_data.get('trades', 0)
        profit_today = daily_data.get('profit', 0)
        profit_usdt_today = daily_data.get('profit_usdt', 0)
        winning_trades_today = daily_data.get('winning_trades', 0)
        losing_trades_today = daily_data.get('losing_trades', 0)
        
        win_rate_today = (winning_trades_today / trades_today * 100) if trades_today > 0 else 0
        
        return {
            'date': today,
            'trades': trades_today,
            'profit': profit_today,
            'profit_usdt': profit_usdt_today,
            'winning_trades': winning_trades_today,
            'losing_trades': losing_trades_today,
            'win_rate': win_rate_today
        }
    
    def get_trade_history_formatted(self, limit=10):
        """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫"""
        if not self.trade_history:
            return "–ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫ –ø—É—Å—Ç–∞"
        
        recent_trades = self.trade_history[-limit:]
        formatted = []
        
        for trade in recent_trades:
            emoji = "üü¢" if trade['profit'] > 0 else "üî¥"
            profit_str = f"+{trade['profit']:.2f}%" if trade['profit'] > 0 else f"{trade['profit']:.2f}%"
            profit_usdt_str = f"+{trade['profit_usdt']:.2f} USDT" if trade['profit_usdt'] > 0 else f"{trade['profit_usdt']:.2f} USDT"
            
            formatted.append(
                f"{emoji} {trade['signal'].upper()} {trade['symbol']} - "
                f"{trade['price']:.2f} USDT ({profit_str} / {profit_usdt_str})"
            )
        
        return "\n".join(formatted)
    
    def get_position_statistics(self):
        """–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –æ—Ç–∫—Ä—ã—Ç—ã–º –ø–æ–∑–∏—Ü–∏—è–º"""
        if not self.trade_history:
            return None
        
        # –ù–∞—Ö–æ–¥–∏–º –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏ (–ø–æ—Å–ª–µ–¥–Ω—è—è —Å–¥–µ–ª–∫–∞ - –ø–æ–∫—É–ø–∫–∞ –±–µ–∑ –ø—Ä–æ–¥–∞–∂–∏)
        open_positions = []
        for trade in reversed(self.trade_history):
            if trade['signal'] == 'buy':
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª–∞ –ª–∏ –ø—Ä–æ–¥–∞–∂–∞ –ø–æ—Å–ª–µ —ç—Ç–æ–π –ø–æ–∫—É–ø–∫–∏
                has_sell = any(
                    t for t in self.trade_history 
                    if t['timestamp'] > trade['timestamp'] and t['signal'] == 'sell'
                )
                if not has_sell:
                    open_positions.append(trade)
        
        return {
            'open_positions': len(open_positions),
            'total_invested': sum(pos['position_size_usdt'] for pos in open_positions),
            'positions': open_positions
        }
    
    def cleanup_old_data(self, days_to_keep=30):
        """–û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö"""
        try:
            cutoff_date = datetime.now() - timedelta(days=days_to_keep)
            
            # –û—á–∏—â–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é —Å–¥–µ–ª–æ–∫
            self.trade_history = [
                trade for trade in self.trade_history 
                if trade['timestamp'] > cutoff_date
            ]
            
            # –û—á–∏—â–∞–µ–º –¥–Ω–µ–≤–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            self.daily_performance = {
                date: data for date, data in self.daily_performance.items()
                if date > cutoff_date.date()
            }
            
            log_info(f"üßπ –û—á–∏—â–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ä—à–µ {days_to_keep} –¥–Ω–µ–π")
            
        except Exception as e:
            log_info(f"‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö: {e}")
    
    def calculate_roi(self, initial_capital=10000):
        """–†–∞—Å—á–µ—Ç ROI"""
        if initial_capital > 0:
            return (self.total_profit_usdt / initial_capital) * 100
        return 0
    
    def get_risk_metrics(self):
        """–ú–µ—Ç—Ä–∏–∫–∏ —Ä–∏—Å–∫–∞"""
        if self.total_trades == 0:
            return {}
        
        # –†–∞—Å—á–µ—Ç Sharpe Ratio (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π)
        returns = [trade['profit'] for trade in self.trade_history]
        avg_return = sum(returns) / len(returns)
        std_dev = (sum((r - avg_return) ** 2 for r in returns) / len(returns)) ** 0.5
        
        sharpe_ratio = avg_return / std_dev if std_dev > 0 else 0
        
        # –†–∞—Å—á–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ—Å–∞–¥–∫–∏ –≤ USDT
        equity_curve = []
        current_equity = 10000  # –ù–∞—á–∞–ª—å–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª
        for trade in self.trade_history:
            current_equity += trade['profit_usdt']
            equity_curve.append(current_equity)
        
        max_drawdown_usdt = 0
        peak = equity_curve[0] if equity_curve else 0
        for equity in equity_curve:
            if equity > peak:
                peak = equity
            drawdown = (peak - equity) / peak * 100
            if drawdown > max_drawdown_usdt:
                max_drawdown_usdt = drawdown
        
        return {
            'sharpe_ratio': sharpe_ratio,
            'volatility': std_dev,
            'max_drawdown_usdt': max_drawdown_usdt,
            'avg_trade_return': avg_return,
            'expectancy': (self.win_rate/100 * self.average_win + 
                          (1 - self.win_rate/100) * self.average_loss)
        }
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: analytics\reporter.py
[FILE_CONTENT_BEGIN]
"""
–ì–ï–ù–ï–†–ê–¶–ò–Ø –û–¢–ß–ï–¢–û–í –ò –ê–ù–ê–õ–ò–¢–ò–ö–ò
"""
from datetime import datetime, timedelta
from utils.logger import log_info

class ReportGenerator:
    def __init__(self, metrics_manager):
        self.metrics = metrics_manager
    
    def generate_performance_report(self, period='all'):
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"""
        summary = self.metrics.get_summary()
        
        report = f"""
üìä <b>–û–¢–ß–ï–¢ –û –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò</b>
‚è∞ –ü–µ—Ä–∏–æ–¥: {self._get_period_name(period)}

üìà <b>–û–°–ù–û–í–ù–´–ï –ú–ï–¢–†–ò–ö–ò:</b>
‚Ä¢ –í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫: <b>{summary['total_trades']}</b>
‚Ä¢ Win Rate: <b>{summary['win_rate']:.1f}%</b>
‚Ä¢ Profit Factor: <b>{summary['profit_factor']:.2f}</b>
‚Ä¢ –û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å: <b>{summary['total_profit']:.2f} USDT</b>
‚Ä¢ –ú–∞–∫—Å –ø—Ä–æ—Å–∞–¥–∫–∞: <b>{summary['max_drawdown']:.2f}%</b>

üí∞ <b>–°–¢–ê–¢–ò–°–¢–ò–ö–ê –°–î–ï–õ–û–ö:</b>
‚Ä¢ –ü—Ä–∏–±—ã–ª—å–Ω—ã—Ö: <b>{summary['winning_trades']}</b>
‚Ä¢ –£–±—ã—Ç–æ—á–Ω—ã—Ö: <b>{summary['losing_trades']}</b>
‚Ä¢ –°—Ä–µ–¥–Ω—è—è –ø—Ä–∏–±—ã–ª—å: <b>{summary['average_win']:.2f} USDT</b>
‚Ä¢ –°—Ä–µ–¥–Ω–∏–π —É–±—ã—Ç–æ–∫: <b>{summary['average_loss']:.2f} USDT</b>
‚Ä¢ –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –ø—Ä–∏–±—ã–ª—å/—É–±—ã—Ç–æ–∫: <b>{summary['average_win']/abs(summary['average_loss']):.2f}</b>

üéØ <b>–†–ï–ö–û–†–î–´ –ò –°–ï–†–ò–ò:</b>
‚Ä¢ –õ—É—á—à–∞—è —Å–¥–µ–ª–∫–∞: <b>{summary['best_trade']:.2f} USDT</b>
‚Ä¢ –•—É–¥—à–∞—è —Å–¥–µ–ª–∫–∞: <b>{summary['worst_trade']:.2f} USDT</b>
‚Ä¢ –°–µ—Ä–∏—è –ø–æ–±–µ–¥: <b>{summary['consecutive_wins']}</b>
‚Ä¢ –°–µ—Ä–∏—è –ø–æ—Ä–∞–∂–µ–Ω–∏–π: <b>{summary['consecutive_losses']}</b>

‚ö° <b>–≠–§–§–ï–ö–¢–ò–í–ù–û–°–¢–¨:</b>
‚Ä¢ Sharpe Ratio: <b>{summary.get('sharpe_ratio', 0):.2f}</b>
‚Ä¢ Expectancy: <b>{self._calculate_expectancy(summary):.2f} USDT</b>
‚Ä¢ ROI: <b>{self._calculate_roi(summary):.2f}%</b>
"""
        return report
    
    def generate_daily_report(self):
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–Ω–µ–≤–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞"""
        today = datetime.now().date()
        daily_data = self.metrics.daily_performance.get(today, {})
        
        trades_today = daily_data.get('trades', 0)
        profit_today = daily_data.get('profit', 0)
        winning_trades_today = daily_data.get('winning_trades', 0)
        losing_trades_today = daily_data.get('losing_trades', 0)
        
        win_rate_today = (winning_trades_today / trades_today * 100) if trades_today > 0 else 0
        
        report = f"""
üìÖ <b>–î–ù–ï–í–ù–û–ô –û–¢–ß–ï–¢</b>
‚è∞ –î–∞—Ç–∞: {today.strftime('%d.%m.%Y')}

üìä <b>–°–ï–ì–û–î–ù–Ø:</b>
‚Ä¢ –°–¥–µ–ª–æ–∫: <b>{trades_today}</b>
‚Ä¢ –ü—Ä–∏–±—ã–ª—å: <b>{profit_today:+.2f} USDT</b>
‚Ä¢ Win Rate: <b>{win_rate_today:.1f}%</b>
‚Ä¢ –ü—Ä–∏–±—ã–ª—å–Ω—ã—Ö: <b>{winning_trades_today}</b>
‚Ä¢ –£–±—ã—Ç–æ—á–Ω—ã—Ö: <b>{losing_trades_today}</b>

üìà <b>–û–ë–©–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê:</b>
‚Ä¢ –í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫: <b>{self.metrics.total_trades}</b>
‚Ä¢ –û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å: <b>{self.metrics.total_profit:.2f} USDT</b>
‚Ä¢ Win Rate: <b>{self.metrics.win_rate:.1f}%</b>
‚Ä¢ Profit Factor: <b>{self.metrics.profit_factor:.2f}</b>

üéØ <b>–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:</b>
{self._generate_recommendations()}
"""
        return report
    
    def generate_strategy_comparison(self, strategy_performance):
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π"""
        if not strategy_performance:
            return "üìä <b>–°–†–ê–í–ù–ï–ù–ò–ï –°–¢–†–ê–¢–ï–ì–ò–ô</b>\n\n–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è"
        
        report = "üìä <b>–°–†–ê–í–ù–ï–ù–ò–ï –°–¢–†–ê–¢–ï–ì–ò–ô</b>\n\n"
        
        for strategy, stats in strategy_performance.items():
            report += f"""
üéØ <b>{strategy}</b>
‚Ä¢ –°–¥–µ–ª–æ–∫: <b>{stats.get('trades', 0)}</b>
‚Ä¢ Win Rate: <b>{stats.get('win_rate', 0):.1f}%</b>
‚Ä¢ –ü—Ä–∏–±—ã–ª—å: <b>{stats.get('profit', 0):.2f} USDT</b>
‚Ä¢ Profit Factor: <b>{stats.get('profit_factor', 0):.2f}</b>
‚Ä¢ –ú–∞–∫—Å –ø—Ä–æ—Å–∞–¥–∫–∞: <b>{stats.get('max_drawdown', 0):.2f}%</b>
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
"""
        return report
    
    def generate_risk_report(self, risk_manager):
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –ø–æ —Ä–∏—Å–∫–∞–º"""
        risk_summary = risk_manager.get_risk_summary()
        
        report = f"""
‚ö° <b>–û–¢–ß–ï–¢ –ü–û –†–ò–°–ö–ê–ú</b>

üìä <b>–¢–ï–ö–£–©–ò–ï –†–ò–°–ö–ò:</b>
‚Ä¢ –î–Ω–µ–≤–Ω—ã–µ —É–±—ã—Ç–∫–∏: <b>{risk_summary['daily_losses']:.2f}%</b>
‚Ä¢ –ú–∞–∫—Å –¥–æ–ø—É—Å—Ç–∏–º–æ: <b>{risk_summary['max_daily_loss']:.2f}%</b>
‚Ä¢ –°–µ—Ä–∏—è —É–±—ã—Ç–∫–æ–≤: <b>{risk_summary['consecutive_losses']}</b>
‚Ä¢ –ú–∞–∫—Å –¥–æ–ø—É—Å—Ç–∏–º–æ: <b>{risk_summary['max_consecutive_losses']}</b>
‚Ä¢ –°–¥–µ–ª–æ–∫ —Å–µ–≥–æ–¥–Ω—è: <b>{risk_summary['trades_today']}</b>

üéØ <b>–°–¢–ê–¢–£–° –¢–û–†–ì–û–í–õ–ò:</b>
‚Ä¢ –¢–æ—Ä–≥–æ–≤–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∞: <b>{'‚úÖ –î–ê' if risk_manager.can_trade() else '‚ùå –ù–ï–¢'}</b>
‚Ä¢ –£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞: <b>{self._calculate_risk_level(risk_summary)}</b>

üí° <b>–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:</b>
{self._generate_risk_recommendations(risk_summary)}
"""
        return report
    
    def generate_ml_report(self, ml_model):
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –ø–æ ML –º–æ–¥–µ–ª–∏"""
        feature_importance = ml_model.get_feature_importance()
        
        report = f"""
ü§ñ <b>–û–¢–ß–ï–¢ –ü–û ML –ú–û–î–ï–õ–ò</b>

üìä <b>–°–¢–ê–¢–£–° –ú–û–î–ï–õ–ò:</b>
‚Ä¢ –û–±—É—á–µ–Ω–∞: <b>{'‚úÖ –î–ê' if ml_model.is_trained else '‚ùå –ù–ï–¢'}</b>
‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∏—á: <b>{len(feature_importance)}</b>

üéØ <b>–í–ê–ñ–ù–û–°–¢–¨ –§–ò–ß (–¢–û–ü-5):</b>
"""
        
        if feature_importance:
            top_features = list(feature_importance.items())[:5]
            for i, (feature, importance) in enumerate(top_features, 1):
                report += f"{i}. {feature}: <b>{importance:.3f}</b>\n"
        else:
            report += "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –≤–∞–∂–Ω–æ—Å—Ç–∏ —Ñ–∏—á\n"
        
        report += f"""
üìà <b>–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:</b>
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ–¥–µ–ª—å –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤
‚Ä¢ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ—Ä–æ–≥–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω–æ –ø–µ—Ä–µ–æ–±—É—á–∞–π—Ç–µ –º–æ–¥–µ–ª—å
"""
        return report
    
    def _get_period_name(self, period):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–µ—Ä–∏–æ–¥–∞"""
        periods = {
            'all': '–í—Å—ë –≤—Ä–µ–º—è',
            'week': '–ù–µ–¥–µ–ª—è',
            'month': '–ú–µ—Å—è—Ü',
            'year': '–ì–æ–¥'
        }
        return periods.get(period, '–í—Å—ë –≤—Ä–µ–º—è')
    
    def _calculate_expectancy(self, summary):
        """–†–∞—Å—á–µ—Ç –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–∂–∏–¥–∞–Ω–∏—è"""
        if summary['total_trades'] == 0:
            return 0
        return (summary['win_rate']/100 * summary['average_win'] + 
                (1 - summary['win_rate']/100) * summary['average_loss'])
    
    def _calculate_roi(self, summary):
        """–†–∞—Å—á–µ—Ç ROI"""
        if summary['total_trades'] == 0:
            return 0
        return (summary['total_profit'] / summary['total_trades'])
    
    def _calculate_risk_level(self, risk_summary):
        """–†–∞—Å—á–µ—Ç —É—Ä–æ–≤–Ω—è —Ä–∏—Å–∫–∞"""
        daily_risk = risk_summary['daily_losses'] / risk_summary['max_daily_loss']
        consecutive_risk = risk_summary['consecutive_losses'] / risk_summary['max_consecutive_losses']
        
        max_risk = max(daily_risk, consecutive_risk)
        
        if max_risk < 0.3:
            return "üü¢ –ù–ò–ó–ö–ò–ô"
        elif max_risk < 0.7:
            return "üü° –°–†–ï–î–ù–ò–ô"
        else:
            return "üî¥ –í–´–°–û–ö–ò–ô"
    
    def _generate_recommendations(self):
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏"""
        recommendations = []
        
        if self.metrics.total_trades < 10:
            recommendations.append("‚Ä¢ –ù–∞–∫–æ–ø–∏—Ç–µ –±–æ–ª—å—à–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–µ—Ä–µ–¥ –∞–Ω–∞–ª–∏–∑–æ–º")
        
        if self.metrics.win_rate < 40:
            recommendations.append("‚Ä¢ –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏")
        elif self.metrics.win_rate > 60:
            recommendations.append("‚Ä¢ –û—Ç–ª–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã! –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ")
        
        if self.metrics.profit_factor < 1.0:
            recommendations.append("‚Ä¢ –£–≤–µ–ª–∏—á—å—Ç–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –ø—Ä–∏–±—ã–ª—å/—É–±—ã—Ç–æ–∫")
        
        if self.metrics.max_drawdown > 10:
            recommendations.append("‚Ä¢ –£–º–µ–Ω—å—à–∏—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –ø—Ä–æ—Å–∞–¥–∫—É")
        
        if not recommendations:
            recommendations.append("‚Ä¢ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ –Ω–æ—Ä–º–µ, –ø—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Ç–æ—Ä–≥–æ–≤–ª—é")
        
        return "\n".join(recommendations)
    
    def _generate_risk_recommendations(self, risk_summary):
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ —Ä–∏—Å–∫–∞–º"""
        recommendations = []
        
        if risk_summary['daily_losses'] > risk_summary['max_daily_loss'] * 0.8:
            recommendations.append("‚Ä¢ –ë–ª–∏–∑–∫–æ –∫ –¥–Ω–µ–≤–Ω–æ–º—É –ª–∏–º–∏—Ç—É –ø–æ—Ç–µ—Ä—å")
        
        if risk_summary['consecutive_losses'] > risk_summary['max_consecutive_losses'] * 0.8:
            recommendations.append("‚Ä¢ –ë–ª–∏–∑–∫–æ –∫ –ª–∏–º–∏—Ç—É —É–±—ã—Ç–æ—á–Ω—ã—Ö —Å–¥–µ–ª–æ–∫ –ø–æ–¥—Ä—è–¥")
        
        if risk_summary['trades_today'] > 10:
            recommendations.append("‚Ä¢ –ú–Ω–æ–≥–æ —Å–¥–µ–ª–æ–∫ —Å–µ–≥–æ–¥–Ω—è, –±—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã")
        
        if not recommendations:
            recommendations.append("‚Ä¢ –†–∏—Å–∫–∏ –ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º")
        
        return "\n".join(recommendations)
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: analytics\__init__.py
[FILE_CONTENT_BEGIN]
"""
–ê–ù–ê–õ–ò–¢–ò–ö–ê –ò –û–¢–ß–ï–¢–ù–û–°–¢–¨
"""
from .metrics import AnalyticsMetrics
from .reporter import ReportGenerator

__all__ = ['AnalyticsMetrics', 'ReportGenerator']
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: config\constants.py
[FILE_CONTENT_BEGIN]
"""
–ö–û–ù–°–¢–ê–ù–¢–´ –ü–†–û–ï–ö–¢–ê
"""

# –¢–æ—Ä–≥–æ–≤—ã–µ –ø–∞—Ä—ã
TRADING_PAIRS = {
    'BTC/USDT': '‚Çø Bitcoin',
    'ETH/USDT': 'Œû Ethereum',
    'SOL/USDT': '‚óé Solana',
    'ADA/USDT': '‚Ç≥ Cardano',
    'DOT/USDT': '‚óè Polkadot',
    'LINK/USDT': 'üîó Chainlink'
}

# üîß –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–º—ã —Ç–æ—Ä–≥–æ–≤–ª–∏ –¥–ª—è KuCoin
MIN_TRADE_AMOUNTS = {
    'BTC/USDT': 0.00001,  # üîß –ò–°–ü–†–ê–í–õ–ï–ù–û: 0.00001 BTC
    'ETH/USDT': 0.001,
    'SOL/USDT': 0.1,
    'ADA/USDT': 1.0,
    'DOT/USDT': 0.1,
    'LINK/USDT': 0.1
}

MIN_TRADE_USDT = 0.1  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤ USDT

# –°—Ç—Ä–∞—Ç–µ–≥–∏–∏
STRATEGIES = {
    'ema_ml': 'üìà EMA + ML',
    'price_action': '‚ö° Price Action',
    'macd_rsi': 'üéØ MACD + RSI',
    'bollinger': 'üìä Bollinger Bands',
    'hybrid': 'üîÑ –ì–∏–±—Ä–∏–¥–Ω–∞—è'
}

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
DEFAULT_SETTINGS = {
    'symbol': 'BTC/USDT',
    'trade_amount_percent': 0.1,  # üîß –í–û–ó–í–†–ê–©–ê–ï–ú 10% - —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
    'ema_cross_threshold': 0.005,
    'price_update_frequency': 300,
    'enable_price_updates': True,
    'enable_trade_signals': True,
    'demo_mode': True,
    'trading_enabled': True,
}

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ML –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
DEFAULT_ML_SETTINGS = {
    'enabled': True,
    'confidence_threshold_buy': 0.4,
    'confidence_threshold_sell': 0.3,
    'retrain_frequency_hours': 24
}

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∏—Å–∫–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
DEFAULT_RISK_SETTINGS = {
    'max_daily_loss': 3.0,
    'stop_loss': 1.5,
    'take_profit': 3.0,
    'max_position_size': 25.0,
    'max_consecutive_losses': 3,
    'volatility_limit': 5.0,
    'min_trade_amount_usdt': 0.1  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ —Å–¥–µ–ª–∫–∏
}

# –¢–∞–π–º—Ñ—Ä–µ–π–º—ã
TIMEFRAMES = {
    '1m': '1 –º–∏–Ω—É—Ç–∞',
    '5m': '5 –º–∏–Ω—É—Ç',
    '15m': '15 –º–∏–Ω—É—Ç',
    '1h': '1 —á–∞—Å',
    '4h': '4 —á–∞—Å–∞',
    '1d': '1 –¥–µ–Ω—å'
}

# –°–æ–æ–±—â–µ–Ω–∏—è
MESSAGES = {
    'start': "ü§ñ <b>–¢–û–†–ì–û–í–´–ô –ë–û–¢ –ê–ö–¢–ò–í–ò–†–û–í–ê–ù</b>",
    'error': "‚ùå –û—à–∏–±–∫–∞",
    'processing': "‚è≥ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é –∑–∞–ø—Ä–æ—Å...",
    'success': "‚úÖ –£—Å–ø–µ—à–Ω–æ",
    'insufficient_funds': "‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤",
    'min_trade_amount': f"‚ùå –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ —Å–¥–µ–ª–∫–∏: {MIN_TRADE_USDT} USDT"
}
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: config\settings.py
[FILE_CONTENT_BEGIN]
"""
–£–ü–†–ê–í–õ–ï–ù–ò–ï –ù–ê–°–¢–†–û–ô–ö–ê–ú–ò
"""
import json
import os
from dotenv import load_dotenv
from .constants import DEFAULT_SETTINGS, DEFAULT_ML_SETTINGS, DEFAULT_RISK_SETTINGS, STRATEGIES, TRADING_PAIRS

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
load_dotenv()

class SettingsManager:
    def __init__(self):
        self.settings_file = 'bot_settings.json'
        self.settings = DEFAULT_SETTINGS.copy()
        self.strategy_settings = {
            'active_strategy': 'ema_ml',
            'available_strategies': STRATEGIES
        }
        self.trading_pairs = {
            'active_pair': 'BTC/USDT',
            'available_pairs': TRADING_PAIRS
        }
        self.ml_settings = DEFAULT_ML_SETTINGS.copy()
        self.risk_settings = DEFAULT_RISK_SETTINGS.copy()
        
        # –î–æ–±–∞–≤–ª—è–µ–º Telegram –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ .env
        self.settings['telegram_token'] = os.getenv('TELEGRAM_BOT_TOKEN', '')
        self.settings['telegram_chat_id'] = os.getenv('TELEGRAM_CHAT_ID', '')
        
        self.load_settings()

    def load_settings(self):
        """–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–∑ —Ñ–∞–π–ª–∞"""
        try:
            if os.path.exists(self.settings_file):
                with open(self.settings_file, 'r', encoding='utf-8') as f:
                    saved_settings = json.load(f)
                    
                    # –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                    self.settings.update(saved_settings.get('settings', {}))
                    self.strategy_settings.update(saved_settings.get('strategy_settings', self.strategy_settings))
                    self.trading_pairs.update(saved_settings.get('trading_pairs', self.trading_pairs))
                    self.ml_settings.update(saved_settings.get('ml_settings', {}))
                    self.risk_settings.update(saved_settings.get('risk_settings', {}))
                    
                print("‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã")
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫: {e}")

    def save_settings(self):
        """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ —Ñ–∞–π–ª"""
        try:
            settings_to_save = {
                'settings': self.settings,
                'strategy_settings': self.strategy_settings,
                'trading_pairs': self.trading_pairs,
                'ml_settings': self.ml_settings,
                'risk_settings': self.risk_settings
            }
            
            with open(self.settings_file, 'w', encoding='utf-8') as f:
                json.dump(settings_to_save, f, indent=2, ensure_ascii=False)
                
            print("‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã")
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫: {e}")

    def update_setting(self, category, key, value):
        """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"""
        try:
            if category == 'main':
                self.settings[key] = value
            elif category == 'strategy':
                self.strategy_settings[key] = value
            elif category == 'trading_pairs':
                self.trading_pairs[key] = value
            elif category == 'ml':
                self.ml_settings[key] = value
            elif category == 'risk':
                self.risk_settings[key] = value
            
            self.save_settings()
            return True
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏: {e}")
            return False

    def get_active_strategy_name(self):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏"""
        return self.strategy_settings['available_strategies'].get(
            self.strategy_settings['active_strategy'],
            '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è'
        )

    def get_active_pair_name(self):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ–π –ø–∞—Ä—ã"""
        return self.trading_pairs['available_pairs'].get(
            self.trading_pairs['active_pair'],
            '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –ø–∞—Ä–∞'
        )
    
    def is_telegram_configured(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram"""
        return bool(self.settings.get('telegram_token') and self.settings.get('telegram_chat_id'))
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: config\__init__.py
[FILE_CONTENT_BEGIN]
"""
–ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ü–†–û–ï–ö–¢–ê
"""
from .constants import *
from .settings import SettingsManager

__all__ = ['TRADING_PAIRS', 'STRATEGIES', 'DEFAULT_SETTINGS', 'DEFAULT_ML_SETTINGS', 
           'DEFAULT_RISK_SETTINGS', 'TIMEFRAMES', 'MESSAGES', 'SettingsManager']
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: core\bot.py
[FILE_CONTENT_BEGIN]
"""
–û–°–ù–û–í–ù–û–ô –ö–õ–ê–°–° –ë–û–¢–ê
"""
import threading
import time
import json
import os
from datetime import datetime
from config.settings import SettingsManager
from core.exchange import ExchangeManager
from core.risk_manager import RiskManager
from analytics.metrics import AnalyticsMetrics
from ml.model import MLModel
from telegram.bot import TelegramBot
from strategies.ema_ml import EmaMlStrategy
from strategies.price_action import PriceActionStrategy
from strategies.macd_rsi import MacdRsiStrategy
from strategies.bollinger import BollingerStrategy
from utils.logger import log_info, log_error

class AdvancedTradingBot:
    def __init__(self):
        """–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞"""
        # –ë–´–°–¢–†–ê–Ø –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
        self.settings = SettingsManager()
        self.exchange = ExchangeManager() 
        self.risk_manager = RiskManager(self.settings.risk_settings)
        self.metrics = AnalyticsMetrics()
        # –°–æ—Å—Ç–æ—è–Ω–∏–µ –±–æ—Ç–∞
        self.position = None
        self.entry_price = 0
        self.last_signal = None
        self.last_price = None
        self.is_running = True
        # –†–∞–∑–º–µ—Ä —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏ –≤ USDT (—Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏)
        self.current_position_size_usdt = 0
        # –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–¥–µ–ª–∫–∏ (–¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —á–∞—Å—Ç—ã—Ö —Å–¥–µ–ª–æ–∫)
        self.last_trade_time = 0
        # –°—Ä–∞–∑—É –∑–∞–ø—É—Å–∫–∞–µ–º Telegram –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –æ—Ç–∫–ª–∏–∫–∞
        self.telegram = TelegramBot(self)
        # –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ (–±—ã—Å—Ç—Ä–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è)
        self.strategies = {
            'ema_ml': EmaMlStrategy(),
            'price_action': PriceActionStrategy(), 
            'macd_rsi': MacdRsiStrategy(),
            'bollinger': BollingerStrategy()
        }
        # üî¥ –ü–û –£–ú–û–õ–ß–ê–ù–ò–Æ –¢–û–†–ì–û–í–õ–Ø –û–¢–ö–õ–Æ–ß–ï–ù–ê
        if 'trading_enabled' not in self.settings.settings:
            self.settings.settings['trading_enabled'] = False
            self.settings.save_settings()
            log_info("‚ö†Ô∏è –¢–æ—Ä–≥–æ–≤–ª—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Ç–∫–ª—é—á–µ–Ω–∞. –í–∫–ª—é—á–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.")
        else:
            log_info(f"‚öôÔ∏è –¢–æ—Ä–≥–æ–≤–ª—è: {'–í–ö–õ–Æ–ß–ï–ù–ê' if self.settings.settings['trading_enabled'] else '–û–¢–ö–õ–Æ–ß–ï–ù–ê'}")
        log_info("‚ö° –ë–æ—Ç –±—ã—Å—Ç—Ä–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω, ML –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ —Ñ–æ–Ω–µ...")
        # ML –≤ —Ñ–æ–Ω–µ - –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å—Ç–∞—Ä—Ç
        self.ml_model = MLModel()
        self.start_background_ml()
        # üü¢ –ó–ê–ì–†–£–ñ–ê–ï–ú –°–û–°–¢–û–Ø–ù–ò–ï –ü–û–ó–ò–¶–ò–ò –ò–ó –§–ê–ô–õ–ê
        self.load_position_state()

    def start_background_ml(self):
        """–§–æ–Ω–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ ML"""
        def ml_worker():
            if self.settings.ml_settings['enabled']:
                if not self.ml_model.load_model():
                    log_info("ü§ñ –§–æ–Ω–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ ML...")
                    # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–µ–≥–∫–∏–π —Ä–µ–∂–∏–º –æ–±—É—á–µ–Ω–∏—è
                    self.ml_model.train(self.exchange.exchange, limit=80)
                else:
                    log_info("‚úÖ ML –º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑ –∫—ç—à–∞")
            else:
                log_info("ü§ñ ML –æ—Ç–∫–ª—é—á–µ–Ω –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö")
        threading.Thread(target=ml_worker, daemon=True).start()

    def get_active_strategy(self):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏"""
        strategy_name = self.settings.strategy_settings['active_strategy']
        strategy = self.strategies.get(strategy_name, self.strategies['ema_ml'])
        # üîß –û–ë–ù–û–í–õ–Ø–ï–ú –ù–ê–°–¢–†–û–ô–ö–ò –°–¢–†–ê–¢–ï–ì–ò–ò –ò–ó –ú–ï–ù–ï–î–ñ–ï–†–ê –ù–ê–°–¢–†–û–ï–ö
        if strategy_name == 'ema_ml':
            strategy.settings.update({
                'ema_threshold': self.settings.settings.get('ema_cross_threshold', 0.005),
                'ml_confidence_buy': self.settings.ml_settings.get('confidence_threshold_buy', 0.4),
                'ml_confidence_sell': self.settings.ml_settings.get('confidence_threshold_sell', 0.3)
            })
        return strategy

    def execute_trading_cycle(self):
        """–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏"""
        try:
            # üîß –ü–†–û–í–ï–†–ö–ê: —Ä–∞–∑—Ä–µ—à–µ–Ω–∞ –ª–∏ —Ç–æ—Ä–≥–æ–≤–ª—è
            if not self.settings.settings.get('trading_enabled', False):
                log_info("‚è∏Ô∏è –¢–æ—Ä–≥–æ–≤–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö")
                return
            # üîß –ü–†–û–í–ï–†–ö–ê: –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ —Å—Ä–µ–¥—Å—Ç–≤
            balance = self.exchange.get_balance()
            if not balance or balance['free_usdt'] < 0.1:  # –ú–∏–Ω–∏–º—É–º 0.1 USDT
                log_info("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏ (–º–∏–Ω–∏–º—É–º 0.1 USDT)")
                return
            # –ü–æ–ª—É—á–∞–µ–º —Ä—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            symbol = self.settings.trading_pairs['active_pair']
            market_data = self.exchange.get_market_data(symbol)
            if not market_data:
                log_info("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ä—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ")
                return
            # –ü–æ–ª—É—á–∞–µ–º ML –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ (–µ—Å–ª–∏ –º–æ–¥–µ–ª—å –≥–æ—Ç–æ–≤–∞)
            ml_confidence, ml_signal = 0.5, "‚ö™ ML –ó–ê–ì–†–£–ó–ö–ê"
            if self.ml_model.is_trained:
                ml_confidence, ml_signal = self.ml_model.predict(market_data.get('ohlcv', []))
            # –ü–æ–ª—É—á–∞–µ–º —Å–∏–≥–Ω–∞–ª –æ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
            strategy = self.get_active_strategy()
            # üí∞ –†–ê–°–ß–ï–¢ –†–ê–ó–ú–ï–†–ê –ü–û–ó–ò–¶–ò–ò –° –£–ß–ï–¢–û–ú –ú–ò–ù–ò–ú–ê–õ–¨–ù–û–ì–û –û–ë–™–ï–ú–ê
            trade_amount_percent = self.settings.settings['trade_amount_percent']
            initial_position_size_usdt = balance['free_usdt'] * trade_amount_percent
            # üîß –†–ê–°–ß–ï–¢ –ú–ò–ù–ò–ú–ê–õ–¨–ù–û–ì–û –†–ê–ó–ú–ï–†–ê –°–¢–ê–í–ö–ò –î–õ–Ø –î–ê–ù–ù–û–ô –ü–ê–†–´
            min_amount = self.get_min_amount(symbol)
            min_position_usdt = min_amount * market_data['current_price']
            log_info(f"üí∞ –ú–ò–ù–ò–ú–ê–õ–¨–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø: {min_amount:.6f} {symbol.split('/')[0]} = {min_position_usdt:.2f} USDT")
            log_info(f"üí∞ –†–ê–°–ß–ï–¢–ù–ê–Ø –°–¢–ê–í–ö–ê: {initial_position_size_usdt:.2f} USDT ({trade_amount_percent*100:.1f}% –æ—Ç –±–∞–ª–∞–Ω—Å–∞)")
            # üîß –ï–°–õ–ò –†–ê–°–ß–ï–¢–ù–´–ô –†–ê–ó–ú–ï–† –ú–ï–ù–¨–®–ï –ú–ò–ù–ò–ú–ê–õ–¨–ù–û–ì–û - –ò–°–ü–û–õ–¨–ó–£–ï–ú –ú–ò–ù–ò–ú–ê–õ–¨–ù–´–ô
            position_size_usdt = initial_position_size_usdt
            if initial_position_size_usdt < min_position_usdt:
                if balance['free_usdt'] >= min_position_usdt:
                    position_size_usdt = min_position_usdt
                    log_info(f"üí∞ –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—Ç–∞–≤–∫—É –¥–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π: {position_size_usdt:.2f} USDT")
                else:
                    log_info(f"‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Å—Ç–∞–≤–∫–∏. –ù—É–∂–Ω–æ: {min_position_usdt:.2f} USDT, –µ—Å—Ç—å: {balance['free_usdt']:.2f} USDT")
                    return
            # üîß –ü–†–û–í–ï–†–ö–ê –ú–ò–ù–ò–ú–ê–õ–¨–ù–û–ì–û –û–ë–™–ï–ú–ê KUCOIN (0.1 USDT)
            if position_size_usdt < 0.1:
                log_info(f"‚ö†Ô∏è –†–∞–∑–º–µ—Ä —Å—Ç–∞–≤–∫–∏ {position_size_usdt:.2f} USDT –º–µ–Ω—å—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ 0.1 USDT KuCoin")
                return
            signal = strategy.calculate_signal(
                market_data, 
                ml_confidence, 
                ml_signal,
                position_size_usdt=position_size_usdt
            )
            # üîç –î–ò–ê–ì–ù–û–°–¢–ò–ß–ï–°–ö–û–ï –õ–û–ì–ò–†–û–í–ê–ù–ò–ï
            log_info("üîç === –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –¢–û–†–ì–û–í–û–ì–û –¶–ò–ö–õ–ê ===")
            log_info(f"üìä –†–´–ù–û–ß–ù–´–ï –î–ê–ù–ù–´–ï: —Ü–µ–Ω–∞={market_data['current_price']:.2f}, EMA_diff={market_data.get('ema_diff_percent', 0):.4f}")
            log_info(f"ü§ñ ML –î–ê–ù–ù–´–ï: confidence={ml_confidence:.3f}, signal='{ml_signal}'")
            log_info(f"üí∞ –ë–ê–õ–ê–ù–°: —Å–≤–æ–±–æ–¥–Ω–æ={balance['free_usdt']:.2f} USDT, —Å—Ç–∞–≤–∫–∞={position_size_usdt:.2f} USDT")
            log_info(f"ü§ñ –ü–û–ó–ò–¶–ò–Ø: {self.position}, last_signal='{self.last_signal}'")
            if hasattr(strategy, 'settings'):
                ema_threshold = strategy.settings.get('ema_threshold', 0.005)
                ml_buy_threshold = strategy.settings.get('ml_confidence_buy', 0.4)
                log_info(f"‚öôÔ∏è –ü–ê–†–ê–ú–ï–¢–†–´ –°–¢–†–ê–¢–ï–ì–ò–ò: EMA_threshold={ema_threshold:.4f}, ML_buy_threshold={ml_buy_threshold:.2f}")
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∏—Å–∫–∏
            risk_ok, risk_message = self.risk_manager.check_trade_risk(
                signal, 
                market_data['current_price'],
                (position_size_usdt / balance['free_usdt']) * 100 if balance['free_usdt'] > 0 else 0,
                market_data
            )
            log_info(f"‚ö° –ü–†–û–í–ï–†–ö–ê –†–ò–°–ö–û–í: risk_ok={risk_ok}, message='{risk_message}'")
            # üîß –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –õ–û–ì–ò–ö–ê –ü–†–û–í–ï–†–ö–ò –°–ò–ì–ù–ê–õ–û–í
            should_execute = False
            execution_reason = ""
            if risk_ok and signal != 'wait':
                # üîß –ó–ê–©–ò–¢–ê –û–¢ –ß–ê–°–¢–´–• –°–î–ï–õ–û–ö (–º–∏–Ω–∏–º—É–º 60 —Å–µ–∫—É–Ω–¥ –º–µ–∂–¥—É —Å–¥–µ–ª–∫–∞–º–∏)
                current_time = time.time()
                time_since_last_trade = current_time - self.last_trade_time
                min_trade_interval = 60  # 60 —Å–µ–∫—É–Ω–¥
                if time_since_last_trade < min_trade_interval:
                    log_info(f"‚è∞ –°–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ –¥–ª—è –Ω–æ–≤–æ–π —Å–¥–µ–ª–∫–∏: {time_since_last_trade:.0f} —Å–µ–∫ < {min_trade_interval} —Å–µ–∫")
                    should_execute = False
                    execution_reason = "–°–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã–µ —Å–¥–µ–ª–∫–∏"
                elif signal == 'buy' and self.position != 'long':
                    # –°–∏–≥–Ω–∞–ª –Ω–∞ –ø–æ–∫—É–ø–∫—É –∏ –ø–æ–∑–∏—Ü–∏—è –Ω–µ –æ—Ç–∫—Ä—ã—Ç–∞
                    should_execute = True
                    execution_reason = "–û—Ç–∫—Ä—ã—Ç–∏–µ LONG –ø–æ–∑–∏—Ü–∏–∏"
                    log_info(f"üöÄ –£–°–õ–û–í–ò–Ø –ü–û–ö–£–ü–ö–ò –í–´–ü–û–õ–ù–ï–ù–´: signal='{signal}', position='{self.position}'")
                elif signal == 'sell' and self.position == 'long':
                    # –°–∏–≥–Ω–∞–ª –Ω–∞ –ø—Ä–æ–¥–∞–∂—É –∏ –ø–æ–∑–∏—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞
                    should_execute = True
                    execution_reason = "–ó–∞–∫—Ä—ã—Ç–∏–µ LONG –ø–æ–∑–∏—Ü–∏–∏"
                    log_info(f"üöÄ –£–°–õ–û–í–ò–Ø –ü–†–û–î–ê–ñ–ò –í–´–ü–û–õ–ù–ï–ù–´: signal='{signal}', position='{self.position}'")
                else:
                    execution_reason = f"–ù–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞ –∏ –ø–æ–∑–∏—Ü–∏–∏ (signal: {signal}, position: {self.position})"
                    log_info(f"üîç –°–ò–ì–ù–ê–õ –ü–†–û–ü–£–©–ï–ù: {execution_reason}")
            else:
                execution_reason = f"–†–∏—Å–∫–∏ –Ω–µ –ø—Ä–æ–π–¥–µ–Ω—ã –∏–ª–∏ —Å–∏–≥–Ω–∞–ª 'wait' (risk_ok: {risk_ok}, signal: {signal})"
            # –ò—Å–ø–æ–ª–Ω—è–µ–º —Å–¥–µ–ª–∫—É –µ—Å–ª–∏ –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã
            if should_execute:
                log_info(f"üöÄ –í–´–ü–û–õ–ù–Ø–ï–ú –°–î–ï–õ–ö–£: {signal} - {execution_reason}")
                self.execute_trade(signal, market_data, ml_confidence, ml_signal, position_size_usdt)
                # üîß –û–ë–ù–û–í–õ–Ø–ï–ú LAST_SIGNAL –ò –í–†–ï–ú–Ø –°–î–ï–õ–ö–ò –¢–û–õ–¨–ö–û –ü–†–ò –í–´–ü–û–õ–ù–ï–ù–ò–ò –°–î–ï–õ–ö–ò
                self.last_signal = signal
                self.last_trade_time = time.time()
            else:
                log_info(f"üîç –°–î–ï–õ–ö–ê –ù–ï –í–´–ü–û–õ–ù–ï–ù–ê: {execution_reason}")
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä—ã–Ω–∫–∞
            self.telegram.send_market_update(market_data, signal, ml_confidence, ml_signal)
        except Exception as e:
            log_error(f"‚ùå –û—à–∏–±–∫–∞ –≤ —Ç–æ—Ä–≥–æ–≤–æ–º —Ü–∏–∫–ª–µ: {e}")

    def execute_trade(self, signal, market_data, ml_confidence, ml_signal, position_size_usdt):
        """–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ä–∞–∑–º–µ—Ä–µ –ø–æ–∑–∏—Ü–∏–∏"""
        try:
            strategy = self.get_active_strategy()
            symbol = self.settings.trading_pairs['active_pair']
            current_price = market_data['current_price']
            if signal == 'buy' and self.position != 'long':
                # –õ–æ–≥–∏–∫–∞ –ø–æ–∫—É–ø–∫–∏
                self.position = 'long'
                # ‚ùó –§–ò–ö–°–ò–†–£–ï–ú –†–ê–ó–ú–ï–† –ü–û–ó–ò–¶–ò–ò –í USDT –ü–†–ò –û–¢–ö–†–´–¢–ò–ò!
                self.current_position_size_usdt = position_size_usdt
                if not self.settings.settings['demo_mode']:
                    # –†–µ–∞–ª—å–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è
                    amount = position_size_usdt / current_price  # –†–∞—Å—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –º–æ–Ω–µ—Ç
                    order, message = self.exchange.create_order(
                        symbol, 'market', 'buy', amount
                    )
                    if not order:
                        log_info(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ä–¥–µ—Ä–∞: {message}")
                        return
                    log_info(f"‚úÖ –†–µ–∞–ª—å–Ω—ã–π –æ—Ä–¥–µ—Ä —Å–æ–∑–¥–∞–Ω: {order['id']}")
                    # –í —Ä–µ–∞–ª—å–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ü–µ–Ω—É –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ä–¥–µ—Ä–∞
                    executed_price = current_price
                else:
                    # –î–µ–º–æ-—Ä–µ–∂–∏–º
                    order = {'id': 'demo_buy', 'status': 'closed'}
                    message = f"–î–ï–ú–û-–†–ï–ñ–ò–ú | –†–∞–∑–º–µ—Ä —Å—Ç–∞–≤–∫–∏: {position_size_usdt:.2f} USDT"
                    executed_price = current_price
                    log_info("‚úÖ –î–µ–º–æ-–ø–æ–∫—É–ø–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞")
                # –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–∑–∏—Ü–∏–∏ –≤ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
                strategy.update_position_info(signal, executed_price)
                # –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç—Ä–∏–∫–∏
                trade_result = {
                    'symbol': symbol,
                    'signal': 'buy',
                    'price': executed_price,
                    'profit': 0,
                    'profit_percent': 0,
                    'position_size': trade_amount_percent * 100,
                    'position_size_usdt': position_size_usdt
                }
                self.metrics.update_metrics(trade_result)
                self.risk_manager.update_after_trade(trade_result)
                # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –≤ —Ñ–∞–π–ª
                self.save_position_state()
                # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                self.telegram.send_trade_signal(
                    signal, market_data, ml_confidence, ml_signal, 
                    strategy.name, message, position_size_usdt
                )
            elif signal == 'sell' and self.position == 'long':
                # –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–¥–∞–∂–∏
                profit_percent = 0
                profit_usdt = 0
                if not self.settings.settings['demo_mode']:
                    # –†–µ–∞–ª—å–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è
                    amount = position_size_usdt / strategy.entry_price  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—É–ø–ª–µ–Ω–Ω—ã—Ö –º–æ–Ω–µ—Ç
                    order, message = self.exchange.create_order(
                        symbol, 'market', 'sell', amount
                    )
                    if not order:
                        log_info(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ä–¥–µ—Ä–∞ –ø—Ä–æ–¥–∞–∂–∏: {message}")
                        return
                    log_info(f"‚úÖ –†–µ–∞–ª—å–Ω—ã–π –æ—Ä–¥–µ—Ä –ø—Ä–æ–¥–∞–∂–∏ —Å–æ–∑–¥–∞–Ω: {order['id']}")
                    executed_price = current_price
                else:
                    # –î–µ–º–æ-—Ä–µ–∂–∏–º
                    order = {'id': 'demo_sell', 'status': 'closed'}
                    message = f"–î–ï–ú–û-–†–ï–ñ–ò–ú | –ü—Ä–∏–±—ã–ª—å: {profit_usdt:+.2f} USDT"
                    executed_price = current_price
                    log_info("‚úÖ –î–µ–º–æ-–ø—Ä–æ–¥–∞–∂–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞")
                # –†–∞—Å—á–µ—Ç –ø—Ä–∏–±—ã–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–∑ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
                if strategy.entry_price > 0:
                    profit_percent = ((executed_price - strategy.entry_price) / strategy.entry_price) * 100
                    profit_usdt = self.current_position_size_usdt * (profit_percent / 100)
                # –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–∑–∏—Ü–∏–∏ –≤ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
                strategy.update_position_info(signal, executed_price)
                # –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç—Ä–∏–∫–∏
                trade_result = {
                    'symbol': symbol,
                    'signal': 'sell',
                    'price': executed_price,
                    'profit': profit_percent,
                    'profit_percent': profit_percent,
                    'position_size': trade_amount_percent * 100,
                    'position_size_usdt': position_size_usdt,
                    'profit_usdt': profit_usdt
                }
                self.metrics.update_metrics(trade_result)
                self.risk_manager.update_after_trade(trade_result)
                # –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é
                self.position = None
                self.current_position_size_usdt = 0
                self.entry_price = 0
                # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –≤ —Ñ–∞–π–ª (–ø–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞)
                self.save_position_state()
                # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                self.telegram.send_trade_signal(
                    signal, market_data, ml_confidence, ml_signal,
                    strategy.name, message, position_size_usdt, profit_usdt
                )
        except Exception as e:
            log_error(f"‚ùå –û—à–∏–±–∫–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è —Å–¥–µ–ª–∫–∏: {e}")

    def get_min_amount(self, symbol):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–ª—è —Ç–æ—Ä–≥–æ–≤–æ–π –ø–∞—Ä—ã"""
        min_amounts = {
            'BTC/USDT': 0.00001,
            'ETH/USDT': 0.001,
            'SOL/USDT': 0.1,
            'ADA/USDT': 1.0,
            'DOT/USDT': 0.1,
            'LINK/USDT': 0.1
        }
        return min_amounts.get(symbol, 0.001)

    def calculate_trade_amount(self):
        """–†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ —Å–¥–µ–ª–∫–∏"""
        balance = self.exchange.get_balance()
        if balance and balance['free_usdt'] > 0:
            return balance['free_usdt'] * self.settings.settings['trade_amount_percent']
        return 0

    def run(self):
        """–û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞ - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø"""
        log_info("üöÄ –ó–ê–ü–£–°–ö –û–°–ù–û–í–ù–û–ì–û –¶–ò–ö–õ–ê –ë–û–¢–ê")
        last_balance_check = time.time()
        cycle_count = 0
        while self.is_running:
            try:
                cycle_count += 1
                log_info(f"üîÑ –¶–∏–∫–ª #{cycle_count} –∑–∞–ø—É—â–µ–Ω")
                if self.settings.settings.get('trading_enabled', False):
                    log_info("üîç –í—ã–ø–æ–ª–Ω—è–µ–º —Ç–æ—Ä–≥–æ–≤—ã–π —Ü–∏–∫–ª...")
                    self.execute_trading_cycle()
                    log_info("‚úÖ –¢–æ—Ä–≥–æ–≤—ã–π —Ü–∏–∫–ª –∑–∞–≤–µ—Ä—à–µ–Ω")
                else:
                    log_info("‚è∏Ô∏è –¢–æ—Ä–≥–æ–≤–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö")
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
                current_time = time.time()
                if current_time - last_balance_check > 300:  # 5 –º–∏–Ω—É—Ç
                    log_info("üí∞ –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞...")
                    self.telegram.send_balance_update()
                    last_balance_check = current_time
                log_info(f"üí§ –ü–∞—É–∑–∞ 30 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–∏–º —Ü–∏–∫–ª–æ–º...")
                time.sleep(30)
            except KeyboardInterrupt:
                log_info("üõë –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (Ctrl+C)")
                self.stop()
                break
            except Exception as e:
                log_error(f"‚ùå –û—à–∏–±–∫–∞ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ: {e}")
                log_info("üí§ –ü–∞—É–∑–∞ 60 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–æ–π...")
                time.sleep(60)
        log_info("üîö –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –±–æ—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω")

    def stop(self):
        """–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞"""
        self.is_running = False
        log_info("üõë –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")

    # üìÅ –ú–ï–¢–û–î–´ –°–û–•–†–ê–ù–ï–ù–ò–Ø –ò –ó–ê–ì–†–£–ó–ö–ò –°–û–°–¢–û–Ø–ù–ò–Ø –ü–û–ó–ò–¶–ò–ò
    def save_position_state(self):
        """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –≤ —Ñ–∞–π–ª"""
        state = {
            'position': self.position,
            'entry_price': self.entry_price,
            'position_size_usdt': self.current_position_size_usdt,
            'symbol': self.settings.trading_pairs['active_pair'],
            'opened_at': self.last_trade_time
        }
        with open('position_state.json', 'w') as f:
            json.dump(state, f, indent=2)
        log_info("üíæ –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ —Ñ–∞–π–ª")

    def load_position_state(self):
        """–ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –∏–∑ —Ñ–∞–π–ª–∞"""
        try:
            if os.path.exists('position_state.json'):
                with open('position_state.json', 'r') as f:
                    state = json.load(f)
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ —Ç–∞ –∂–µ —Ç–æ—Ä–≥–æ–≤–∞—è –ø–∞—Ä–∞
                if state.get('symbol') == self.settings.trading_pairs['active_pair']:
                    self.position = state.get('position')
                    self.entry_price = state.get('entry_price', 0)
                    self.current_position_size_usdt = state.get('position_size_usdt', 0)
                    self.last_trade_time = state.get('opened_at', 0)
                    if self.position == 'long':
                        log_info(f"‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∞—è –ø–æ–∑–∏—Ü–∏—è: –≤—Ö–æ–¥ {self.entry_price:.2f} USDT, —Ä–∞–∑–º–µ—Ä {self.current_position_size_usdt:.2f} USDT")
                else:
                    log_info("üîÑ –¢–æ—Ä–≥–æ–≤–∞—è –ø–∞—Ä–∞ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å ‚Äî –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Å—Ç–∞—Ä–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏")
        except Exception as e:
            log_error(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏: {e}")
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: core\exchange.py
[FILE_CONTENT_BEGIN]
"""
–†–ê–ë–û–¢–ê –° –ë–ò–†–ñ–ï–ô KUCOIN
"""
import ccxt
import os
from dotenv import load_dotenv
from utils.logger import log_info, log_error

load_dotenv()

class ExchangeManager:
    def __init__(self):
        self.exchange = None
        self.connected = False
        self.connect()
    
    def connect(self):
        """–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∏—Ä–∂–µ KuCoin"""
        try:
            self.exchange = ccxt.kucoin({
                'apiKey': os.getenv('KUCOIN_API_KEY'),
                'secret': os.getenv('KUCOIN_SECRET_KEY'),
                'password': os.getenv('KUCOIN_PASSPHRASE'),
                'sandbox': False,
                'enableRateLimit': True,
                'rateLimit': 300,
                'timeout': 30000,
            })
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
            self.exchange.fetch_balance()
            self.connected = True
            log_info("‚úÖ –£—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ KuCoin")
            
        except ccxt.AuthenticationError as e:
            log_error(f"‚ùå –û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ KuCoin: {e}")
            self.connected = False
        except ccxt.ExchangeError as e:
            log_error(f"‚ùå –û—à–∏–±–∫–∞ –±–∏—Ä–∂–∏ KuCoin: {e}")
            self.connected = False
        except Exception as e:
            log_error(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ KuCoin: {e}")
            self.connected = False
    
    def get_balance(self):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞"""
        if not self.connected:
            return None
            
        try:
            balance = self.exchange.fetch_balance()
            return {
                'total_usdt': balance['total'].get('USDT', 0),
                'free_usdt': balance['free'].get('USDT', 0),
                'used_usdt': balance['used'].get('USDT', 0),
                'total_btc': balance['total'].get('BTC', 0),
                'free_btc': balance['free'].get('BTC', 0),
            }
        except Exception as e:
            log_error(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞: {e}")
            return None
    
    def get_market_data(self, symbol, timeframe='1h', limit=50):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö"""
        if not self.connected:
            return None
            
        try:
            ohlcv = self.exchange.fetch_ohlcv(symbol, timeframe, limit=limit)
            
            if not ohlcv or len(ohlcv) < 2:
                return None
            
            closes = [candle[4] for candle in ohlcv]
            current_price = closes[-1]
            
            # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
            from utils.helpers import calculate_ema
            
            fast_ema = calculate_ema(closes, 9)
            slow_ema = calculate_ema(closes, 21)
            ema_diff_percent = (fast_ema - slow_ema) / slow_ema
            
            # –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã –∑–∞ 24 —á–∞—Å–∞
            price_change_24h = 0
            if len(closes) >= 24:
                price_24h_ago = closes[-24]
                price_change_24h = ((current_price - price_24h_ago) / price_24h_ago) * 100
            
            return {
                'fast_ema': fast_ema,
                'slow_ema': slow_ema,
                'ema_diff_percent': ema_diff_percent,
                'current_price': current_price,
                'price_change_24h': price_change_24h,
                'ohlcv': ohlcv
            }
            
        except Exception as e:
            log_error(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è {symbol}: {e}")
            return None
    
    def get_ticker(self, symbol):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∏–∫–µ—Ä–∞"""
        if not self.connected:
            return None
            
        try:
            ticker = self.exchange.fetch_ticker(symbol)
            return {
                'symbol': symbol,
                'last': ticker['last'],
                'high': ticker['high'],
                'low': ticker['low'],
                'volume': ticker['baseVolume'],
                'change': ticker['percentage'],
                'timestamp': ticker['timestamp']
            }
        except Exception as e:
            log_error(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–∏–∫–µ—Ä–∞ {symbol}: {e}")
            return None
    
    def create_order(self, symbol, order_type, side, amount, price=None):
        """–°–æ–∑–¥–∞–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –æ–±—ä–µ–º–∞"""
        if not self.connected:
            return None, "–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ –±–∏—Ä–∂–µ"
            
        try:
            # üîß –ü–û–õ–£–ß–ê–ï–ú –ò–ù–§–û–†–ú–ê–¶–ò–Æ –û –†–´–ù–ö–ï –î–õ–Ø –ü–†–û–í–ï–†–ö–ò –ú–ò–ù–ò–ú–ê–õ–¨–ù–û–ì–û –û–ë–™–ï–ú–ê
            market = self.exchange.market(symbol)
            min_amount = market['limits']['amount']['min']
            min_cost = market['limits']['cost']['min']  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤ quote currency (USDT)
            
            log_info(f"üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ä–¥–µ—Ä–∞: amount={amount:.6f}, min_amount={min_amount}, min_cost={min_cost}")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
            if amount < min_amount:
                error_msg = f"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ {amount:.6f} –º–µ–Ω—å—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ {min_amount}"
                log_error(f"‚ùå {error_msg}")
                return None, error_msg
                
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Å—É–º–º—É –æ—Ä–¥–µ—Ä–∞
            current_price = self.get_ticker(symbol)['last'] if not price else price
            order_cost = amount * current_price
            
            if order_cost < min_cost:
                error_msg = f"–°—É–º–º–∞ –æ—Ä–¥–µ—Ä–∞ {order_cost:.2f} USDT –º–µ–Ω—å—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π {min_cost} USDT"
                log_error(f"‚ùå {error_msg}")
                return None, error_msg
            
            # üîß –°–û–ó–î–ê–ï–ú –û–†–î–ï–†
            if order_type == 'market':
                order = self.exchange.create_order(symbol, 'market', side, amount)
            else:
                order = self.exchange.create_order(symbol, 'limit', side, amount, price)
            
            log_info(f"‚úÖ –û—Ä–¥–µ—Ä —Å–æ–∑–¥–∞–Ω: {side} {amount:.6f} {symbol} (—Å—É–º–º–∞: {order_cost:.2f} USDT)")
            return order, "–£—Å–ø–µ—à–Ω–æ"
            
        except ccxt.InsufficientFunds as e:
            error_msg = f"‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ä–¥–µ—Ä–∞: {e}"
            log_error(error_msg)
            return None, error_msg
        except ccxt.InvalidOrder as e:
            error_msg = f"‚ùå –ù–µ–≤–µ—Ä–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ä–¥–µ—Ä–∞: {e}"
            log_error(error_msg)
            return None, error_msg
        except Exception as e:
            error_msg = f"‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ä–¥–µ—Ä–∞: {e}"
            log_error(error_msg)
            return None, error_msg
    
    def get_order_status(self, order_id, symbol):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –æ—Ä–¥–µ—Ä–∞"""
        if not self.connected:
            return None
            
        try:
            return self.exchange.fetch_order(order_id, symbol)
        except Exception as e:
            log_error(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –æ—Ä–¥–µ—Ä–∞ {order_id}: {e}")
            return None
    
    def cancel_order(self, order_id, symbol):
        """–û—Ç–º–µ–Ω–∞ –æ—Ä–¥–µ—Ä–∞"""
        if not self.connected:
            return False
            
        try:
            self.exchange.cancel_order(order_id, symbol)
            log_info(f"‚úÖ –û—Ä–¥–µ—Ä –æ—Ç–º–µ–Ω–µ–Ω: {order_id}")
            return True
        except Exception as e:
            log_error(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–º–µ–Ω—ã –æ—Ä–¥–µ—Ä–∞ {order_id}: {e}")
            return False
    
    def get_open_orders(self, symbol=None):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤"""
        if not self.connected:
            return []
            
        try:
            return self.exchange.fetch_open_orders(symbol)
        except Exception as e:
            log_error(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–∫—Ä—ã—Ç—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤: {e}")
            return []
    
    def get_market_info(self, symbol):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä—ã–Ω–∫–µ"""
        if not self.connected:
            return None
            
        try:
            market = self.exchange.market(symbol)
            return {
                'symbol': symbol,
                'base': market['base'],
                'quote': market['quote'],
                'min_amount': market['limits']['amount']['min'],
                'max_amount': market['limits']['amount']['max'],
                'min_cost': market['limits']['cost']['min'],
                'max_cost': market['limits']['cost']['max'],
                'price_precision': market['precision']['price'],
                'amount_precision': market['precision']['amount']
            }
        except Exception as e:
            log_error(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä—ã–Ω–∫–µ {symbol}: {e}")
            return None
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: core\risk_manager.py
[FILE_CONTENT_BEGIN]
"""
–£–ü–†–ê–í–õ–ï–ù–ò–ï –†–ò–°–ö–ê–ú–ò
"""
from utils.logger import log_info, log_error
from utils.helpers import calculate_volatility

class RiskManager:
    def __init__(self, risk_settings):
        self.risk_settings = risk_settings
        self.daily_losses = 0.0
        self.consecutive_losses = 0
        self.trades_today = 0
        
    def check_trade_risk(self, signal_type, current_price, position_size, market_data):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∏—Å–∫–æ–≤ –ø–µ—Ä–µ–¥ —Å–¥–µ–ª–∫–æ–π"""
        checks = []
        
        # 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–Ω–µ–≤–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞ –ø–æ—Ç–µ—Ä—å
        if self.daily_losses >= self.risk_settings['max_daily_loss']:
            checks.append((
                False, 
                f"üö® –ü—Ä–µ–≤—ã—à–µ–Ω –¥–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç –ø–æ—Ç–µ—Ä—å: {self.daily_losses:.2f}%"
            ))
        
        # 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–∏–∏ —É–±—ã—Ç–∫–æ–≤
        if self.consecutive_losses >= self.risk_settings['max_consecutive_losses']:
            checks.append((
                False,
                f"üö® {self.consecutive_losses} —É–±—ã—Ç–æ—á–Ω—ã—Ö —Å–¥–µ–ª–æ–∫ –ø–æ–¥—Ä—è–¥"
            ))
        
        # 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏
        max_position = self.risk_settings['max_position_size']
        if position_size > max_position:
            checks.append((
                False,
                f"üö® –ü—Ä–µ–≤—ã—à–µ–Ω —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏: {position_size:.1f}% > {max_position:.1f}%"
            ))
        
        # 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
        if market_data and 'ohlcv' in market_data:
            volatility = calculate_volatility([candle[4] for candle in market_data['ohlcv']])
            if volatility > self.risk_settings['volatility_limit']:
                checks.append((
                    False,
                    f"üö® –í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å: {volatility:.1f}%"
                ))
        
        # 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ø-–ª–æ—Å—Å–∞ –∏ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç–∞
        if signal_type == 'buy':
            stop_loss_pct = self.risk_settings['stop_loss']
            take_profit_pct = self.risk_settings['take_profit']
            risk_reward = take_profit_pct / stop_loss_pct
            
            if risk_reward < self.risk_settings.get('risk_reward_ratio', 1.5):
                checks.append((
                    False,
                    f"üö® –ü–ª–æ—Ö–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Ä–∏—Å–∫/–ø—Ä–∏–±—ã–ª—å: {risk_reward:.1f}"
                ))
        
        # –ï—Å–ª–∏ –µ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤—É—é
        critical_errors = [check for check in checks if not check[0]]
        if critical_errors:
            return critical_errors[0]
        
        # –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã
        return True, "‚úÖ –†–∏—Å–∫–∏ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –Ω–æ—Ä–º—ã"
    
    def update_after_trade(self, trade_result):
        """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ—Å–ª–µ —Å–¥–µ–ª–∫–∏"""
        profit_percent = trade_result.get('profit_percent', 0)
        
        if profit_percent < 0:
            self.daily_losses += abs(profit_percent)
            self.consecutive_losses += 1
        else:
            self.consecutive_losses = 0
        
        self.trades_today += 1
        
        log_info(f"üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∏—Å–∫–æ–≤: —É–±—ã—Ç–∫–∏ {self.daily_losses:.2f}%, "
                f"—Å–µ—Ä–∏—è —É–±—ã—Ç–∫–æ–≤ {self.consecutive_losses}, "
                f"—Å–¥–µ–ª–æ–∫ —Å–µ–≥–æ–¥–Ω—è {self.trades_today}")
    
    def reset_daily_stats(self):
        """–°–±—Ä–æ—Å –¥–Ω–µ–≤–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏"""
        self.daily_losses = 0.0
        self.trades_today = 0
        log_info("üîÑ –î–Ω–µ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∏—Å–∫–æ–≤ —Å–±—Ä–æ—à–µ–Ω–∞")
    
    def get_risk_summary(self):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–≤–æ–¥–∫–∏ –ø–æ —Ä–∏—Å–∫–∞–º"""
        return {
            'daily_losses': self.daily_losses,
            'consecutive_losses': self.consecutive_losses,
            'trades_today': self.trades_today,
            'max_daily_loss': self.risk_settings['max_daily_loss'],
            'max_consecutive_losses': self.risk_settings['max_consecutive_losses']
        }
    
    def can_trade(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ç–æ—Ä–≥–æ–≤–ª–∏"""
        return (self.daily_losses < self.risk_settings['max_daily_loss'] and 
                self.consecutive_losses < self.risk_settings['max_consecutive_losses'])
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: core\__init__.py
[FILE_CONTENT_BEGIN]
"""
–û–°–ù–û–í–ù–´–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´ –°–ò–°–¢–ï–ú–´
"""
from .bot import AdvancedTradingBot
from .exchange import ExchangeManager
from .risk_manager import RiskManager

__all__ = ['AdvancedTradingBot', 'ExchangeManager', 'RiskManager']
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: ml\features.py
[FILE_CONTENT_BEGIN]
"""
–ü–û–î–ì–û–¢–û–í–ö–ê –§–ò–ß –î–õ–Ø ML
"""
import numpy as np
import pandas as pd
from utils.helpers import calculate_ema, calculate_rsi, calculate_macd, calculate_bollinger_bands

class FeatureEngineer:
    def __init__(self):
        self.required_period = 50  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö
        
    def prepare_features(self, ohlcv_data):
        """–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ñ–∏—á –∏–∑ OHLCV –¥–∞–Ω–Ω—ã—Ö"""
        try:
            if len(ohlcv_data) < self.required_period:
                return []
                
            closes = np.array([candle[4] for candle in ohlcv_data])
            highs = np.array([candle[2] for candle in ohlcv_data])
            lows = np.array([candle[3] for candle in ohlcv_data])
            
            features = []
            
            # –¶–µ–Ω–æ–≤—ã–µ —Ñ–∏—á–∏
            current_price = closes[-1]
            price_change_1h = (closes[-1] - closes[-4]) / closes[-4] * 100 if len(closes) >= 4 else 0
            price_change_4h = (closes[-1] - closes[-16]) / closes[-16] * 100 if len(closes) >= 16 else 0
            price_change_24h = (closes[-1] - closes[-24]) / closes[-24] * 100 if len(closes) >= 24 else 0
            
            # SMA —Ñ–∏—á–∏
            sma_5 = np.mean(closes[-5:])
            sma_10 = np.mean(closes[-10:])
            sma_20 = np.mean(closes[-20:])
            sma_50 = np.mean(closes[-50:]) if len(closes) >= 50 else sma_20
            
            # –û—Ç–Ω–æ—à–µ–Ω–∏—è —Ü–µ–Ω –∫ SMA
            price_sma_5_ratio = current_price / sma_5
            price_sma_20_ratio = current_price / sma_20
            price_sma_50_ratio = current_price / sma_50
            
            # EMA —Ñ–∏—á–∏
            ema_9 = calculate_ema(closes, 9)
            ema_21 = calculate_ema(closes, 21)
            ema_diff = (ema_9 - ema_21) / ema_21 * 100
            
            # RSI
            rsi = calculate_rsi(closes)
            
            # MACD
            macd, macd_signal = calculate_macd(closes)
            macd_histogram = macd - macd_signal
            
            # Bollinger Bands
            bb_middle, bb_upper, bb_lower = calculate_bollinger_bands(closes)
            bb_position = (current_price - bb_lower) / (bb_upper - bb_lower) if bb_upper != bb_lower else 0.5
            
            # –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
            volatility_5 = np.std(closes[-5:]) / np.mean(closes[-5:]) * 100
            volatility_20 = np.std(closes[-20:]) / np.mean(closes[-20:]) * 100
            
            # High/Low –æ—Ç–Ω–æ—à–µ–Ω–∏—è
            high_low_ratio_5 = (np.max(highs[-5:]) - np.min(lows[-5:])) / np.mean(closes[-5:])
            high_low_ratio_20 = (np.max(highs[-20:]) - np.min(lows[-20:])) / np.mean(closes[-20:])
            
            # –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —Ñ–∏—á–∏
            features.extend([
                current_price,
                price_change_1h,
                price_change_4h,
                price_change_24h,
                sma_5, sma_10, sma_20, sma_50,
                price_sma_5_ratio,
                price_sma_20_ratio,
                price_sma_50_ratio,
                ema_9, ema_21, ema_diff,
                rsi,
                macd, macd_signal, macd_histogram,
                bb_middle, bb_upper, bb_lower, bb_position,
                volatility_5, volatility_20,
                high_low_ratio_5, high_low_ratio_20
            ])
            
            return features
            
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ —Ñ–∏—á: {e}")
            return []

    def get_feature_names(self):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏–π —Ñ–∏—á"""
        return [
            'current_price', 'price_change_1h', 'price_change_4h', 'price_change_24h',
            'sma_5', 'sma_10', 'sma_20', 'sma_50',
            'price_sma_5_ratio', 'price_sma_20_ratio', 'price_sma_50_ratio',
            'ema_9', 'ema_21', 'ema_diff',
            'rsi',
            'macd', 'macd_signal', 'macd_histogram',
            'bb_middle', 'bb_upper', 'bb_lower', 'bb_position',
            'volatility_5', 'volatility_20',
            'high_low_ratio_5', 'high_low_ratio_20'
        ]
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: ml\model.py
[FILE_CONTENT_BEGIN]
"""
ML –ú–û–î–ï–õ–¨ –ò –û–ë–£–ß–ï–ù–ò–ï (–û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–ê–Ø –í–ï–†–°–ò–Ø) - –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –í–´–í–û–î
"""
import joblib
import numpy as np
from sklearn.ensemble import RandomForestClassifier
from sklearn.preprocessing import StandardScaler
from sklearn.model_selection import train_test_split
from .features import FeatureEngineer

class MLModel:
    def __init__(self):
        self.model = None
        self.scaler = StandardScaler()
        self.feature_engineer = FeatureEngineer()
        self.is_trained = False
        
    def load_model(self):
        """–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏"""
        try:
            if joblib.os.path.exists('ml_model.pkl') and joblib.os.path.exists('scaler.pkl'):
                self.model = joblib.load('ml_model.pkl')
                self.scaler = joblib.load('scaler.pkl')
                self.is_trained = True
                print("‚úÖ ML-–º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑ –∫—ç—à–∞")
                return True
            else:
                print("‚ö†Ô∏è ML-–º–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–±—É—á–µ–Ω–∏–µ")
                return False
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ML: {e}")
            return False

    def train(self, exchange, symbol='BTC/USDT', timeframe='1h', limit=80):
        """–û–ë–õ–ï–ì–ß–ï–ù–ù–û–ï –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞"""
        try:
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ú–ï–ù–¨–®–ï –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞
            print(f"ü§ñ –ë—ã—Å—Ç—Ä–æ–µ –æ–±—É—á–µ–Ω–∏–µ ML –Ω–∞ {limit} —Å–≤–µ—á–∞—Ö...")
            ohlcv = exchange.fetch_ohlcv(symbol, timeframe, limit=limit)
            
            if len(ohlcv) < 40:  # –£–º–µ–Ω—å—à–∏–ª–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
                print("‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è ML")
                return False
            
            X = []
            y = []
            
            # –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
            for i in range(20, len(ohlcv) - 1):  # –ú–µ–Ω—å—à–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
                features = self.feature_engineer.prepare_features(ohlcv[:i+1])
                if features:
                    future_price = ohlcv[i+1][4]
                    current_price = ohlcv[i][4]
                    target = 1 if future_price > current_price else 0
                    
                    X.append(features)
                    y.append(target)
            
            if len(X) < 25:  # –£–º–µ–Ω—å—à–∏–ª–∏ –ø–æ—Ä–æ–≥
                print("‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è")
                return False
            
            X = np.array(X)
            y = np.array(y)
            
            # –£–ü–†–û–©–ï–ù–ù–ê–Ø –ú–û–î–ï–õ–¨ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è
            self.model = RandomForestClassifier(
                n_estimators=50,  # –ú–µ–Ω—å—à–µ –¥–µ—Ä–µ–≤—å–µ–≤
                max_depth=8,      # –ú–µ–Ω—å—à–∞—è –≥–ª—É–±–∏–Ω–∞
                min_samples_split=10,
                min_samples_leaf=4,
                random_state=42,
                n_jobs=-1
            )
            
            # –û–±—É—á–µ–Ω–∏–µ –ë–ï–ó —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –Ω–∞ —Ç–µ—Å—Ç/—Ç—Ä–µ–π–¥ –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
            X_scaled = self.scaler.fit_transform(X)
            self.model.fit(X_scaled, y)
            self.is_trained = True
            
            # –ë—ã—Å—Ç—Ä–∞—è –æ—Ü–µ–Ω–∫–∞
            train_score = self.model.score(X_scaled, y)
            
            print(f"‚úÖ ML-–º–æ–¥–µ–ª—å –æ–±—É—á–µ–Ω–∞ (–±—ã—Å—Ç—Ä—ã–π —Ä–µ–∂–∏–º)")
            print(f"   –¢–æ—á–Ω–æ—Å—Ç—å –Ω–∞ –æ–±—É—á–∞—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö: {train_score:.3f}")
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –º–æ–¥–µ–ª—å
            joblib.dump(self.model, 'ml_model.pkl')
            joblib.dump(self.scaler, 'scaler.pkl')
            
            return True
            
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –±—ã—Å—Ç—Ä–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è ML: {e}")
            return False

    def predict(self, ohlcv_data):
        """–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö - –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –í–´–í–û–î"""
        if not self.is_trained or self.model is None:
            return 0.5, "‚ö™ ML –ù–ï –û–ë–£–ß–ï–ù"
        
        try:
            features = self.feature_engineer.prepare_features(ohlcv_data)
            if not features:
                return 0.5, "‚ö†Ô∏è –ù–ï–î–û–°–¢–ê–¢–û–ß–ù–û –î–ê–ù–ù–´–•"
            
            features_scaled = self.scaler.transform([features])
            prediction_proba = self.model.predict_proba(features_scaled)[0]
            confidence = prediction_proba[1]  # –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ä–æ—Å—Ç–∞
            
            # –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –ò–ù–¢–ï–†–ü–†–ï–¢–ê–¶–ò–Ø –£–í–ï–†–ï–ù–ù–û–°–¢–ò
            if confidence > 0.7:
                signal = "üü¢ –°–ò–õ–¨–ù–´–ô –†–û–°–¢"
            elif confidence > 0.6:
                signal = "üü° –£–ú–ï–†–ï–ù–ù–´–ô –†–û–°–¢" 
            elif confidence > 0.5:
                signal = "‚ö™ –ù–ï–ô–¢–†–ê–õ–¨–ù–û"
            elif confidence > 0.4:
                signal = "üü° –£–ú–ï–†–ï–ù–ù–û–ï –ü–ê–î–ï–ù–ò–ï"
            else:
                signal = "üî¥ –°–ò–õ–¨–ù–û–ï –ü–ê–î–ï–ù–ò–ï"
            
            return confidence, signal
            
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è ML: {e}")
            return 0.5, "‚ùå –û–®–ò–ë–ö–ê –ü–†–ï–î–°–ö–ê–ó–ê–ù–ò–Ø"

    def get_feature_importance(self):
        """–í–∞–∂–Ω–æ—Å—Ç—å —Ñ–∏—á"""
        if not self.is_trained or self.model is None:
            return {}
        
        try:
            feature_names = self.feature_engineer.get_feature_names()
            importances = self.model.feature_importances_
            
            # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –≤–∞–∂–Ω–æ—Å—Ç–∏
            feature_importance = dict(zip(feature_names, importances))
            sorted_importance = dict(sorted(
                feature_importance.items(), 
                key=lambda x: x[1], 
                reverse=True
            ))
            
            return sorted_importance
        except:
            return {}
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: ml\__init__.py
[FILE_CONTENT_BEGIN]
"""
MACHINE LEARNING –ö–û–ú–ü–û–ù–ï–ù–¢–´
"""
from .model import MLModel
from .features import FeatureEngineer

__all__ = ['MLModel', 'FeatureEngineer']
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: strategies\base_strategy.py
[FILE_CONTENT_BEGIN]
"""
–ë–ê–ó–û–í–´–ô –ö–õ–ê–°–° –°–¢–†–ê–¢–ï–ì–ò–ò –° –ü–û–î–î–ï–†–ñ–ö–û–ô –ü–û–ó–ò–¶–ò–ô
"""
import time
from abc import ABC, abstractmethod
from utils.logger import log_info

class BaseStrategy(ABC):
    def __init__(self, name, description):
        self.name = name
        self.description = description
        self.settings = {}
        self.position = None  # 'long', 'short', –∏–ª–∏ None
        self.entry_price = 0
        self.position_opened_at = None
        self.position_size_usdt = 0  # –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ –≤ USDT
        
    @abstractmethod
    def calculate_signal(self, market_data, ml_confidence=0.5, ml_signal="‚ö™ –ù–ï–ô–¢–†–ê–õ–¨–ù–û"):
        """–†–∞—Å—á–µ—Ç —Ç–æ—Ä–≥–æ–≤–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞"""
        pass
    
    def set_settings(self, settings):
        """–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏"""
        self.settings.update(settings)
        log_info(f"‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ {self.name} –æ–±–Ω–æ–≤–ª–µ–Ω—ã")
    
    def get_settings_info(self):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö"""
        return self.settings
    
    def validate_market_data(self, market_data):
        """–í–∞–ª–∏–¥–∞—Ü–∏—è —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö"""
        if not market_data:
            return False, "–ù–µ—Ç —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö"
        
        required_fields = ['current_price', 'ema_diff_percent']
        for field in required_fields:
            if field not in market_data:
                return False, f"–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–µ {field}"
        
        return True, "OK"
    
    def update_position_info(self, signal, price):
        """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–∑–∏—Ü–∏–∏"""
        if signal == 'buy':
            self.position = 'long'
            self.entry_price = price
            self.position_opened_at = time.time()
        elif signal == 'sell':
            self.position = None
            self.entry_price = 0
            self.position_opened_at = None
    
    def get_position_info(self):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏"""
        if self.position:
            return {
                'position': self.position,
                'entry_price': self.entry_price,
                'opened_at': self.position_opened_at,
                'hold_time': time.time() - self.position_opened_at if self.position_opened_at else 0
            }
        return None
    
    def prepare_signal_message(self, signal, market_data, ml_confidence, ml_signal):
        """–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Å–∏–≥–Ω–∞–ª–µ"""
        if signal == 'buy':
            emoji = "üü¢"
            action = "–ü–û–ö–£–ü–ö–ê"
        elif signal == 'sell':
            emoji = "üî¥" 
            action = "–ü–†–û–î–ê–ñ–ê"
        else:
            emoji = "‚ö™"
            action = "–û–ñ–ò–î–ê–ù–ò–ï"
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–∑–∏—Ü–∏–∏
        position_info = ""
        if self.position:
            current_price = market_data['current_price']
            profit_percent = ((current_price - self.entry_price) / self.entry_price) * 100
            position_info = f"\nüíº –¢–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è: {self.position.upper()}\nüìà –ü—Ä–∏–±—ã–ª—å: {profit_percent:+.2f}%"
        
        message = f"""
{emoji} <b>–°–ò–ì–ù–ê–õ {action}</b>

üéØ <b>–°—Ç—Ä–∞—Ç–µ–≥–∏—è:</b> {self.name}
üí∞ <b>–¶–µ–Ω–∞:</b> {market_data['current_price']:.2f} USDT
üìà <b>EMA:</b> {market_data['ema_diff_percent']*100:+.2f}%
ü§ñ <b>ML:</b> {ml_signal} ({ml_confidence:.1%})
{position_info}

üí° {self.description}
"""
        return message
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: strategies\bollinger.py
[FILE_CONTENT_BEGIN]
"""
–°–¢–†–ê–¢–ï–ì–ò–Ø BOLLINGER BANDS
"""
from .base_strategy import BaseStrategy
from utils.helpers import calculate_bollinger_bands
from utils.logger import log_info

class BollingerStrategy(BaseStrategy):
    def __init__(self):
        super().__init__(
            name="üìä Bollinger Bands",
            description="–¢–æ—Ä–≥–æ–≤–ª—è –Ω–∞ –æ—Ç—Å–∫–æ–∫–∞—Ö –æ—Ç –≥—Ä–∞–Ω–∏—Ü Bollinger Bands –∏ –ø—Ä–æ–±–æ—è—Ö"
        )
        self.default_settings = {
            'bb_period': 20,
            'bb_std_dev': 2,
            'use_squeeze': True,
            'exit_on_middle': False,
            'volume_confirmation': False
        }
        self.settings = self.default_settings.copy()
        self.in_squeeze = False
    
    def calculate_signal(self, market_data, ml_confidence=0.5, ml_signal="‚ö™ –ù–ï–ô–¢–†–ê–õ–¨–ù–û"):
        """–†–∞—Å—á–µ—Ç —Å–∏–≥–Ω–∞–ª–∞ Bollinger Bands"""
        is_valid, message = self.validate_market_data(market_data)
        if not is_valid:
            return 'wait'
        
        if 'ohlcv' not in market_data:
            return 'wait'
        
        try:
            closes = [candle[4] for candle in market_data['ohlcv']]
            current_price = market_data['current_price']
            
            period = self.settings.get('bb_period', 20)
            std_dev = self.settings.get('bb_std_dev', 2)
            
            # –†–∞—Å—á–µ—Ç Bollinger Bands
            bb_middle, bb_upper, bb_lower = calculate_bollinger_bands(closes, period, std_dev)
            
            if bb_upper == bb_lower:  # –ò–∑–±–µ–≥–∞–µ–º –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å
                return 'wait'
            
            # –ü–æ–∑–∏—Ü–∏—è —Ü–µ–Ω—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ BB
            bb_position = (current_price - bb_lower) / (bb_upper - bb_lower)
            
            # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–∂–∞—Ç–∏–µ (squeeze)
            band_width = (bb_upper - bb_lower) / bb_middle
            is_squeeze = band_width < 0.05  # –£–∑–∫–∏–µ –ø–æ–ª–æ—Å—ã
            
            # –õ–æ–≥–∏–∫–∞ –≤—Ö–æ–¥–∞
            if current_price <= bb_lower and not is_squeeze:
                # –¶–µ–Ω–∞ –∫–æ—Å–Ω—É–ª–∞—Å—å –Ω–∏–∂–Ω–µ–π –≥—Ä–∞–Ω–∏—Ü—ã - —Å–∏–≥–Ω–∞–ª –∫ –ø–æ–∫—É–ø–∫–µ
                if self.position != 'long':
                    log_info(f"üìä Bollinger: BUY —Å–∏–≥–Ω–∞–ª (—Ü–µ–Ω–∞ —É –Ω–∏–∂–Ω–µ–π –≥—Ä–∞–Ω–∏—Ü—ã)")
                    return 'buy'
                    
            elif current_price >= bb_upper and not is_squeeze:
                # –¶–µ–Ω–∞ –∫–æ—Å–Ω—É–ª–∞—Å—å –≤–µ—Ä—Ö–Ω–µ–π –≥—Ä–∞–Ω–∏—Ü—ã - —Å–∏–≥–Ω–∞–ª –∫ –ø—Ä–æ–¥–∞–∂–µ
                if self.position == 'long':
                    log_info(f"üìä Bollinger: SELL —Å–∏–≥–Ω–∞–ª (—Ü–µ–Ω–∞ —É –≤–µ—Ä—Ö–Ω–µ–π –≥—Ä–∞–Ω–∏—Ü—ã)")
                    return 'sell'
            
            # –õ–æ–≥–∏–∫–∞ –≤—ã—Ö–æ–¥–∞ –ø–æ —Å—Ä–µ–¥–Ω–µ–π –ª–∏–Ω–∏–∏
            if (self.settings.get('exit_on_middle', False) and 
                self.position == 'long' and 
                abs(current_price - bb_middle) / bb_middle < 0.01):
                # –¶–µ–Ω–∞ –±–ª–∏–∑–∫–æ –∫ —Å—Ä–µ–¥–Ω–µ–π –ª–∏–Ω–∏–∏ - –≤—ã—Ö–æ–¥
                log_info(f"üìä Bollinger: EXIT —Å–∏–≥–Ω–∞–ª (—Ü–µ–Ω–∞ —É —Å—Ä–µ–¥–Ω–µ–π –ª–∏–Ω–∏–∏)")
                return 'sell'
            
            # –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–∂–∞—Ç–∏—è
            if is_squeeze and not self.in_squeeze:
                log_info("üìä Bollinger: –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ —Å–∂–∞—Ç–∏–µ –ø–æ–ª–æ—Å")
                self.in_squeeze = True
            elif not is_squeeze and self.in_squeeze:
                log_info("üìä Bollinger: –°–∂–∞—Ç–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ")
                self.in_squeeze = False
            
            return 'wait'
            
        except Exception as e:
            log_info(f"‚ùå –û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ Bollinger Bands: {e}")
            return 'wait'
    
    def get_settings_info(self):
        """–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö"""
        return {
            'bb_period': f"{self.settings.get('bb_period', 20)}",
            'bb_std_dev': f"{self.settings.get('bb_std_dev', 2)}",
            'use_squeeze': '–í–ö–õ' if self.settings.get('use_squeeze', True) else '–í–´–ö–õ',
            'exit_on_middle': '–í–ö–õ' if self.settings.get('exit_on_middle', False) else '–í–´–ö–õ',
            'volume_confirmation': '–í–ö–õ' if self.settings.get('volume_confirmation', False) else '–í–´–ö–õ'
        }
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: strategies\ema_ml.py
[FILE_CONTENT_BEGIN]
"""
–£–õ–£–ß–®–ï–ù–ù–ê–Ø –°–¢–†–ê–¢–ï–ì–ò–Ø EMA + ML –° –£–ß–ï–¢–û–ú –ö–û–ú–ò–°–°–ò–ô (–ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø)
"""
import time
from .base_strategy import BaseStrategy
from utils.logger import log_info

class EmaMlStrategy(BaseStrategy):
    def __init__(self):
        super().__init__(
            name="üìà EMA + ML",
            description="–ö–æ–º–±–∏–Ω–∞—Ü–∏—è EMA –∫—Ä–æ—Å—Å–æ–≤–µ—Ä–∞ –∏ Machine Learning —Å TP/SL –∏ —É—á–µ—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–π"
        )
        self.default_settings = {
            'ema_threshold': 0.005,
            'ml_confidence_buy': 0.4,
            'ml_confidence_sell': 0.3,
            'take_profit_percent': 2.0,      # –¢–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç 2%
            'stop_loss_percent': 1.5,        # –°—Ç–æ–ø-–ª–æ—Å—Å 1.5%
            'trailing_stop': False,          # –¢—Ä–µ–π–ª–∏–Ω–≥-—Å—Ç–æ–ø
            'exit_on_ml_signal': True,       # –í—ã—Ö–æ–¥ –ø–æ ML —Å–∏–≥–Ω–∞–ª—É
            'min_hold_time': 300,            # –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è 5 –º–∏–Ω
            'min_trade_interval': 60,        # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É —Å–¥–µ–ª–∫–∞–º–∏ 60 —Å–µ–∫
            'taker_fee': 0.001,              # –ö–æ–º–∏—Å—Å–∏—è —Ç–µ–π–∫–µ—Ä–∞ 0.1% (KuCoin)
            'maker_fee': 0.001,              # –ö–æ–º–∏—Å—Å–∏—è –º–µ–π–∫–µ—Ä–∞ 0.1% (KuCoin)
        }
        self.settings = self.default_settings.copy()
        self.position_opened_at = None
        self.entry_price = 0  # –î–û–õ–ñ–ù–ê –§–ò–ö–°–ò–†–û–í–ê–¢–¨–°–Ø –ü–†–ò –û–¢–ö–†–´–¢–ò–ò!
        self.highest_price_since_entry = 0
        self.position_size = 0
        # –ù–æ–≤—ã–π –∞—Ç—Ä–∏–±—É—Ç –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏ –≤ USDT
        self.position_size_usdt = 0
        # –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–∏–≥–Ω–∞–ª–∞ (–¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —á–∞—Å—Ç—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤)
        self.last_signal_time = 0

    def calculate_signal(self, market_data, ml_confidence=0.5, ml_signal="‚ö™ –ù–ï–ô–¢–†–ê–õ–¨–ù–û", position_size_usdt=0):
        """–†–∞—Å—á–µ—Ç —Å–∏–≥–Ω–∞–ª–∞ EMA + ML —Å —É—á–µ—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–π"""
        # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
        is_valid, message = self.validate_market_data(market_data)
        if not is_valid:
            return 'wait'
            
        # –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        ema_threshold = self.settings.get('ema_threshold', 0.005)
        ml_buy_threshold = self.settings.get('ml_confidence_buy', 0.4)
        ml_sell_threshold = self.settings.get('ml_confidence_sell', 0.3)
        
        current_price = market_data['current_price']
        ema_diff = market_data['ema_diff_percent']
        
        # üí∞ –ó–ê–ü–û–ú–ò–ù–ê–ï–ú –†–ê–ó–ú–ï–† –ü–û–ó–ò–¶–ò–ò –í USDT
        self.position_size_usdt = position_size_usdt
        
        # üîß –ó–ê–©–ò–¢–ê –û–¢ –ß–ê–°–¢–´–• –°–ò–ì–ù–ê–õ–û–í (–º–∏–Ω–∏–º—É–º 30 —Å–µ–∫—É–Ω–¥ –º–µ–∂–¥—É —Å–∏–≥–Ω–∞–ª–∞–º–∏)
        current_time = time.time()
        time_since_last_signal = current_time - self.last_signal_time
        min_signal_interval = 30  # 30 —Å–µ–∫—É–Ω–¥
        
        if time_since_last_signal < min_signal_interval:
            log_info(f"‚è∞ –°–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã–π —Å–∏–≥–Ω–∞–ª: {time_since_last_signal:.0f} —Å–µ–∫ < {min_signal_interval} —Å–µ–∫")
            return 'wait'
        
        # üî¥ –£–°–õ–û–í–ò–Ø –ó–ê–ö–†–´–¢–ò–Ø –ü–û–ó–ò–¶–ò–ò (–µ—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞)
        if self.position == 'long':
            # –û–±–Ω–æ–≤–ª—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —Ü–µ–Ω—É –¥–ª—è —Ç—Ä–µ–π–ª–∏–Ω–≥-—Å—Ç–æ–ø–∞
            if current_price > self.highest_price_since_entry:
                self.highest_price_since_entry = current_price
                
            # üìä –†–ê–°–ß–ï–¢ –†–ï–ê–õ–¨–ù–û–ô –ü–†–ò–ë–´–õ–ò –° –£–ß–ï–¢–û–ú –ö–û–ú–ò–°–°–ò–ô
            taker_fee = self.settings.get('taker_fee', 0.001)
            gross_profit_percent = ((current_price - self.entry_price) / self.entry_price) * 100
            total_fees_percent = taker_fee * 2 * 100  # 0.1% * 2 = 0.2%
            net_profit_percent = gross_profit_percent - total_fees_percent
            
            log_info(f"üìä –ü—Ä–∏–±—ã–ª—å: —Ü–µ–Ω–∞ –≤—Ö–æ–¥–∞={self.entry_price:.2f}, —Ç–µ–∫—É—â–∞—è={current_price:.2f}, –±—Ä—É—Ç—Ç–æ={gross_profit_percent:.2f}%, –Ω–µ—Ç—Ç–æ={net_profit_percent:.2f}%")
            
            # 1. –¢–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç –ø–æ –ß–ò–°–¢–û–ô –ø—Ä–∏–±—ã–ª–∏ (—É–∂–µ –∑–∞ –≤—ã—á–µ—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–π)
            take_profit = self.settings.get('take_profit_percent', 2.0)
            if net_profit_percent >= take_profit:
                log_info(f"üéØ Take Profit —Å—Ä–∞–±–æ—Ç–∞–ª: +{net_profit_percent:.2f}% (—á–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å)")
                self.last_signal_time = current_time
                return 'sell'
                
            # 2. –°—Ç–æ–ø-–ª–æ—Å—Å –ø–æ –ß–ò–°–¢–û–ú–£ —É–±—ã—Ç–∫—É (—É–∂–µ —Å —É—á–µ—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–π)
            stop_loss = self.settings.get('stop_loss_percent', 1.5)
            if net_profit_percent <= -stop_loss:
                log_info(f"üõë Stop Loss —Å—Ä–∞–±–æ—Ç–∞–ª: {net_profit_percent:.2f}% (—á–∏—Å—Ç—ã–π —É–±—ã—Ç–æ–∫)")
                self.last_signal_time = current_time
                return 'sell'
                
            # 3. –¢—Ä–µ–π–ª–∏–Ω–≥-—Å—Ç–æ–ø (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω) - —Ç–æ–∂–µ —Å —É—á–µ—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–π
            if self.settings.get('trailing_stop', False):
                trailing_stop_pct = self.settings.get('trailing_stop_percent', 1.0)
                # –£—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–º–∏—Å—Å–∏—é –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ –æ—Ç–∫–∞—Ç–∞ –æ—Ç –º–∞–∫—Å–∏–º—É–º–∞
                current_drawdown_from_peak = ((self.highest_price_since_entry - current_price) / 
                                            self.highest_price_since_entry) * 100
                # –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–º–∏—Å—Å–∏—é –ø—Ä–æ–¥–∞–∂–∏ –∫ –æ—Ç–∫–∞—Ç—É
                effective_drawdown = current_drawdown_from_peak + (taker_fee * 100)
                if effective_drawdown >= trailing_stop_pct:
                    log_info(f"üìâ Trailing Stop —Å—Ä–∞–±–æ—Ç–∞–ª: -{effective_drawdown:.2f}% (—Å —É—á–µ—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–π)")
                    self.last_signal_time = current_time
                    return 'sell'
                    
            # 4. –í—ã—Ö–æ–¥ –ø–æ –æ–±—Ä–∞—Ç–Ω–æ–º—É ML —Å–∏–≥–Ω–∞–ª—É
            if (self.settings.get('exit_on_ml_signal', True) and 
                ml_confidence < ml_sell_threshold):
                log_info(f"ü§ñ ML —Å–∏–≥–Ω–∞–ª –Ω–∞ –≤—ã—Ö–æ–¥: confidence={ml_confidence:.3f}")
                self.last_signal_time = current_time
                return 'sell'
                
            # 5. –í—ã—Ö–æ–¥ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç—Ä–µ–Ω–¥–∞ EMA
            if ema_diff < -ema_threshold:
                log_info(f"üìâ EMA —Å–º–µ–Ω–∏–ª–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: {ema_diff*100:+.2f}%")
                self.last_signal_time = current_time
                return 'sell'
                
            # 6. –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è
            if self.position_opened_at:
                hold_time = current_time - self.position_opened_at
                min_hold = self.settings.get('min_hold_time', 300)
                if hold_time < min_hold:
                    log_info(f"‚è∞ –£–¥–µ—Ä–∂–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é: {hold_time:.0f} —Å–µ–∫ < {min_hold} —Å–µ–∫")
                    return 'wait'  # –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º —Ä–∞–Ω—å—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
                    
            # –ï—Å–ª–∏ –Ω–∏ –æ–¥–Ω–æ —É—Å–ª–æ–≤–∏–µ –∑–∞–∫—Ä—ã—Ç–∏—è –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ - —É–¥–µ—Ä–∂–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é
            log_info("üìà –£–¥–µ—Ä–∂–∏–≤–∞–µ–º LONG –ø–æ–∑–∏—Ü–∏—é - —É—Å–ª–æ–≤–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏")
            return 'wait'
        
        # üü¢ –£–°–õ–û–í–ò–Ø –û–¢–ö–†–´–¢–ò–Ø –ü–û–ó–ò–¶–ò–ò (–µ—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è –Ω–µ –æ—Ç–∫—Ä—ã—Ç–∞)
        elif (ema_diff > ema_threshold and 
              ml_confidence > ml_buy_threshold and
              self.position != 'long'):
            # üìà EMA –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–æ—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–µ–Ω–¥
            # ü§ñ ML –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —Å –≤—ã—Å–æ–∫–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é
            log_info(f"üìà –°–∏–≥–Ω–∞–ª—ã: EMA={ema_diff*100:+.2f}% (> {ema_threshold*100:.2f}%), ML={ml_confidence:.3f} (> {ml_buy_threshold:.1f})")
            
            # üîß –ü–†–û–í–ï–†–ö–ê: –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–æ—à–ª–æ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–¥–µ–ª–∫–∏
            if self.last_signal_time > 0:
                time_since_last = current_time - self.last_signal_time
                min_interval = self.settings.get('min_trade_interval', 60)  # –ú–∏–Ω–∏–º—É–º 60 —Å–µ–∫—É–Ω–¥ –º–µ–∂–¥—É —Å–¥–µ–ª–∫–∞–º–∏
                if time_since_last < min_interval:
                    log_info(f"‚è∞ –°–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ –¥–ª—è –Ω–æ–≤–æ–π —Å–¥–µ–ª–∫–∏: {time_since_last:.0f} —Å–µ–∫ < {min_interval} —Å–µ–∫")
                    return 'wait'
            
            # –ó–ê–ü–û–ú–ò–ù–ê–ï–ú –ü–ê–†–ê–ú–ï–¢–†–´ –í–•–û–î–ê (–¢–û–õ–¨–ö–û –ü–†–ò –û–¢–ö–†–´–¢–ò–ò!)
            self.entry_price = current_price  # –§–ò–ö–°–ò–†–£–ï–ú –¶–ï–ù–£ –í–•–û–î–ê
            self.highest_price_since_entry = current_price
            self.position_opened_at = current_time
            # –ó–ê–ü–û–ú–ò–ù–ê–ï–ú –†–ê–ó–ú–ï–† –ü–û–ó–ò–¶–ò–ò –í USDT
            self.position_size_usdt = position_size_usdt
            
            log_info(f"üü¢ –û—Ç–∫—Ä—ã–≤–∞–µ–º LONG: —Ü–µ–Ω–∞ –≤—Ö–æ–¥–∞={self.entry_price:.2f}, EMA={ema_diff*100:+.2f}%, ML={ml_confidence:.3f}, –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏={position_size_usdt:.2f} USDT")
            self.last_signal_time = current_time
            return 'buy'
            
        # üîµ –°–ò–ì–ù–ê–õ –û–ñ–ò–î–ê–ù–ò–Ø (–µ—Å–ª–∏ —É—Å–ª–æ–≤–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã)
        else:
            if self.position == 'long':
                log_info("üîµ –£–¥–µ—Ä–∂–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é - —É—Å–ª–æ–≤–∏—è –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç")
            else:
                if ema_diff <= ema_threshold:
                    log_info(f"üîµ EMA –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–∏–ª—å–Ω–∞: {ema_diff*100:+.2f}% <= {ema_threshold*100:.2f}%")
                if ml_confidence <= ml_buy_threshold:
                    log_info(f"üîµ ML —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞: {ml_confidence:.3f} <= {ml_buy_threshold:.1f}")
            
        return 'wait'

    def calculate_breakeven_price(self):
        """–†–∞—Å—á–µ—Ç —Ü–µ–Ω—ã –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏ —Å —É—á–µ—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–π"""
        if not self.position or self.entry_price == 0:
            return 0
        taker_fee = self.settings.get('taker_fee', 0.001)
        # –ß—Ç–æ–±—ã –≤—ã–π—Ç–∏ –≤ 0, —Ü–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ–∫—Ä—ã—Ç—å –∫–æ–º–∏—Å—Å–∏–∏ –∑–∞ –æ–±–µ —Å–¥–µ–ª–∫–∏
        # –ö–æ–º–∏—Å—Å–∏—è –ø–æ–∫—É–ø–∫–∏: entry_price * taker_fee
        # –ö–æ–º–∏—Å—Å–∏—è –ø—Ä–æ–¥–∞–∂–∏: breakeven_price * taker_fee  
        # –£—Ä–∞–≤–Ω–µ–Ω–∏–µ: breakeven_price - entry_price = (entry_price + breakeven_price) * taker_fee
        breakeven = self.entry_price * (1 + taker_fee) / (1 - taker_fee)
        return breakeven

    def update_position_info(self, signal, price):
        """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–∏ —Å–¥–µ–ª–∫–µ"""
        if signal == 'buy':
            self.position = 'long'
            self.entry_price = price  # –§–ò–ö–°–ò–†–£–ï–ú –¶–ï–ù–£ –í–•–û–î–ê –ü–†–ò –ü–û–ö–£–ü–ö–ï
            self.highest_price_since_entry = price
            self.position_opened_at = time.time()
            # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∏ –ª–æ–≥–∏—Ä—É–µ–º —Ü–µ–Ω—É –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏
            breakeven = self.calculate_breakeven_price()
            log_info(f"üí∞ –¶–µ–Ω–∞ –≤—Ö–æ–¥–∞ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞: {self.entry_price:.2f} USDT")
            log_info(f"üí∞ –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏: {self.position_size_usdt:.2f} USDT")
            log_info(f"üí∞ –¶–µ–Ω–∞ –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏: {breakeven:.2f} USDT (+{(breakeven - price):.2f})")
        elif signal == 'sell':
            # –õ–æ–≥–∏—Ä—É–µ–º –∏—Ç–æ–≥–æ–≤—É—é –ø—Ä–∏–±—ã–ª—å –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º
            if self.entry_price > 0:
                gross_profit_percent = ((price - self.entry_price) / self.entry_price) * 100
                taker_fee = self.settings.get('taker_fee', 0.001)
                net_profit_percent = gross_profit_percent - (taker_fee * 2 * 100)
                net_profit_usdt = self.position_size_usdt * (net_profit_percent / 100)
                log_info(f"üí∞ –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏: –≤—Ö–æ–¥={self.entry_price:.2f}, –≤—ã—Ö–æ–¥={price:.2f}, –ø—Ä–∏–±—ã–ª—å={net_profit_percent:.2f}% ({net_profit_usdt:+.2f} USDT)")
            self.position = None
            self.entry_price = 0  # –°–ë–†–ê–°–´–í–ê–ï–ú –¶–ï–ù–£ –í–•–û–î–ê
            self.highest_price_since_entry = 0
            self.position_opened_at = None
            self.position_size_usdt = 0  # –°–ë–†–ê–°–´–í–ê–ï–ú –†–ê–ó–ú–ï–† –ü–û–ó–ò–¶–ò–ò –í USDT

    def get_net_profit_percent(self, current_price):
        """–†–∞—Å—á–µ—Ç —á–∏—Å—Ç–æ–π –ø—Ä–∏–±—ã–ª–∏ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö —Å —É—á–µ—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–π"""
        if not self.position or self.entry_price == 0:
            return 0
        taker_fee = self.settings.get('taker_fee', 0.001)
        gross_profit = ((current_price - self.entry_price) / self.entry_price) * 100
        total_fees = taker_fee * 2 * 100  # –ö–æ–º–∏—Å—Å–∏–∏ –∑–∞ –ø–æ–∫—É–ø–∫—É –∏ –ø—Ä–æ–¥–∞–∂—É
        return gross_profit - total_fees

    def get_position_info(self):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏"""
        if self.position == 'long' and self.entry_price > 0:
            current_profit_percent = self.get_net_profit_percent(self.entry_price)
            current_profit_usdt = self.position_size_usdt * (current_profit_percent / 100)
            
            return {
                'position': self.position,
                'entry_price': self.entry_price,  # –§–ò–ö–°–ò–†–û–í–ê–ù–ù–ê–Ø –¶–ï–ù–ê
                'opened_at': self.position_opened_at,
                'hold_time': time.time() - self.position_opened_at if self.position_opened_at else 0,
                'position_size_usdt': self.position_size_usdt,
                'current_profit_percent': current_profit_percent,
                'current_profit_usdt': current_profit_usdt,
                'breakeven_price': self.calculate_breakeven_price()
            }
        return None

    def get_settings_info(self):
        """–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö"""
        breakeven_info = ""
        if self.position and self.entry_price > 0:
            breakeven = self.calculate_breakeven_price()
            breakeven_info = f"\nüí° –¶–µ–Ω–∞ –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏: {breakeven:.2f}"
        return {
            'ema_threshold': f"{self.settings.get('ema_threshold', 0.005)*100:.2f}%",
            'ml_confidence_buy': f"{self.settings.get('ml_confidence_buy', 0.4):.1f}",
            'ml_confidence_sell': f"{self.settings.get('ml_confidence_sell', 0.3):.1f}",
            'take_profit': f"{self.settings.get('take_profit_percent', 2.0):.1f}%",
            'stop_loss': f"{self.settings.get('stop_loss_percent', 1.5):.1f}%",
            'commission': f"{self.settings.get('taker_fee', 0.001)*100:.1f}%",
            'trailing_stop': '‚úÖ –í–ö–õ' if self.settings.get('trailing_stop', False) else '‚ùå –í–´–ö–õ',
            'min_hold_time': f"{self.settings.get('min_hold_time', 300)//60} –º–∏–Ω",
            'min_trade_interval': f"{self.settings.get('min_trade_interval', 60)} —Å–µ–∫"
        }
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: strategies\macd_rsi.py
[FILE_CONTENT_BEGIN]
"""
–°–¢–†–ê–¢–ï–ì–ò–Ø MACD + RSI
"""
from .base_strategy import BaseStrategy
from utils.helpers import calculate_rsi, calculate_macd
from utils.logger import log_info

class MacdRsiStrategy(BaseStrategy):
    def __init__(self):
        super().__init__(
            name="üéØ MACD + RSI",
            description="–ö–æ–º–±–∏–Ω–∞—Ü–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ MACD –∏ RSI –¥–ª—è —Ç–æ—á–Ω—ã—Ö –≤—Ö–æ–¥–æ–≤"
        )
        self.default_settings = {
            'rsi_period': 14,
            'rsi_oversold': 30,
            'rsi_overbought': 70,
            'macd_fast': 12,
            'macd_slow': 26,
            'macd_signal': 9,
            'use_histogram': True
        }
        self.settings = self.default_settings.copy()
    
    def calculate_signal(self, market_data, ml_confidence=0.5, ml_signal="‚ö™ –ù–ï–ô–¢–†–ê–õ–¨–ù–û"):
        """–†–∞—Å—á–µ—Ç —Å–∏–≥–Ω–∞–ª–∞ MACD + RSI"""
        is_valid, message = self.validate_market_data(market_data)
        if not is_valid:
            return 'wait'
        
        if 'ohlcv' not in market_data:
            return 'wait'
        
        try:
            closes = [candle[4] for candle in market_data['ohlcv']]
            current_price = market_data['current_price']
            
            # –†–∞—Å—á–µ—Ç RSI
            rsi_period = self.settings.get('rsi_period', 14)
            rsi = calculate_rsi(closes, rsi_period)
            
            # –†–∞—Å—á–µ—Ç MACD
            macd_fast = self.settings.get('macd_fast', 12)
            macd_slow = self.settings.get('macd_slow', 26)
            macd_signal_period = self.settings.get('macd_signal', 9)
            
            macd, macd_signal = calculate_macd(closes, macd_fast, macd_slow, macd_signal_period)
            macd_histogram = macd - macd_signal
            
            # –ü–æ–ª—É—á–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ RSI
            rsi_oversold = self.settings.get('rsi_oversold', 30)
            rsi_overbought = self.settings.get('rsi_overbought', 70)
            
            # –°–∏–≥–Ω–∞–ª—ã RSI
            rsi_buy_signal = rsi < rsi_oversold
            rsi_sell_signal = rsi > rsi_overbought
            
            # –°–∏–≥–Ω–∞–ª—ã MACD
            macd_buy_signal = macd > macd_signal and self.settings.get('use_histogram', True) and macd_histogram > 0
            macd_sell_signal = macd < macd_signal and self.settings.get('use_histogram', True) and macd_histogram < 0
            
            # –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞
            if rsi_buy_signal and macd_buy_signal and self.position != 'long':
                log_info(f"üéØ MACD+RSI: BUY —Å–∏–≥–Ω–∞–ª (RSI: {rsi:.1f}, MACD: {macd:.4f})")
                return 'buy'
                
            elif rsi_sell_signal and macd_sell_signal and self.position == 'long':
                log_info(f"üéØ MACD+RSI: SELL —Å–∏–≥–Ω–∞–ª (RSI: {rsi:.1f}, MACD: {macd:.4f})")
                return 'sell'
            
            return 'wait'
            
        except Exception as e:
            log_info(f"‚ùå –û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ MACD+RSI: {e}")
            return 'wait'
    
    def get_settings_info(self):
        """–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö"""
        return {
            'rsi_period': f"{self.settings.get('rsi_period', 14)}",
            'rsi_oversold': f"{self.settings.get('rsi_oversold', 30)}",
            'rsi_overbought': f"{self.settings.get('rsi_overbought', 70)}",
            'macd_fast': f"{self.settings.get('macd_fast', 12)}",
            'macd_slow': f"{self.settings.get('macd_slow', 26)}",
            'macd_signal': f"{self.settings.get('macd_signal', 9)}",
            'use_histogram': '–í–ö–õ' if self.settings.get('use_histogram', True) else '–í–´–ö–õ'
        }
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: strategies\price_action.py
[FILE_CONTENT_BEGIN]
"""
–†–ï–ê–õ–¨–ù–ê–Ø –°–¢–†–ê–¢–ï–ì–ò–Ø PRICE ACTION –° –ü–û–î–î–ï–†–ñ–ö–û–ô/–°–û–ü–†–û–¢–ò–í–õ–ï–ù–ò–ï–ú
"""
import numpy as np
from .base_strategy import BaseStrategy
from utils.logger import log_info

class PriceActionStrategy(BaseStrategy):
    def __init__(self):
        super().__init__(
            name="‚ö° Price Action",
            description="–¢–æ—Ä–≥–æ–≤–ª—è –ø–æ —á–∏—Å—Ç–æ–º—É –¥–≤–∏–∂–µ–Ω–∏—é —Ü–µ–Ω—ã –∏ –∫–ª—é—á–µ–≤—ã–º —É—Ä–æ–≤–Ω—è–º –ø–æ–¥–¥–µ—Ä–∂–∫–∏/—Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è"
        )
        self.default_settings = {
            'min_move_percent': 0.15,
            'use_support_resistance': True,
            'volume_confirmation': False,
            'trend_confirmation': True,
            'support_resistance_lookback': 50,  # –ü–µ—Ä–∏–æ–¥ –¥–ª—è –ø–æ–∏—Å–∫–∞ —É—Ä–æ–≤–Ω–µ–π
            'level_touch_threshold': 0.001,     # 0.1% –æ—Ç —É—Ä–æ–≤–Ω—è
        }
        self.settings = self.default_settings.copy()
        self.last_price = None
        self.support_levels = []
        self.resistance_levels = []
        self.price_history = []
    
    def calculate_signal(self, market_data, ml_confidence=0.5, ml_signal="‚ö™ –ù–ï–ô–¢–†–ê–õ–¨–ù–û"):
        """–†–∞—Å—á–µ—Ç —Å–∏–≥–Ω–∞–ª–∞ Price Action —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —É—Ä–æ–≤–Ω—è–º–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏/—Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è"""
        is_valid, message = self.validate_market_data(market_data)
        if not is_valid:
            return 'wait'
        
        current_price = market_data['current_price']
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Ü–µ–Ω—É –≤ –∏—Å—Ç–æ—Ä–∏—é
        self.price_history.append(current_price)
        if len(self.price_history) > 100:  # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏
            self.price_history.pop(0)
        
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ü–µ–Ω—ã
        if self.last_price is None:
            self.last_price = current_price
            return 'wait'
        
        # –†–∞—Å—á–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã
        price_change = current_price - self.last_price
        price_change_percent = (price_change / self.last_price) * 100
        
        min_move = self.settings.get('min_move_percent', 0.15)
        
        # –†–ï–ê–õ–¨–ù–´–ô –ê–õ–ì–û–†–ò–¢–ú: –û–±–Ω–æ–≤–ª—è–µ–º —É—Ä–æ–≤–Ω–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏/—Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è
        if self.settings.get('use_support_resistance', True):
            self._calculate_real_support_resistance()
        
        # –õ–æ–≥–∏–∫–∞ –ø–æ–∫—É–ø–∫–∏ (–æ—Ç—Å–∫–æ–∫ –æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏)
        if (self._is_near_support(current_price) and 
            price_change_percent > min_move and 
            self._is_uptrend_confirmed(market_data) and
            self.position != 'long'):
            
            self.last_price = current_price
            log_info(f"‚ö° Price Action BUY: –æ—Ç—Å–∫–æ–∫ –æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ +{price_change_percent:.2f}%")
            return 'buy'
            
        # –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–¥–∞–∂–∏ (–æ—Ç—Å–∫–æ–∫ –æ—Ç —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è)
        elif (self._is_near_resistance(current_price) and 
              price_change_percent < -min_move and 
              self._is_downtrend_confirmed(market_data) and
              self.position == 'long'):
            
            self.last_price = current_price
            log_info(f"‚ö° Price Action SELL: –æ—Ç—Å–∫–æ–∫ –æ—Ç —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è {price_change_percent:.2f}%")
            return 'sell'
        
        self.last_price = current_price
        return 'wait'
    
    def _calculate_real_support_resistance(self):
        """–†–ï–ê–õ–¨–ù–´–ô –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–∞—Å—á–µ—Ç–∞ —É—Ä–æ–≤–Ω–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è"""
        if len(self.price_history) < 20:
            return
        
        prices = np.array(self.price_history)
        
        # –ù–∞—Ö–æ–¥–∏–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–∏–Ω–∏–º—É–º—ã –∏ –º–∞–∫—Å–∏–º—É–º—ã
        local_minima = []
        local_maxima = []
        
        for i in range(1, len(prices) - 1):
            # –õ–æ–∫–∞–ª—å–Ω—ã–π –º–∏–Ω–∏–º—É–º
            if prices[i] < prices[i-1] and prices[i] < prices[i+1]:
                local_minima.append(prices[i])
            # –õ–æ–∫–∞–ª—å–Ω—ã–π –º–∞–∫—Å–∏–º—É–º
            elif prices[i] > prices[i-1] and prices[i] > prices[i+1]:
                local_maxima.append(prices[i])
        
        # –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –±–ª–∏–∑–∫–∏–µ —É—Ä–æ–≤–Ω–∏ (–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è)
        self.support_levels = self._cluster_levels(local_minima, threshold=0.005)  # 0.5%
        self.resistance_levels = self._cluster_levels(local_maxima, threshold=0.005)
        
        # –°–æ—Ä—Ç–∏—Ä—É–µ–º –∏ –±–µ—Ä–µ–º –±–ª–∏–∂–∞–π—à–∏–µ —É—Ä–æ–≤–Ω–∏
        self.support_levels.sort(reverse=True)  # –û—Ç –±–æ–ª—å—à–µ–≥–æ –∫ –º–µ–Ω—å—à–µ–º—É
        self.resistance_levels.sort()           # –û—Ç –º–µ–Ω—å—à–µ–≥–æ –∫ –±–æ–ª—å—à–µ–º—É
        
        # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Ä–æ–≤–Ω–µ–π
        self.support_levels = self.support_levels[:5]
        self.resistance_levels = self.resistance_levels[:5]
    
    def _cluster_levels(self, levels, threshold=0.005):
        """–ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –±–ª–∏–∑–∫–∏—Ö —É—Ä–æ–≤–Ω–µ–π"""
        if not levels:
            return []
        
        clusters = []
        levels_sorted = sorted(levels)
        
        current_cluster = [levels_sorted[0]]
        
        for price in levels_sorted[1:]:
            if abs(price - current_cluster[-1]) / current_cluster[-1] <= threshold:
                current_cluster.append(price)
            else:
                # –î–æ–±–∞–≤–ª—è–µ–º —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞
                clusters.append(np.mean(current_cluster))
                current_cluster = [price]
        
        if current_cluster:
            clusters.append(np.mean(current_cluster))
        
        return clusters
    
    def _is_near_support(self, current_price):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–∏–∑–æ—Å—Ç–∏ –∫ —É—Ä–æ–≤–Ω—é –ø–æ–¥–¥–µ—Ä–∂–∫–∏"""
        if not self.support_levels:
            return False
        
        threshold = self.settings.get('level_touch_threshold', 0.001)
        for level in self.support_levels:
            if abs(current_price - level) / level <= threshold:
                log_info(f"‚ö° Near support: {current_price:.2f} ~ {level:.2f}")
                return True
        return False
    
    def _is_near_resistance(self, current_price):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–∏–∑–æ—Å—Ç–∏ –∫ —É—Ä–æ–≤–Ω—é —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è"""
        if not self.resistance_levels:
            return False
        
        threshold = self.settings.get('level_touch_threshold', 0.001)
        for level in self.resistance_levels:
            if abs(current_price - level) / level <= threshold:
                log_info(f"‚ö° Near resistance: {current_price:.2f} ~ {level:.2f}")
                return True
        return False
    
    def _is_uptrend_confirmed(self, market_data):
        """–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤–æ—Å—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–µ–Ω–¥–∞"""
        if not self.settings.get('trend_confirmation', True):
            return True
        
        ema_bullish = market_data['ema_diff_percent'] > 0
        price_above_ema = market_data['current_price'] > market_data['fast_ema']
        
        return ema_bullish and price_above_ema
    
    def _is_downtrend_confirmed(self, market_data):
        """–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∏—Å—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–µ–Ω–¥–∞"""
        if not self.settings.get('trend_confirmation', True):
            return True
        
        ema_bearish = market_data['ema_diff_percent'] < 0
        price_below_ema = market_data['current_price'] < market_data['slow_ema']
        
        return ema_bearish and price_below_ema
    
    def get_settings_info(self):
        """–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö"""
        support_info = f"{len(self.support_levels)} —É—Ä." if self.support_levels else "–Ω–µ—Ç"
        resistance_info = f"{len(self.resistance_levels)} —É—Ä." if self.resistance_levels else "–Ω–µ—Ç"
        
        return {
            'min_move_percent': f"{self.settings.get('min_move_percent', 0.15):.2f}%",
            'support_resistance': '‚úÖ –í–ö–õ' if self.settings.get('use_support_resistance', True) else '‚ùå –í–´–ö–õ',
            'support_levels': support_info,
            'resistance_levels': resistance_info,
            'trend_confirmation': '‚úÖ –í–ö–õ' if self.settings.get('trend_confirmation', True) else '‚ùå –í–´–ö–õ',
            'volume_confirmation': '‚úÖ –í–ö–õ' if self.settings.get('volume_confirmation', False) else '‚ùå –í–´–ö–õ'
        }
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: strategies\__init__.py
[FILE_CONTENT_BEGIN]
"""
–¢–û–†–ì–û–í–´–ï –°–¢–†–ê–¢–ï–ì–ò–ò
"""
from .base_strategy import BaseStrategy
from .ema_ml import EmaMlStrategy
from .price_action import PriceActionStrategy
from .macd_rsi import MacdRsiStrategy
from .bollinger import BollingerStrategy

__all__ = ['BaseStrategy', 'EmaMlStrategy', 'PriceActionStrategy', 
           'MacdRsiStrategy', 'BollingerStrategy']
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: telegram\bot.py
[FILE_CONTENT_BEGIN]
"""
TELEGRAM –ë–û–¢ –î–õ–Ø –£–ü–†–ê–í–õ–ï–ù–ò–Ø - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
"""
import requests
import threading
import time
from datetime import datetime
from utils.logger import log_info, log_error
from .menus import MenuManager
from .handlers import MessageHandler

class TelegramBot:
    def __init__(self, trading_bot):
        self.bot = trading_bot
        self.menu_manager = MenuManager(trading_bot)
        self.message_handler = MessageHandler(trading_bot)
        self.token = self.bot.settings.settings.get('telegram_token')
        self.chat_id = self.bot.settings.settings.get('telegram_chat_id')
        self.last_update_id = 0
        self.connection_issues = 0
        self.last_balance = None  # –î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –±–∞–ª–∞–Ω—Å–∞
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram
        if not self.token or not self.chat_id:
            log_error("‚ùå Telegram –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç token –∏–ª–∏ chat_id –≤ .env —Ñ–∞–π–ª–µ")
            log_info("üí° –î–æ–±–∞–≤—å—Ç–µ TELEGRAM_BOT_TOKEN –∏ TELEGRAM_CHAT_ID –≤ —Ñ–∞–π–ª .env")
            return
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞
        if not self.test_connection():
            log_error("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π Telegram —Ç–æ–∫–µ–Ω –∏–ª–∏ chat_id")
            return
        # –ó–∞–ø—É—Å–∫–∞–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å —Å–æ–æ–±—â–µ–Ω–∏–π
        self.start_message_listener()
        log_info("‚úÖ Telegram –±–æ—Ç —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")

    def test_connection(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Telegram API"""
        try:
            url = f"https://api.telegram.org/bot{self.token}/getMe"
            response = requests.get(url, timeout=15)
            if response.status_code == 200:
                bot_info = response.json()
                if bot_info['ok']:
                    log_info(f"‚úÖ Telegram –±–æ—Ç: @{bot_info['result']['username']}")
                    return True
            log_error(f"‚ùå –û—à–∏–±–∫–∞ Telegram API: {response.text}")
            return False
        except Exception as e:
            log_error(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Telegram: {e}")
            return False

    def send_message(self, message, reply_markup=None, retry_count=2):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏"""
        if not self.token or not self.chat_id:
            return False
        for attempt in range(retry_count + 1):
            try:
                url = f"https://api.telegram.org/bot{self.token}/sendMessage"
                payload = {
                    'chat_id': self.chat_id,
                    'text': message,
                    'parse_mode': 'HTML',
                    'disable_web_page_preview': True
                }
                if reply_markup:
                    payload['reply_markup'] = reply_markup
                # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ç–∞–π–º–∞—É—Ç –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
                timeout = 20 if attempt > 0 else 10
                response = requests.post(url, json=payload, timeout=timeout)
                if response.status_code == 200:
                    self.connection_issues = 0  # –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø—Ä–æ–±–ª–µ–º
                    return True
                else:
                    log_error(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram (–ø–æ–ø—ã—Ç–∫–∞ {attempt + 1}): {response.text}")
            except requests.exceptions.Timeout:
                log_error(f"‚è∞ –¢–∞–π–º–∞—É—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram (–ø–æ–ø—ã—Ç–∫–∞ {attempt + 1})")
            except requests.exceptions.ConnectionError:
                log_error(f"üîå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å Telegram (–ø–æ–ø—ã—Ç–∫–∞ {attempt + 1})")
            except Exception as e:
                log_error(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram (–ø–æ–ø—ã—Ç–∫–∞ {attempt + 1}): {e}")
            # –ü–∞—É–∑–∞ –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–æ–π
            if attempt < retry_count:
                time.sleep(2)
        self.connection_issues += 1
        if self.connection_issues >= 3:
            log_error("üö® –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Telegram")
        return False

    def start_message_listener(self):
        """–ó–∞–ø—É—Å–∫ —Å–ª—É—à–∞—Ç–µ–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π"""
        def listener():
            log_info("üîç –ó–∞–ø—É—â–µ–Ω —Å–ª—É—à–∞—Ç–µ–ª—å –∫–æ–º–∞–Ω–¥ Telegram...")
            while self.bot.is_running:
                try:
                    url = f"https://api.telegram.org/bot{self.token}/getUpdates"
                    params = {'offset': self.last_update_id + 1, 'timeout': 20}  # –£–≤–µ–ª–∏—á–∏–ª–∏ —Ç–∞–π–º–∞—É—Ç
                    response = requests.get(url, params=params, timeout=25)  # –£–≤–µ–ª–∏—á–∏–ª–∏ –æ–±—â–∏–π —Ç–∞–π–º–∞—É—Ç
                    data = response.json()
                    if data["ok"] and data["result"]:
                        for update in data["result"]:
                            self.last_update_id = update["update_id"]
                            if "message" in update and "text" in update["message"]:
                                message_text = update["message"]["text"]
                                log_info(f"üì® –ü–æ–ª—É—á–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞: {message_text}")
                                # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
                                threading.Thread(
                                    target=self.message_handler.handle_message,
                                    args=(message_text,),
                                    daemon=True
                                ).start()
                            # –û–±—Ä–∞–±–æ—Ç–∫–∞ callback –æ—Ç inline –∫–Ω–æ–ø–æ–∫
                            if "callback_query" in update:
                                callback_data = update["callback_query"]["data"]
                                log_info(f"üì® –ü–æ–ª—É—á–µ–Ω callback: {callback_data}")
                                threading.Thread(
                                    target=self.message_handler.handle_callback,
                                    args=(callback_data,),
                                    daemon=True
                                ).start()
                except requests.exceptions.Timeout:
                    continue
                except Exception as e:
                    log_error(f"‚ùå –û—à–∏–±–∫–∞ –≤ —Å–ª—É—à–∞—Ç–µ–ª–µ –∫–æ–º–∞–Ω–¥: {e}")
                    time.sleep(10)  # –£–≤–µ–ª–∏—á–∏–ª–∏ –ø–∞—É–∑—É –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
        threading.Thread(target=listener, daemon=True).start()

    def send_market_update(self, market_data, signal, ml_confidence, ml_signal):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä—ã–Ω–∫–∞ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–∑–∏—Ü–∏–∏ - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø"""
        if not self.bot.settings.settings['enable_price_updates']:
            return
        symbol = self.bot.settings.trading_pairs['active_pair']
        pair_name = self.bot.settings.get_active_pair_name()
        # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± EMA - –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –†–ê–°–ß–ï–¢
        ema_diff_percent = market_data.get('ema_diff_percent', 0) * 100
        # –ü–†–ê–í–ò–õ–¨–ù–û–ï –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –°–¢–ê–¢–£–°–ê EMA
        if ema_diff_percent > 0.1:  # –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π —Ä–æ—Å—Ç
            ema_status = "üü¢ –í–í–ï–†–•"
        elif ema_diff_percent < -0.1:  # –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ
            ema_status = "üî¥ –í–ù–ò–ó"
        else:  # –ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ
            ema_status = "‚ö™ –ù–ï–ô–¢–†–ê–õ–¨–ù–û"
        # –ü–æ–ª—É—á–∞–µ–º –±–∞–ª–∞–Ω—Å –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞ —Å—Ç–∞–≤–∫–∏
        balance = self.bot.exchange.get_balance()
        total_usdt = balance['total_usdt'] if balance else 0
        trade_amount_percent = self.bot.settings.settings['trade_amount_percent']
        position_size_usdt = total_usdt * trade_amount_percent
        # –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–∑–∏—Ü–∏–∏
        position_info = ""
        if self.bot.position == 'long':
            strategy = self.bot.get_active_strategy()
            current_price = market_data['current_price']
            # üí∞ –ò–°–ü–û–õ–¨–ó–£–ï–ú –§–ò–ö–°–ò–†–û–í–ê–ù–ù–´–ô –†–ê–ó–ú–ï–† –ü–û–ó–ò–¶–ò–ò –ò–ó –°–¢–†–ê–¢–ï–ì–ò–ò
            if hasattr(strategy, 'position_size_usdt') and strategy.position_size_usdt > 0:
                # –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ –∏–∑ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
                position_size_usdt = strategy.position_size_usdt
            elif hasattr(self.bot, 'current_position_size_usdt') and self.bot.current_position_size_usdt > 0:
                # –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ –∏–∑ –±–æ—Ç–∞
                position_size_usdt = self.bot.current_position_size_usdt
            else:
                # Fallback: –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞—Å—á–µ—Ç –∏–∑ –±–∞–ª–∞–Ω—Å–∞
                position_size_usdt = total_usdt * trade_amount_percent if balance else 0
            # –ò–°–ü–û–õ–¨–ó–£–ï–ú –§–ò–ö–°–ò–†–û–í–ê–ù–ù–£–Æ –¶–ï–ù–£ –í–•–û–î–ê –ò–ó –°–¢–†–ê–¢–ï–ì–ò–ò
            if hasattr(strategy, 'entry_price') and strategy.entry_price > 0:
                entry_price = strategy.entry_price
                # –†–ê–°–ß–ï–¢ –ê–ë–°–û–õ–Æ–¢–ù–´–• –ó–ù–ê–ß–ï–ù–ò–ô
                current_profit_percent = ((current_price - entry_price) / entry_price) * 100
                current_profit_usdt = position_size_usdt * (current_profit_percent / 100)  # –ü—Ä–∏–±—ã–ª—å/—É–±—ã—Ç–æ–∫ –≤ USDT
                # –†–∞—Å—á–µ—Ç –¥–æ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç–∞
                take_profit = strategy.settings.get('take_profit_percent', 2.0)
                taker_fee = strategy.settings.get('taker_fee', 0.001)
                total_fees = taker_fee * 2 * 100  # 0.2%
                needed_profit = take_profit + total_fees
                remaining_to_tp = max(0, needed_profit - current_profit_percent)
                remaining_profit_usdt = position_size_usdt * (remaining_to_tp / 100)  # –û—Å—Ç–∞–≤—à–∞—è—Å—è –ø—Ä–∏–±—ã–ª—å –¥–æ TP –≤ USDT
                # –ö–æ–º–∏—Å—Å–∏–∏ –≤ USDT
                fees_usdt = position_size_usdt * (total_fees / 100)
                position_info = f"""
üíº <b>–ü–û–ó–ò–¶–ò–Ø –û–¢–ö–†–´–¢–ê</b>
üí∞ <b>–†–∞–∑–º–µ—Ä —Å—Ç–∞–≤–∫–∏:</b> {position_size_usdt:.2f} USDT ({trade_amount_percent*100:.1f}%)
üéØ <b>–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞:</b> {entry_price:.2f} USDT
üìà <b>–¢–µ–∫—É—â–∞—è –ø—Ä–∏–±—ã–ª—å:</b> 
{current_profit_percent:+.2f}% ({current_profit_usdt:+.2f} USDT)
üéØ <b>–î–æ Take Profit:</b> 
+{remaining_to_tp:.2f}% (+{remaining_profit_usdt:.2f} USDT)
üõ°Ô∏è <b>–ö–æ–º–∏—Å—Å–∏–∏:</b> {total_fees:.2f}% ({fees_usdt:.2f} USDT)
"""
        # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–∑–º–µ—Ä–µ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç–∞–≤–∫–∏ (–µ—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è –Ω–µ –æ—Ç–∫—Ä—ã—Ç–∞)
        next_trade_info = ""
        if self.bot.position != 'long':
            next_trade_info = f"üí∞ <b>–°–ª–µ–¥—É—é—â–∞—è —Å—Ç–∞–≤–∫–∞:</b> {position_size_usdt:.2f} USDT ({trade_amount_percent*100:.1f}%)"
        # –ü–†–ê–í–ò–õ–¨–ù–û–ï –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–ï –°–ò–ì–ù–ê–õ–ê
        signal_display = signal.upper()
        if signal == 'buy':
            signal_display = "üü¢ –ü–û–ö–£–ü–ö–ê"
        elif signal == 'sell':
            signal_display = "üî¥ –ü–†–û–î–ê–ñ–ê"
        elif signal == 'wait':
            signal_display = "‚ö™ –û–ñ–ò–î–ê–ù–ò–ï"
        message = f"""
üìà <b>–û–ë–ù–û–í–õ–ï–ù–ò–ï –†–´–ù–ö–ê</b>
üí± <b>–ü–∞—Ä–∞:</b> {pair_name}
üí∞ <b>–¶–µ–Ω–∞:</b> {market_data['current_price']:.2f} USDT
üìä <b>24—á:</b> {market_data.get('price_change_24h', 0):+.2f}%
üìà <b>EMA:</b> {ema_status} ({ema_diff_percent:+.2f}%)
üéØ <b>–°–∏–≥–Ω–∞–ª:</b> {signal_display}
ü§ñ <b>ML:</b> {ml_signal} ({ml_confidence:.1%})
{next_trade_info}
{position_info}
‚è∞ {datetime.now().strftime("%H:%M:%S")}
"""
        self.send_message(message)

    def send_trade_signal(self, signal, market_data, ml_confidence, ml_signal, strategy_name, order_message, position_size_usdt=0, profit_usdt=0):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–∏–≥–Ω–∞–ª–∞ –æ —Å–¥–µ–ª–∫–µ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ä–∞–∑–º–µ—Ä–µ –ø–æ–∑–∏—Ü–∏–∏ - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø"""
        if signal == 'buy':
            emoji = "üü¢"
            action = "–ü–û–ö–£–ü–ö–ê"
        else:
            emoji = "üî¥"
            action = "–ü–†–û–î–ê–ñ–ê"
        # –î–æ–±–∞–≤–ª—è–µ–º EMA –≤ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–¥–µ–ª–∫–µ
        ema_diff_percent = market_data.get('ema_diff_percent', 0) * 100
        # –ü–†–ê–í–ò–õ–¨–ù–û–ï –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –°–¢–ê–¢–£–°–ê EMA
        if ema_diff_percent > 0.1:
            ema_status = "üü¢ –í–í–ï–†–•"
        elif ema_diff_percent < -0.1:
            ema_status = "üî¥ –í–ù–ò–ó"
        else:
            ema_status = "‚ö™ –ù–ï–ô–¢–†–ê–õ–¨–ù–û"
        # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–∑–º–µ—Ä–µ –ø–æ–∑–∏—Ü–∏–∏
        position_info = ""
        if position_size_usdt > 0:
            if signal == 'buy':
                position_info = f"üí∞ <b>–†–∞–∑–º–µ—Ä —Å—Ç–∞–≤–∫–∏:</b> {position_size_usdt:.2f} USDT"
            else:
                position_info = f"üí∞ <b>–†–∞–∑–º–µ—Ä —Å—Ç–∞–≤–∫–∏:</b> {position_size_usdt:.2f} USDT"
        # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–∏–±—ã–ª–∏
        profit_info = ""
        if profit_usdt != 0:
            profit_emoji = "üìà" if profit_usdt > 0 else "üìâ"
            profit_info = f"{profit_emoji} <b>–ü—Ä–∏–±—ã–ª—å:</b> {profit_usdt:+.2f} USDT"
        message = f"""
{emoji} <b>–°–î–ï–õ–ö–ê {action}</b>
üéØ <b>–°—Ç—Ä–∞—Ç–µ–≥–∏—è:</b> {strategy_name}
üí± <b>–ü–∞—Ä–∞:</b> {self.bot.settings.get_active_pair_name()}
üí∞ <b>–¶–µ–Ω–∞:</b> {market_data['current_price']:.2f} USDT
{position_info}
üìà <b>EMA:</b> {ema_status} ({ema_diff_percent:+.2f}%)
ü§ñ <b>ML —Å–∏–≥–Ω–∞–ª:</b> {ml_signal} ({ml_confidence:.1%})
{profit_info}
üìù <b>–°—Ç–∞—Ç—É—Å:</b> {order_message}
{'üî∏ –î–ï–ú–û-–†–ï–ñ–ò–ú' if self.bot.settings.settings['demo_mode'] else 'üîπ –†–ï–ê–õ–¨–ù–ê–Ø –°–î–ï–õ–ö–ê'}
"""
        self.send_message(message)

    def send_balance_update(self, force_send=False):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö"""
        balance = self.bot.exchange.get_balance()
        if not balance:
            return
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–∏–ª—Å—è –ª–∏ –±–∞–ª–∞–Ω—Å
        balance_changed = (
            self.last_balance is None or
            abs(balance['total_usdt'] - self.last_balance['total_usdt']) > 0.01 or  # –ò–∑–º–µ–Ω–µ–Ω–∏–µ > 0.01 USDT
            abs(balance['free_usdt'] - self.last_balance['free_usdt']) > 0.01 or
            abs(balance['total_btc'] - self.last_balance['total_btc']) > 0.000001   # –ò–∑–º–µ–Ω–µ–Ω–∏–µ > 0.000001 BTC
        )
        if not balance_changed and not force_send:
            log_info("üí∞ –ë–∞–ª–∞–Ω—Å –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è - —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º")
            return
        self.last_balance = balance.copy()  # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å
        # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç–∞–≤–∫–∏
        trade_amount_percent = self.bot.settings.settings['trade_amount_percent']
        next_trade_amount = balance['total_usdt'] * trade_amount_percent
        message = f"""
üí∞ <b>–û–ë–ù–û–í–õ–ï–ù–ò–ï –ë–ê–õ–ê–ù–°–ê</b>
üíµ <b>USDT:</b> {balance['total_usdt']:.2f}
‚Ä¢ –°–≤–æ–±–æ–¥–Ω–æ: {balance['free_usdt']:.2f}
‚Ä¢ –ó–∞–Ω—è—Ç–æ: {balance['used_usdt']:.2f}
‚Çø <b>BTC:</b> {balance['total_btc']:.6f}
‚Ä¢ –°–≤–æ–±–æ–¥–Ω–æ: {balance['free_btc']:.6f}
üéØ <b>–°–ª–µ–¥—É—é—â–∞—è —Å—Ç–∞–≤–∫–∞:</b> {next_trade_amount:.2f} USDT ({trade_amount_percent*100:.1f}%)
üìä <b>–í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫:</b> {self.bot.metrics.total_trades}
üéØ <b>Win Rate:</b> {self.bot.metrics.win_rate:.1f}%
‚è∞ {datetime.now().strftime("%H:%M:%S")}
"""
        self.send_message(message)

    def send_welcome_message(self):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è"""
        if not self.token or not self.chat_id:
            return
        # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä —Å—Ç–∞–≤–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞
        balance = self.bot.exchange.get_balance()
        trade_amount_percent = self.bot.settings.settings['trade_amount_percent']
        next_trade_amount = balance['total_usdt'] * trade_amount_percent if balance else 0
        message = f"""
ü§ñ <b>–¢–û–†–ì–û–í–´–ô –ë–û–¢ –ê–ö–¢–ò–í–ò–†–û–í–ê–ù</b>
‚úÖ <b>–°—Ç–∞—Ç—É—Å:</b> –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
üí± <b>–ü–∞—Ä–∞:</b> {self.bot.settings.get_active_pair_name()}
üéØ <b>–°—Ç—Ä–∞—Ç–µ–≥–∏—è:</b> {self.bot.settings.get_active_strategy_name()}
ü§ñ <b>ML:</b> {'‚úÖ –í–ö–õ–Æ–ß–ï–ù' if self.bot.settings.ml_settings['enabled'] else '‚ùå –í–´–ö–õ–Æ–ß–ï–ù'}
üí∞ <b>–†–∞–∑–º–µ—Ä —Å—Ç–∞–≤–∫–∏:</b> {next_trade_amount:.2f} USDT ({trade_amount_percent*100:.1f}%)
üìä <b>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã:</b>
‚Ä¢ /start - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
‚Ä¢ üìä –°—Ç–∞—Ç—É—Å - –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
‚Ä¢ üíº –ò–Ω—Ñ–æ –∞–∫–∫–∞—É–Ω—Ç–∞ - –ë–∞–ª–∞–Ω—Å –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
‚Ä¢ ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –±–æ—Ç–∞
‚è∞ {datetime.now().strftime("%d.%m.%Y %H:%M:%S")}
"""
        self.send_message(message)
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: telegram\handlers.py
[FILE_CONTENT_BEGIN]
"""
–û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–û–ë–©–ï–ù–ò–ô TELEGRAM
"""
import threading
import time
from utils.logger import log_info, log_error
from utils.helpers import validate_number_input

class MessageHandler:
    def __init__(self, trading_bot):
        self.bot = trading_bot
        self.waiting_for_input = None

    def handle_message(self, message_text):
        """–û—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π"""
        try:
            if self.waiting_for_input:
                self.handle_direct_input(message_text)
                return

            self.bot.telegram.send_message("‚è≥ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é –∑–∞–ø—Ä–æ—Å...")
            # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ "–ù–∞–∑–∞–¥"
            if message_text in ['üîô –ù–∞–∑–∞–¥ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º', 'üîô –ù–∞–∑–∞–¥']:
                self.send_settings_menu()
                return
            if message_text == 'üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é':
                self.send_main_menu()
                return
            # –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é
            if message_text == '/start':
                self.send_main_menu()
            elif message_text == 'üìä –°—Ç–∞—Ç—É—Å':
                self.send_status()
            elif message_text == 'üíº –ò–Ω—Ñ–æ –∞–∫–∫–∞—É–Ω—Ç–∞':
                self.send_account_info()
            elif message_text == '‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏':
                self.send_settings_menu()
            elif message_text == 'üìà –°–¥–µ–ª–∫–∏':
                self.send_trade_history()
            elif message_text == 'üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞':
                self.send_analytics()
            elif message_text == '‚ö° –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ':
                self.send_trading_control_menu()
            elif message_text == 'üîÑ –û–±–Ω–æ–≤–∏—Ç—å':
                self.send_market_update()
            elif message_text == 'üö® –≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞':
                self.emergency_stop()
            # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ –Ω–∞—Å—Ç—Ä–æ–µ–∫
            elif 'üìà EMA –ø–æ—Ä–æ–≥:' in message_text:
                self.start_ema_threshold_input()
            elif 'üí∞ –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏:' in message_text:
                self.start_trade_amount_input()
            elif 'üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏—è:' in message_text:
                self.send_strategy_menu()
            elif 'üí± –ü–∞—Ä–∞:' in message_text:
                self.send_pairs_menu()
            # –û–±—Ä–∞–±–æ—Ç–∫–∞ ML –Ω–∞—Å—Ç—Ä–æ–µ–∫
            elif 'ü§ñ ML –ù–∞—Å—Ç—Ä–æ–π–∫–∏' in message_text:
                self.send_ml_settings_menu()
            elif any(cmd in message_text for cmd in ['ü§ñ ML:', 'üéØ –ü–æ—Ä–æ–≥ –ø–æ–∫—É–ø–∫–∏:', 'üéØ –ü–æ—Ä–æ–≥ –ø—Ä–æ–¥–∞–∂–∏:', 'üîÑ –ü–µ—Ä–µ–æ–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å']):
                self.handle_ml_settings_selection(message_text)
            # –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ EMA
            elif '‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ EMA' in message_text:
                self.send_ema_settings_menu()
            elif any(cmd in message_text for cmd in ['üéØ Take Profit:', 'üõë Stop Loss:', 'üìâ Trailing Stop:', '‚è∞ Min Hold Time:']):
                self.handle_ema_settings_selection(message_text)
            elif 'üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è:' in message_text:
                self.toggle_price_updates()
            # –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
            elif any(strategy_name in message_text for strategy_name in self.bot.settings.strategy_settings['available_strategies'].values()):
                self.handle_strategy_selection(message_text)
            # –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –ø–∞—Ä—ã
            elif any(pair_name in message_text for pair_name in self.bot.settings.trading_pairs['available_pairs'].values()):
                self.handle_pair_selection(message_text)
            # –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ—Ä–≥–æ–≤–ª–µ–π
            elif 'üìä –¢–æ—Ä–≥–æ–≤–ª—è:' in message_text:
                self.toggle_trading_enabled()
            elif 'üéØ –°–∏–≥–Ω–∞–ª—ã:' in message_text:
                self.toggle_trade_signals()
            elif 'üîß –†–µ–∂–∏–º:' in message_text:
                self.toggle_demo_mode()
            elif message_text == 'üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –±–æ—Ç':
                self.restart_bot()
            # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
            elif message_text == 'üìà –î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç':
                self.send_detailed_report()
            elif message_text == 'üìä –ì—Ä–∞—Ñ–∏–∫–∏':
                self.send_charts_info()
            elif message_text == 'üßπ –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É':
                self.clear_statistics()
        except Exception as e:
            error_msg = f"‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥—ã: {e}"
            log_error(error_msg)
            self.bot.telegram.send_message(error_msg)

    def handle_callback(self, callback_data):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ callback –æ—Ç inline –∫–Ω–æ–ø–æ–∫"""
        try:
            log_info(f"üîò –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º callback: {callback_data}")
            # –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É inline –∫–Ω–æ–ø–æ–∫
        except Exception as e:
            log_error(f"‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ callback: {e}")

    def handle_ml_settings_selection(self, message_text):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ ML –Ω–∞—Å—Ç—Ä–æ–µ–∫"""
        try:
            if "ü§ñ ML:" in message_text:
                self.toggle_ml_enabled()
            elif "üéØ –ü–æ—Ä–æ–≥ –ø–æ–∫—É–ø–∫–∏:" in message_text:
                self.start_ml_buy_threshold_input()
            elif "üéØ –ü–æ—Ä–æ–≥ –ø—Ä–æ–¥–∞–∂–∏:" in message_text:
                self.start_ml_sell_threshold_input()
            elif "üîÑ –ü–µ—Ä–µ–æ–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å" in message_text:
                self.retrain_ml_model()
            elif "üîô –ù–∞–∑–∞–¥ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º" in message_text:
                self.send_settings_menu()
            else:
                self.bot.telegram.send_message("‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ ML –Ω–∞—Å—Ç—Ä–æ–µ–∫")
        except Exception as e:
            error_msg = f"‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ ML –Ω–∞—Å—Ç—Ä–æ–µ–∫: {e}"
            log_error(error_msg)
            self.bot.telegram.send_message(error_msg)

    def handle_ema_settings_selection(self, message_text):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ EMA"""
        try:
            strategy = self.bot.get_active_strategy()
            if "üéØ Take Profit:" in message_text:
                self.start_take_profit_input()
            elif "üõë Stop Loss:" in message_text:
                self.start_stop_loss_input()
            elif "üìâ Trailing Stop:" in message_text:
                self.toggle_trailing_stop()
            elif "‚è∞ Min Hold Time:" in message_text:
                self.start_min_hold_time_input()
        except Exception as e:
            error_msg = f"‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ EMA: {e}"
            log_error(error_msg)
            self.bot.telegram.send_message(error_msg)

    def handle_direct_input(self, message_text):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä—è–º–æ–≥–æ –≤–≤–æ–¥–∞ –∑–Ω–∞—á–µ–Ω–∏–π"""
        try:
            if message_text == '‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –≤–≤–æ–¥':
                self.waiting_for_input = None
                self.bot.telegram.send_message("‚ùå –í–≤–æ–¥ –æ—Ç–º–µ–Ω–µ–Ω")
                self.send_settings_menu()
                return
            try:
                value = float(message_text.replace(',', '.'))
            except ValueError:
                self.bot.telegram.send_message("‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ")
                return
            if self.waiting_for_input == 'ema_threshold':
                if validate_number_input(value, 0.01, 10.0):
                    self.bot.settings.settings['ema_cross_threshold'] = value / 100
                    self.bot.settings.save_settings()
                    self.bot.telegram.send_message(f"‚úÖ –ü–æ—Ä–æ–≥ EMA —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: <b>{value:.2f}%</b>")
                    self.send_settings_menu()
                else:
                    self.bot.telegram.send_message("‚ùå –ó–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 0.01 –¥–æ 10.0")
            elif self.waiting_for_input == 'trade_amount':
                if validate_number_input(value, 1.0, 100.0):
                    self.bot.settings.settings['trade_amount_percent'] = value / 100
                    self.bot.settings.save_settings()
                    self.bot.telegram.send_message(f"‚úÖ –†–∞–∑–º–µ—Ä —Å—Ç–∞–≤–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: <b>{value:.1f}%</b>")
                    self.send_settings_menu()
                else:
                    self.bot.telegram.send_message("‚ùå –ó–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 1.0 –¥–æ 100.0")
            elif self.waiting_for_input == 'ml_buy_threshold':
                if validate_number_input(value, 0.1, 0.9):
                    self.bot.settings.ml_settings['confidence_threshold_buy'] = value
                    self.bot.settings.save_settings()
                    self.bot.telegram.send_message(f"‚úÖ –ü–æ—Ä–æ–≥ ML –¥–ª—è –ø–æ–∫—É–ø–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: <b>{value:.1f}</b>")
                    self.send_ml_settings_menu()
                else:
                    self.bot.telegram.send_message("‚ùå –ó–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 0.1 –¥–æ 0.9")
            elif self.waiting_for_input == 'ml_sell_threshold':
                if validate_number_input(value, 0.1, 0.9):
                    self.bot.settings.ml_settings['confidence_threshold_sell'] = value
                    self.bot.settings.save_settings()
                    self.bot.telegram.send_message(f"‚úÖ –ü–æ—Ä–æ–≥ ML –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: <b>{value:.1f}</b>")
                    self.send_ml_settings_menu()
                else:
                    self.bot.telegram.send_message("‚ùå –ó–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 0.1 –¥–æ 0.9")
            elif self.waiting_for_input == 'take_profit':
                if validate_number_input(value, 0.5, 20.0):
                    strategy = self.bot.get_active_strategy()
                    strategy.settings['take_profit_percent'] = value
                    self.bot.telegram.send_message(f"‚úÖ Take Profit —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: <b>{value:.1f}%</b>")
                    self.send_ema_settings_menu()
                else:
                    self.bot.telegram.send_message("‚ùå –ó–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 0.5 –¥–æ 20.0")
            elif self.waiting_for_input == 'stop_loss':
                if validate_number_input(value, 0.5, 10.0):
                    strategy = self.bot.get_active_strategy()
                    strategy.settings['stop_loss_percent'] = value
                    self.bot.telegram.send_message(f"‚úÖ Stop Loss —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: <b>{value:.1f}%</b>")
                    self.send_ema_settings_menu()
                else:
                    self.bot.telegram.send_message("‚ùå –ó–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 0.5 –¥–æ 10.0")
            elif self.waiting_for_input == 'min_hold_time':
                if validate_number_input(value, 1, 60):
                    strategy = self.bot.get_active_strategy()
                    strategy.settings['min_hold_time'] = int(value) * 60  # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ —Å–µ–∫—É–Ω–¥—ã
                    self.bot.telegram.send_message(f"‚úÖ Min Hold Time —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: <b>{value} –º–∏–Ω</b>")
                    self.send_ema_settings_menu()
                else:
                    self.bot.telegram.send_message("‚ùå –ó–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 1 –¥–æ 60 –º–∏–Ω—É—Ç")
            self.waiting_for_input = None
        except Exception as e:
            error_msg = f"‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–≤–æ–¥–∞: {e}"
            log_error(error_msg)
            self.bot.telegram.send_message(error_msg)

    def handle_strategy_selection(self, message_text):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏"""
        for strategy_id, strategy_name in self.bot.settings.strategy_settings['available_strategies'].items():
            if strategy_name in message_text:
                old_strategy = self.bot.settings.strategy_settings['active_strategy']
                self.bot.settings.strategy_settings['active_strategy'] = strategy_id
                self.bot.settings.save_settings()
                message = f"""
‚úÖ <b>–°–¢–†–ê–¢–ï–ì–ò–Ø –ò–ó–ú–ï–ù–ï–ù–ê</b>

üîÑ –ë—ã–ª–æ: <b>{self.bot.settings.strategy_settings['available_strategies'][old_strategy]}</b>
üéØ –°—Ç–∞–ª–æ: <b>{strategy_name}</b>

üí° –ë–æ—Ç —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏.
"""
                self.bot.telegram.send_message(message)
                self.send_strategy_menu()
                return

    def handle_pair_selection(self, message_text):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ç–æ—Ä–≥–æ–≤–æ–π –ø–∞—Ä—ã"""
        for pair_id, pair_name in self.bot.settings.trading_pairs['available_pairs'].items():
            if pair_name in message_text:
                old_pair = self.bot.settings.trading_pairs['active_pair']
                self.bot.settings.trading_pairs['active_pair'] = pair_id
                self.bot.settings.settings['symbol'] = pair_id
                self.bot.settings.save_settings()
                new_data = self.bot.exchange.get_market_data(pair_id)
                if new_data:
                    message = f"""
‚úÖ <b>–¢–û–†–ì–û–í–ê–Ø –ü–ê–†–ê –ò–ó–ú–ï–ù–ï–ù–ê</b>

üîÑ –ë—ã–ª–æ: <b>{old_pair}</b>
üéØ –°—Ç–∞–ª–æ: <b>{pair_id} - {pair_name}</b>

üí∞ –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞: <b>{new_data['current_price']:.2f} USDT</b>
üìà –ò–∑–º–µ–Ω–µ–Ω–∏–µ 24—á: <b>{new_data['price_change_24h']:+.2f}%</b>
"""
                else:
                    message = f"""
‚úÖ <b>–¢–û–†–ì–û–í–ê–Ø –ü–ê–†–ê –ò–ó–ú–ï–ù–ï–ù–ê</b>

üîÑ –ë—ã–ª–æ: <b>{old_pair}</b>  
üéØ –°—Ç–∞–ª–æ: <b>{pair_id} - {pair_name}</b>
"""
                self.bot.telegram.send_message(message)
                self.send_pairs_menu()
                return

    # –ú–µ—Ç–æ–¥—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ –º–µ–Ω—é
    def send_main_menu(self):
        message, keyboard = self.bot.telegram.menu_manager.send_main_menu()
        self.bot.telegram.send_message(message, keyboard)

    def send_settings_menu(self):
        message, keyboard = self.bot.telegram.menu_manager.send_settings_menu()
        self.bot.telegram.send_message(message, keyboard)

    def send_ema_settings_menu(self):
        message, keyboard = self.bot.telegram.menu_manager.send_ema_settings_menu()
        self.bot.telegram.send_message(message, keyboard)

    def send_strategy_menu(self):
        message, keyboard = self.bot.telegram.menu_manager.send_strategy_menu()
        self.bot.telegram.send_message(message, keyboard)

    def send_pairs_menu(self):
        message, keyboard = self.bot.telegram.menu_manager.send_pairs_menu()
        self.bot.telegram.send_message(message, keyboard)

    def send_ml_settings_menu(self):
        message, keyboard = self.bot.telegram.menu_manager.send_ml_settings_menu()
        self.bot.telegram.send_message(message, keyboard)

    def send_trading_control_menu(self):
        message, keyboard = self.bot.telegram.menu_manager.send_trading_control_menu()
        self.bot.telegram.send_message(message, keyboard)

    def send_analytics(self):
        message, keyboard = self.bot.telegram.menu_manager.send_analytics_menu()
        self.bot.telegram.send_message(message, keyboard)

    def send_detailed_report(self):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞"""
        from analytics.reporter import ReportGenerator
        reporter = ReportGenerator(self.bot.metrics)
        report = reporter.generate_performance_report()
        self.bot.telegram.send_message(report)

    def send_charts_info(self):
        """–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥—Ä–∞—Ñ–∏–∫–∞—Ö"""
        message = """
üìä <b>–ì–†–ê–§–ò–ö–ò –ò –í–ò–ó–£–ê–õ–ò–ó–ê–¶–ò–Ø</b>

üìà <b>–î–æ—Å—Ç—É–ø–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏:</b>
‚Ä¢ üìä –ì—Ä–∞—Ñ–∏–∫ —Ü–µ–Ω —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏
‚Ä¢ üìâ –ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫
‚Ä¢ üéØ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
‚Ä¢ ‚ö° –£—Ä–æ–≤–Ω–∏ —Ä–∏—Å–∫–∞

üí° <b>–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ:</b>
–í —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ –¥–ª—è –ª—É—á—à–µ–π –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö.
"""
        self.bot.telegram.send_message(message)

    def clear_statistics(self):
        """–û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏"""
        self.bot.metrics.reset_metrics()
        message = "üßπ <b>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—á–∏—â–µ–Ω–∞</b>\n\n–í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –∏ –∏—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫ —Å–±—Ä–æ—à–µ–Ω—ã."
        self.bot.telegram.send_message(message)

    # –ú–µ—Ç–æ–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
    def start_ema_threshold_input(self):
        self.waiting_for_input = 'ema_threshold'
        keyboard = self.bot.telegram.menu_manager.create_cancel_keyboard()
        message = f"""
üìà <b>–ù–ê–°–¢–†–û–ô–ö–ê –ü–û–†–û–ì–ê EMA</b>

–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: <b>{self.bot.settings.settings['ema_cross_threshold'] * 100:.2f}%</b>

üí° –í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö:
–ü—Ä–∏–º–µ—Ä—ã:
‚Ä¢ 0.25 –¥–ª—è 0.25%
‚Ä¢ .25 –¥–ª—è 0.25%  
‚Ä¢ 0.5 –¥–ª—è 0.5%
"""
        self.bot.telegram.send_message(message, keyboard)

    def start_trade_amount_input(self):
        self.waiting_for_input = 'trade_amount'
        keyboard = self.bot.telegram.menu_manager.create_cancel_keyboard()
        message = f"""
üí∞ <b>–ù–ê–°–¢–†–û–ô–ö–ê –†–ê–ó–ú–ï–†–ê –°–¢–ê–í–ö–ò</b>

–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: <b>{self.bot.settings.settings['trade_amount_percent'] * 100:.1f}%</b>

üí° –í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö:
–ü—Ä–∏–º–µ—Ä—ã:
‚Ä¢ 25 –¥–ª—è 25%
‚Ä¢ 15.5 –¥–ª—è 15.5%
‚Ä¢ 50 –¥–ª—è 50%
"""
        self.bot.telegram.send_message(message, keyboard)

    def start_ml_buy_threshold_input(self):
        self.waiting_for_input = 'ml_buy_threshold'
        keyboard = self.bot.telegram.menu_manager.create_cancel_keyboard()
        message = f"""
üéØ <b>–ù–ê–°–¢–†–û–ô–ö–ê –ü–û–†–û–ì–ê ML –î–õ–Ø –ü–û–ö–£–ü–ö–ò</b>

–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: <b>{self.bot.settings.ml_settings['confidence_threshold_buy']:.1f}</b>

üí° –í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (0.1 - 0.9):
–ß–µ–º –≤—ã—à–µ –∑–Ω–∞—á–µ–Ω–∏–µ, —Ç–µ–º —Å—Ç—Ä–æ–∂–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤.
–ü—Ä–∏–º–µ—Ä—ã:
‚Ä¢ 0.3 - –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ
‚Ä¢ 0.6 - –±–æ–ª–µ–µ –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ  
‚Ä¢ 0.5 - —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–æ
"""
        self.bot.telegram.send_message(message, keyboard)

    def start_ml_sell_threshold_input(self):
        self.waiting_for_input = 'ml_sell_threshold'
        keyboard = self.bot.telegram.menu_manager.create_cancel_keyboard()
        message = f"""
üéØ <b>–ù–ê–°–¢–†–û–ô–ö–ê –ü–û–†–û–ì–ê ML –î–õ–Ø –ü–†–û–î–ê–ñ–ò</b>

–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: <b>{self.bot.settings.ml_settings['confidence_threshold_sell']:.1f}</b>

üí° –í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (0.1 - 0.9):
–ß–µ–º –Ω–∏–∂–µ –∑–Ω–∞—á–µ–Ω–∏–µ, —Ç–µ–º —Å—Ç—Ä–æ–∂–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤.
–ü—Ä–∏–º–µ—Ä—ã:
‚Ä¢ 0.2 - –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ
‚Ä¢ 0.5 - –±–æ–ª–µ–µ –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ
‚Ä¢ 0.3 - —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–æ
"""
        self.bot.telegram.send_message(message, keyboard)

    def start_take_profit_input(self):
        self.waiting_for_input = 'take_profit'
        keyboard = self.bot.telegram.menu_manager.create_cancel_keyboard()
        strategy = self.bot.get_active_strategy()
        current_tp = strategy.settings.get('take_profit_percent', 2.0)
        message = f"""
üéØ <b>–ù–ê–°–¢–†–û–ô–ö–ê TAKE PROFIT</b>

–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: <b>{current_tp:.1f}%</b>

üí° –í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (0.5 - 20.0%):
Take Profit - –ø—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∏–±—ã–ª–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏.
–ü—Ä–∏–º–µ—Ä—ã:
‚Ä¢ 2.0 - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π TP 2%
‚Ä¢ 1.5 - –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π TP 1.5%
‚Ä¢ 3.0 - –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π TP 3%
"""
        self.bot.telegram.send_message(message, keyboard)

    def start_stop_loss_input(self):
        self.waiting_for_input = 'stop_loss'
        keyboard = self.bot.telegram.menu_manager.create_cancel_keyboard()
        strategy = self.bot.get_active_strategy()
        current_sl = strategy.settings.get('stop_loss_percent', 1.5)
        message = f"""
üõë <b>–ù–ê–°–¢–†–û–ô–ö–ê STOP LOSS</b>

–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: <b>{current_sl:.1f}%</b>

üí° –í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (0.5 - 10.0%):
Stop Loss - –ø—Ä–æ—Ü–µ–Ω—Ç —É–±—ã—Ç–∫–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏.
–ü—Ä–∏–º–µ—Ä—ã:
‚Ä¢ 1.5 - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π SL 1.5%
‚Ä¢ 1.0 - –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π SL 1%
‚Ä¢ 2.0 - –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π SL 2%
"""
        self.bot.telegram.send_message(message, keyboard)

    def start_min_hold_time_input(self):
        self.waiting_for_input = 'min_hold_time'
        keyboard = self.bot.telegram.menu_manager.create_cancel_keyboard()
        strategy = self.bot.get_active_strategy()
        current_time = strategy.settings.get('min_hold_time', 300) // 60
        message = f"""
‚è∞ <b>–ù–ê–°–¢–†–û–ô–ö–ê MIN HOLD TIME</b>

–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: <b>{current_time} –º–∏–Ω</b>

üí° –í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (1 - 60 –º–∏–Ω—É—Ç):
–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ –ø–µ—Ä–µ–¥ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä—ã—Ç–∏—è.
–ü—Ä–∏–º–µ—Ä—ã:
‚Ä¢ 5 - 5 –º–∏–Ω—É—Ç (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)
‚Ä¢ 10 - 10 –º–∏–Ω—É—Ç (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ)
‚Ä¢ 2 - 2 –º–∏–Ω—É—Ç—ã (–∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ)
"""
        self.bot.telegram.send_message(message, keyboard)

    def toggle_ml_enabled(self):
        self.bot.settings.ml_settings['enabled'] = not self.bot.settings.ml_settings['enabled']
        self.bot.settings.save_settings()
        status = "‚úÖ –í–ö–õ–Æ–ß–ï–ù" if self.bot.settings.ml_settings['enabled'] else "‚ùå –í–´–ö–õ–Æ–ß–ï–ù"
        message = f"ü§ñ Machine Learning: <b>{status}</b>"
        self.bot.telegram.send_message(message)
        self.send_ml_settings_menu()

    def toggle_trailing_stop(self):
        strategy = self.bot.get_active_strategy()
        strategy.settings['trailing_stop'] = not strategy.settings.get('trailing_stop', False)
        status = "‚úÖ –í–ö–õ–Æ–ß–ï–ù" if strategy.settings['trailing_stop'] else "‚ùå –í–´–ö–õ–Æ–ß–ï–ù"
        message = f"üìâ Trailing Stop: <b>{status}</b>"
        self.bot.telegram.send_message(message)
        self.send_ema_settings_menu()

    def toggle_trading_enabled(self):
        self.bot.settings.settings['trading_enabled'] = not self.bot.settings.settings['trading_enabled']
        self.bot.settings.save_settings()
        status = "‚úÖ –í–ö–õ–Æ–ß–ï–ù–ê" if self.bot.settings.settings['trading_enabled'] else "‚ùå –û–°–¢–ê–ù–û–í–õ–ï–ù–ê"
        message = f"üìä –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è: <b>{status}</b>"
        self.bot.telegram.send_message(message)
        self.send_trading_control_menu()

    def toggle_trade_signals(self):
        self.bot.settings.settings['enable_trade_signals'] = not self.bot.settings.settings['enable_trade_signals']
        self.bot.settings.save_settings()
        status = "‚úÖ –í–ö–õ–Æ–ß–ï–ù–´" if self.bot.settings.settings['enable_trade_signals'] else "‚ùå –í–´–ö–õ–Æ–ß–ï–ù–´"
        message = f"üéØ –¢–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã: <b>{status}</b>"
        self.bot.telegram.send_message(message)
        self.send_trading_control_menu()

    def toggle_demo_mode(self):
        self.bot.settings.settings['demo_mode'] = not self.bot.settings.settings['demo_mode']
        self.bot.settings.save_settings()
        mode = "üü¢ –î–ï–ú–û-–†–ï–ñ–ò–ú" if self.bot.settings.settings['demo_mode'] else "üî¥ –†–ï–ê–õ–¨–ù–ê–Ø –¢–û–†–ì–û–í–õ–Ø"
        message = f"üîß –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã: <b>{mode}</b>"
        self.bot.telegram.send_message(message)
        self.send_trading_control_menu()

    def toggle_price_updates(self):
        self.bot.settings.settings['enable_price_updates'] = not self.bot.settings.settings['enable_price_updates']
        self.bot.settings.save_settings()
        status = "‚úÖ –í–ö–õ–Æ–ß–ï–ù–´" if self.bot.settings.settings['enable_price_updates'] else "‚ùå –û–¢–ö–õ–Æ–ß–ï–ù–´"
        message = f"üìä –û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω—ã: <b>{status}</b>"
        self.bot.telegram.send_message(message)
        self.send_settings_menu()

    def retrain_ml_model(self):
        message = "ü§ñ –ó–∞–ø—É—â–µ–Ω–æ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ ML –º–æ–¥–µ–ª–∏... –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç."
        self.bot.telegram.send_message(message)
        threading.Thread(target=self.bot.ml_model.train, args=(self.bot.exchange.exchange,), daemon=True).start()

    def restart_bot(self):
        message = "üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –±–æ—Ç–∞..."
        self.bot.telegram.send_message(message)
        self.bot.telegram.send_message("‚úÖ –ë–æ—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω")

    def emergency_stop(self):
        if self.bot.position:
            self.bot.position = None
            self.bot.entry_price = 0
        self.bot.settings.settings['trading_enabled'] = False
        self.bot.settings.save_settings()
        message = "üõë <b>–≠–ö–°–¢–†–ï–ù–ù–ê–Ø –û–°–¢–ê–ù–û–í–ö–ê</b>\n\n–ü–æ–∑–∏—Ü–∏–∏ –∑–∞–∫—Ä—ã—Ç—ã. –¢–æ—Ä–≥–æ–≤–ª—è –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞."
        self.bot.telegram.send_message(message)

    def send_status(self):
        data = self.bot.exchange.get_market_data(self.bot.settings.trading_pairs['active_pair'])
        if not data:
            self.bot.telegram.send_message("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ä—ã–Ω–∫–∞")
            return
        current_pair = self.bot.settings.trading_pairs['active_pair']
        pair_name = self.bot.settings.get_active_pair_name()
        strategy_name = self.bot.settings.get_active_strategy_name()
        ml_confidence, ml_signal = self.bot.ml_model.predict(data.get('ohlcv', []))
        signal = self.bot.get_active_strategy().calculate_signal(data, ml_confidence, ml_signal)
        position_status = "üü¢ –û–¢–ö–†–´–¢–ê" if self.bot.position == 'long' else "‚ö™ –û–ñ–ò–î–ê–ù–ò–ï"
        trend_direction = "üü¢ –í–í–ï–†–•" if data['ema_diff_percent'] > 0 else "üî¥ –í–ù–ò–ó"
        balance = self.bot.exchange.get_balance()
        trade_amount_percent = self.bot.settings.settings['trade_amount_percent']
        next_trade_amount = balance['total_usdt'] * trade_amount_percent if balance else 0
        message = f"""
üìä <b>–†–ê–°–®–ò–†–ï–ù–ù–´–ô –°–¢–ê–¢–£–°</b>

üí± <b>–ü–∞—Ä–∞:</b> {pair_name} ({current_pair})
üéØ <b>–°—Ç—Ä–∞—Ç–µ–≥–∏—è:</b> {strategy_name}
üí∞ <b>–¶–µ–Ω–∞:</b> {data['current_price']:.2f} USDT
üìà <b>–¢—Ä–µ–Ω–¥:</b> {trend_direction} ({data['ema_diff_percent']*100:+.2f}%)
ü§ñ <b>ML —Å–∏–≥–Ω–∞–ª:</b> {ml_signal} ({ml_confidence:.1%})
üéØ <b>–¢–æ—Ä–≥–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª:</b> {signal.upper()}
üìà <b>–ü–æ–∑–∏—Ü–∏—è:</b> {position_status}

üí∞ <b>–°–ª–µ–¥—É—é—â–∞—è —Å—Ç–∞–≤–∫–∞:</b> {next_trade_amount:.2f} USDT ({trade_amount_percent*100:.1f}%)

üìä <b>–ê–ù–ê–õ–ò–¢–ò–ö–ê:</b>
‚Ä¢ Win Rate: {self.bot.metrics.win_rate:.1f}%
‚Ä¢ –ü—Ä–∏–±—ã–ª—å–Ω—ã—Ö: {self.bot.metrics.winning_trades}
‚Ä¢ –í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫: {self.bot.metrics.total_trades}

‚ö° <b>–°–ò–°–¢–ï–ú–ê:</b>
‚Ä¢ –¢–æ—Ä–≥–æ–≤–ª—è: {'‚úÖ –í–ö–õ' if self.bot.settings.settings['trading_enabled'] else '‚ùå –í–´–ö–õ'}
‚Ä¢ ML: {'‚úÖ –í–ö–õ' if self.bot.settings.ml_settings['enabled'] else '‚ùå –í–´–ö–õ'}
‚Ä¢ –†–µ–∂–∏–º: {'üü¢ –î–ï–ú–û' if self.bot.settings.settings['demo_mode'] else 'üî¥ –†–ï–ê–õ–¨–ù–´–ô'}

‚è∞ {self.bot.metrics.get_current_time()}
"""
        self.bot.telegram.send_message(message)

    def send_account_info(self):
        balance = self.bot.exchange.get_balance()
        if not balance:
            self.bot.telegram.send_message("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∞–∫–∫–∞—É–Ω—Ç–µ")
            return
        market_data = self.bot.exchange.get_market_data(self.bot.settings.trading_pairs['active_pair'])
        btc_price = market_data['current_price'] if market_data else 0
        btc_value = balance['total_btc'] * btc_price
        total_value = balance['total_usdt'] + btc_value
        trade_amount_percent = self.bot.settings.settings['trade_amount_percent']
        next_trade_amount = balance['total_usdt'] * trade_amount_percent
        message = f"""
üíº <b>–ò–ù–§–û–†–ú–ê–¶–ò–Ø –û–ë –ê–ö–ö–ê–£–ù–¢–ï</b>

üí∞ <b>–ë–ê–õ–ê–ù–° USDT:</b>
‚Ä¢ –í—Å–µ–≥–æ: {balance['total_usdt']:.2f} USDT
‚Ä¢ –°–≤–æ–±–æ–¥–Ω–æ: {balance['free_usdt']:.2f} USDT
‚Ä¢ –ó–∞–Ω—è—Ç–æ: {balance['used_usdt']:.2f} USDT

‚Çø <b>–ë–ê–õ–ê–ù–° BTC:</b>
‚Ä¢ –í—Å–µ–≥–æ: {balance['total_btc']:.6f} BTC
‚Ä¢ –°–≤–æ–±–æ–¥–Ω–æ: {balance['free_btc']:.6f} BTC
‚Ä¢ –°—Ç–æ–∏–º–æ—Å—Ç—å: {btc_value:.2f} USDT

üìä <b>–û–ë–©–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê:</b>
‚Ä¢ –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: {total_value:.2f} USDT
‚Ä¢ –ü—Ä–∏–±—ã–ª—å –∑–∞ —Å–µ–≥–æ–¥–Ω—è: {self.bot.metrics.daily_profit:.2f} USDT
‚Ä¢ –û—Ç–∫—Ä—ã—Ç–∞ –ø–æ–∑–∏—Ü–∏—è: {'‚úÖ –î–ê' if self.bot.position else '‚ùå –ù–ï–¢'}
‚Ä¢ –í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫: {len(self.bot.metrics.trade_history)}

üéØ <b>–°–õ–ï–î–£–Æ–©–ê–Ø –°–¢–ê–í–ö–ê:</b>
‚Ä¢ –†–∞–∑–º–µ—Ä: {next_trade_amount:.2f} USDT
‚Ä¢ –ü—Ä–æ—Ü–µ–Ω—Ç: {trade_amount_percent*100:.1f}%

‚ö° <b>–°–¢–ê–¢–£–°:</b>
‚Ä¢ –†–µ–∂–∏–º: {'üü¢ –î–ï–ú–û' if self.bot.settings.settings['demo_mode'] else 'üî¥ –†–ï–ê–õ–¨–ù–´–ô'}
‚Ä¢ –¢–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã: {'‚úÖ –í–ö–õ' if self.bot.settings.settings['enable_trade_signals'] else '‚ùå –í–´–ö–õ'}

‚è∞ –û–±–Ω–æ–≤–ª–µ–Ω–æ: {self.bot.metrics.get_current_time()}
"""
        self.bot.telegram.send_message(message)

    def send_trade_history(self):
        if not self.bot.metrics.trade_history:
            message = "üìä <b>–ò–°–¢–û–†–ò–Ø –°–î–ï–õ–û–ö</b>\n\n–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞"
        else:
            message = "üìä <b>–ü–û–°–õ–ï–î–ù–ò–ï –°–î–ï–õ–ö–ò</b>\n\n"
            for trade in self.bot.metrics.trade_history[-5:]:
                emoji = "üü¢" if trade.get('profit', 0) > 0 else "üî¥"
                profit_str = f"+{trade['profit']:.2f}%" if trade.get('profit', 0) > 0 else f"{trade['profit']:.2f}%"
                position_size = trade.get('position_size_usdt', 0)
                message += f"{emoji} {trade['signal'].upper()} - {trade['price']:.2f} USDT ({profit_str}) | –°—Ç–∞–≤–∫–∞: {position_size:.2f} USDT\n"
        self.bot.telegram.send_message(message)

    def send_market_update(self):
        data = self.bot.exchange.get_market_data(self.bot.settings.trading_pairs['active_pair'])
        if not data:
            return
        ml_confidence, ml_signal = self.bot.ml_model.predict(data.get('ohlcv', []))
        signal = self.bot.get_active_strategy().calculate_signal(data, ml_confidence, ml_signal)
        self.bot.telegram.send_market_update(data, signal, ml_confidence, ml_signal)
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: telegram\menus.py
[FILE_CONTENT_BEGIN]
"""
–ú–ï–ù–Æ TELEGRAM –ë–û–¢–ê
"""
from utils.helpers import format_price, format_percent

class MenuManager:
    def __init__(self, trading_bot):
        self.bot = trading_bot

    def create_keyboard(self, buttons, one_time=False):
        """–°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã"""
        return {
            'keyboard': buttons,
            'resize_keyboard': True,
            'one_time_keyboard': one_time
        }

    def create_inline_keyboard(self, buttons):
        """–°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–ª–∞–π–Ω-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã"""
        return {
            'inline_keyboard': buttons
        }

    def create_cancel_keyboard(self):
        """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –æ—Ç–º–µ–Ω—ã –≤–≤–æ–¥–∞"""
        return self.create_keyboard([['‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –≤–≤–æ–¥']], one_time=True)

    def send_main_menu(self):
        """–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"""
        settings = self.bot.settings
        current_pair = settings.get_active_pair_name()
        strategy_name = settings.get_active_strategy_name()
        trading_status = "‚úÖ" if settings.settings['trading_enabled'] else "‚ùå"
        ml_status = "‚úÖ" if settings.ml_settings['enabled'] else "‚ùå"
        keyboard = [
            ['üìä –°—Ç–∞—Ç—É—Å', 'üíº –ò–Ω—Ñ–æ –∞–∫–∫–∞—É–Ω—Ç–∞'],
            ['üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞', 'üìà –°–¥–µ–ª–∫–∏'],
            ['‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏', '‚ö° –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ'],
            ['üîÑ –û–±–Ω–æ–≤–∏—Ç—å', 'üö® –≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞']
        ]
        message = f"""
ü§ñ <b>–†–ê–°–®–ò–†–ï–ù–ù–´–ô –¢–û–†–ì–û–í–´–ô –ë–û–¢ v4.0</b>

üí± <b>–ü–∞—Ä–∞:</b> {current_pair}
üéØ <b>–°—Ç—Ä–∞—Ç–µ–≥–∏—è:</b> {strategy_name}
{trading_status} <b>–¢–æ—Ä–≥–æ–≤–ª—è:</b> {'–í–ö–õ' if settings.settings['trading_enabled'] else '–í–´–ö–õ'}
{ml_status} <b>ML:</b> {'–í–ö–õ' if settings.ml_settings['enabled'] else '–í–´–ö–õ'}

üöÄ <b>–í–û–ó–ú–û–ñ–ù–û–°–¢–ò:</b>
‚Ä¢ üéØ 5 —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
‚Ä¢ üí± –°–º–µ–Ω–∞ –ø–∞—Ä –≤ 1 –∫–ª–∏–∫  
‚Ä¢ ü§ñ –ì–∏–±–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ML
‚Ä¢ ‚ö° –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

üí° <b>–ö–æ–º–∞–Ω–¥—ã:</b>
‚Ä¢ ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ - –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±–æ—Ç–∞
‚Ä¢ ‚ö° –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ - –∫–æ–Ω—Ç—Ä–æ–ª—å —Ç–æ—Ä–≥–æ–≤–ª–∏
‚Ä¢ üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
"""
        return message, self.create_keyboard(keyboard)

    def send_settings_menu(self):
        """–ú–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫"""
        settings = self.bot.settings
        current_pair = settings.get_active_pair_name()
        current_threshold = settings.settings['ema_cross_threshold'] * 100
        keyboard = [
            [f"üìà EMA –ø–æ—Ä–æ–≥: {current_threshold:.2f}%"],
            [f"üí∞ –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏: {settings.settings['trade_amount_percent']*100:.1f}%"],
            [f"üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏—è: {settings.get_active_strategy_name()}"],
            [f"üí± –ü–∞—Ä–∞: {current_pair}"],
            ["ü§ñ ML –ù–∞—Å—Ç—Ä–æ–π–∫–∏"],
            ["‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ EMA"],
            [f"üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è: {'‚úÖ' if settings.settings['enable_price_updates'] else '‚ùå'}"],
            ['üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é']
        ]
        message = f"""
‚öôÔ∏è <b>–ù–ê–°–¢–†–û–ô–ö–ò –ë–û–¢–ê</b>

üìà <b>–°—Ç—Ä–∞—Ç–µ–≥–∏—è EMA:</b>
‚Ä¢ –ü–æ—Ä–æ–≥ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è: <b>{current_threshold:.2f}%</b>
‚Ä¢ –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏: <b>{settings.settings['trade_amount_percent']*100:.1f}%</b>

üéØ <b>–ê–∫—Ç–∏–≤–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è:</b> <b>{settings.get_active_strategy_name()}</b>

üí± <b>–¢–æ—Ä–≥–æ–≤–∞—è –ø–∞—Ä–∞:</b> <b>{current_pair}</b>

ü§ñ <b>Machine Learning:</b> {'‚úÖ –í–ö–õ–Æ–ß–ï–ù' if settings.ml_settings['enabled'] else '‚ùå –í–´–ö–õ–Æ–ß–ï–ù'}

üí° –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è
"""
        return message, self.create_keyboard(keyboard)

    def send_ema_settings_menu(self):
        """–ú–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫ EMA —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏"""
        settings = self.bot.settings
        strategy = self.bot.get_active_strategy()
        if hasattr(strategy, 'settings'):
            ema_settings = strategy.settings
        else:
            ema_settings = {}
        take_profit = ema_settings.get('take_profit_percent', 2.0)
        stop_loss = ema_settings.get('stop_loss_percent', 1.5)
        trailing_stop = ema_settings.get('trailing_stop', False)
        min_hold_time = ema_settings.get('min_hold_time', 300) // 60
        keyboard = [
            [f"üéØ Take Profit: {take_profit:.1f}%"],
            [f"üõë Stop Loss: {stop_loss:.1f}%"],
            [f"üìâ Trailing Stop: {'‚úÖ –í–ö–õ' if trailing_stop else '‚ùå –í–´–ö–õ'}"],
            [f"‚è∞ Min Hold Time: {min_hold_time} –º–∏–Ω"],
            ['üîô –ù–∞–∑–∞–¥ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º']
        ]
        message = f"""
‚öôÔ∏è <b>–ù–ê–°–¢–†–û–ô–ö–ò EMA –°–¢–†–ê–¢–ï–ì–ò–ò</b>

üéØ <b>–£—Å–ª–æ–≤–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è:</b>
‚Ä¢ Take Profit: <b>{take_profit:.1f}%</b>
‚Ä¢ Stop Loss: <b>{stop_loss:.1f}%</b>
‚Ä¢ Trailing Stop: {'‚úÖ –í–ö–õ' if trailing_stop else '‚ùå –í–´–ö–õ'}
‚Ä¢ Min Hold Time: <b>{min_hold_time} –º–∏–Ω</b>

üí° <b>–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:</b>
‚Ä¢ Take Profit - —Ñ–∏–∫—Å–∞—Ü–∏—è –ø—Ä–∏–±—ã–ª–∏
‚Ä¢ Stop Loss - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —É–±—ã—Ç–∫–æ–≤  
‚Ä¢ Trailing Stop - –∑–∞—â–∏—Ç–∞ –ø—Ä–∏–±—ã–ª–∏
‚Ä¢ Min Hold Time - –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è
"""
        return message, self.create_keyboard(keyboard)

    def send_strategy_menu(self):
        """–ú–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏"""
        settings = self.bot.settings
        keyboard = []
        for strategy_id, strategy_name in settings.strategy_settings['available_strategies'].items():
            prefix = "‚úÖ" if strategy_id == settings.strategy_settings['active_strategy'] else "‚ö™"
            keyboard.append([f"{prefix} {strategy_name}"])
        keyboard.append(['üîô –ù–∞–∑–∞–¥ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º'])
        message = f"""
üéØ <b>–í–´–ë–û–† –¢–û–†–ì–û–í–û–ô –°–¢–†–ê–¢–ï–ì–ò–ò</b>

üí° –ê–∫—Ç–∏–≤–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è:
<b>{settings.get_active_strategy_name()}</b>

üìä –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:
‚Ä¢ üìà EMA + ML - –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Å AI
‚Ä¢ ‚ö° Price Action - –ü–æ –¥–≤–∏–∂–µ–Ω–∏—é —Ü–µ–Ω—ã
‚Ä¢ üéØ MACD + RSI - –ö–æ–º–±–æ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
‚Ä¢ üìä Bollinger Bands - –¢–æ—Ä–≥–æ–≤–ª—è –≤ –∫–∞–Ω–∞–ª–∞—Ö
‚Ä¢ üîÑ –ì–∏–±—Ä–∏–¥–Ω–∞—è - –ö–æ–º–±–∏–Ω–∞—Ü–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
"""
        return message, self.create_keyboard(keyboard)

    def send_pairs_menu(self):
        """–ú–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Ç–æ—Ä–≥–æ–≤–æ–π –ø–∞—Ä—ã"""
        settings = self.bot.settings
        keyboard = []
        pairs_list = list(settings.trading_pairs['available_pairs'].items())
        for i in range(0, len(pairs_list), 2):
            row = []
            for j in range(2):
                if i + j < len(pairs_list):
                    pair_id, pair_name = pairs_list[i + j]
                    prefix = "‚úÖ" if pair_id == settings.trading_pairs['active_pair'] else "‚ö™"
                    row.append(f"{prefix} {pair_name}")
            keyboard.append(row)
        keyboard.append(['üîô –ù–∞–∑–∞–¥ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º'])
        current_pair = settings.trading_pairs['active_pair']
        current_name = settings.get_active_pair_name()
        message = f"""
üí± <b>–í–´–ë–û–† –¢–û–†–ì–û–í–û–ô –ü–ê–†–´</b>

üí∞ –ê–∫—Ç–∏–≤–Ω–∞—è –ø–∞—Ä–∞:
<b>{current_pair} - {current_name}</b>

üí° –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—Ä–≥–æ–≤—É—é –ø–∞—Ä—É –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —Ç–æ—Ä–≥–æ–≤–ª–∏.
"""
        return message, self.create_keyboard(keyboard)

    def send_ml_settings_menu(self):
        """–ú–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫ ML"""
        settings = self.bot.settings
        ml_status = "‚úÖ –í–ö–õ–Æ–ß–ï–ù" if settings.ml_settings['enabled'] else "‚ùå –í–´–ö–õ–Æ–ß–ï–ù"
        keyboard = [
            [f"ü§ñ ML: {ml_status}"],
            [f"üéØ –ü–æ—Ä–æ–≥ –ø–æ–∫—É–ø–∫–∏: {settings.ml_settings['confidence_threshold_buy']:.1f}"],
            [f"üéØ –ü–æ—Ä–æ–≥ –ø—Ä–æ–¥–∞–∂–∏: {settings.ml_settings['confidence_threshold_sell']:.1f}"],
            ["üîÑ –ü–µ—Ä–µ–æ–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å"],
            ['üîô –ù–∞–∑–∞–¥ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º']
        ]
        message = f"""
ü§ñ <b>–ù–ê–°–¢–†–û–ô–ö–ò MACHINE LEARNING</b>

üìä <b>–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:</b> <b>{ml_status}</b>

üéØ <b>–ü–æ—Ä–æ–≥–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏:</b>
‚Ä¢ –ü–æ–∫—É–ø–∫–∞: > <b>{settings.ml_settings['confidence_threshold_buy']:.1f}</b>
‚Ä¢ –ü—Ä–æ–¥–∞–∂–∞: < <b>{settings.ml_settings['confidence_threshold_sell']:.1f}</b>

üí° –û–±—ä—è—Å–Ω–µ–Ω–∏–µ:
ML –º–æ–¥–µ–ª—å —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —Å–∏–≥–Ω–∞–ª—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏. –ß–µ–º –≤—ã—à–µ –ø–æ—Ä–æ–≥, —Ç–µ–º —Å—Ç—Ä–æ–∂–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è.
"""
        return message, self.create_keyboard(keyboard)

    def send_trading_control_menu(self):
        """–ú–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ—Ä–≥–æ–≤–ª–µ–π"""
        settings = self.bot.settings
        trading_status = "‚úÖ –í–ö–õ–Æ–ß–ï–ù–ê" if settings.settings['trading_enabled'] else "‚ùå –û–°–¢–ê–ù–û–í–õ–ï–ù–ê"
        signals_status = "‚úÖ –í–ö–õ–Æ–ß–ï–ù–´" if settings.settings['enable_trade_signals'] else "‚ùå –í–´–ö–õ–Æ–ß–ï–ù–´"
        demo_status = "üü¢ –î–ï–ú–û" if settings.settings['demo_mode'] else "üî¥ –†–ï–ê–õ–¨–ù–´–ô"
        keyboard = [
            [f"üìä –¢–æ—Ä–≥–æ–≤–ª—è: {trading_status}"],
            [f"üéØ –°–∏–≥–Ω–∞–ª—ã: {signals_status}"],
            [f"üîß –†–µ–∂–∏–º: {demo_status}"],
            ["üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –±–æ—Ç", "üõë –≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞"],
            ['üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é']
        ]
        message = f"""
‚ö° <b>–£–ü–†–ê–í–õ–ï–ù–ò–ï –¢–û–†–ì–û–í–õ–ï–ô</b>

üìä <b>–°—Ç–∞—Ç—É—Å —Ç–æ—Ä–≥–æ–≤–ª–∏:</b> <b>{trading_status}</b>
üéØ <b>–¢–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã:</b> <b>{signals_status}</b>
üîß <b>–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã:</b> <b>{demo_status}</b>

üí° –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
‚Ä¢ –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Ç–æ—Ä–≥–æ–≤–ª—é
‚Ä¢ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
‚Ä¢ –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –¥–µ–º–æ/—Ä–µ–∂–∏–º
‚Ä¢ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –±–æ—Ç–∞
"""
        return message, self.create_keyboard(keyboard)

    def send_analytics_menu(self):
        """–ú–µ–Ω—é –∞–Ω–∞–ª–∏—Ç–∏–∫–∏"""
        metrics = self.bot.metrics.get_summary()
        message = f"""
üìä <b>–î–ï–¢–ê–õ–¨–ù–ê–Ø –ê–ù–ê–õ–ò–¢–ò–ö–ê</b>

üìà <b>–û–°–ù–û–í–ù–´–ï –ú–ï–¢–†–ò–ö–ò:</b>
‚Ä¢ –í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫: <b>{metrics['total_trades']}</b>
‚Ä¢ Win Rate: <b>{metrics['win_rate']:.1f}%</b>
‚Ä¢ Profit Factor: <b>{metrics['profit_factor']:.2f}</b>
‚Ä¢ –û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å: <b>{metrics['total_profit']:.2f} USDT</b>

üí∞ <b>–°–¢–ê–¢–ò–°–¢–ò–ö–ê –°–î–ï–õ–û–ö:</b>
‚Ä¢ –ü—Ä–∏–±—ã–ª—å–Ω—ã—Ö: <b>{metrics['winning_trades']}</b>
‚Ä¢ –£–±—ã—Ç–æ—á–Ω—ã—Ö: <b>{metrics['losing_trades']}</b>
‚Ä¢ –°—Ä–µ–¥–Ω—è—è –ø—Ä–∏–±—ã–ª—å: <b>{metrics['average_win']:.2f} USDT</b>
‚Ä¢ –°—Ä–µ–¥–Ω–∏–π —É–±—ã—Ç–æ–∫: <b>{metrics['average_loss']:.2f} USDT</b>

üéØ <b>–†–ï–ö–û–†–î–´:</b>
‚Ä¢ –õ—É—á—à–∞—è —Å–¥–µ–ª–∫–∞: <b>{metrics['best_trade']:.2f} USDT</b>
‚Ä¢ –•—É–¥—à–∞—è —Å–¥–µ–ª–∫–∞: <b>{metrics['worst_trade']:.2f} USDT</b>
‚Ä¢ –°–µ—Ä–∏—è –ø–æ–±–µ–¥: <b>{metrics['consecutive_wins']}</b>
‚Ä¢ –°–µ—Ä–∏—è –ø–æ—Ä–∞–∂–µ–Ω–∏–π: <b>{metrics['consecutive_losses']}</b>

‚ö° <b>–†–ò–°–ö–ò:</b>
‚Ä¢ –ú–∞–∫—Å –ø—Ä–æ—Å–∞–¥–∫–∞: <b>{metrics['max_drawdown']:.2f}%</b>
‚Ä¢ –¢–µ–∫—É—â–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞: <b>{metrics['current_drawdown']:.2f}%</b>
"""
        keyboard = [
            ['üìà –î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç', 'üìä –ì—Ä–∞—Ñ–∏–∫–∏'],
            ['üßπ –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É', 'üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é']
        ]
        return message, self.create_keyboard(keyboard)
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: telegram\__init__.py
[FILE_CONTENT_BEGIN]
"""
TELEGRAM –ò–ù–¢–ï–†–§–ï–ô–°
"""
from .bot import TelegramBot
from .menus import MenuManager
from .handlers import MessageHandler

__all__ = ['TelegramBot', 'MenuManager', 'MessageHandler']
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: utils\helpers.py
[FILE_CONTENT_BEGIN]
"""
–í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
"""
import pandas as pd
import numpy as np
from datetime import datetime, timedelta

def calculate_ema(prices, period):
    """–†–∞—Å—á–µ—Ç EMA"""
    return pd.Series(prices).ewm(span=period, adjust=False).mean().iloc[-1]

def calculate_rsi(prices, period=14):
    """–†–∞—Å—á–µ—Ç RSI"""
    try:
        deltas = np.diff(prices)
        gains = np.where(deltas > 0, deltas, 0)
        losses = np.where(deltas < 0, -deltas, 0)
        
        avg_gains = np.mean(gains[-period:])
        avg_losses = np.mean(losses[-period:])
        
        if avg_losses == 0:
            return 100
        
        rs = avg_gains / avg_losses
        rsi = 100 - (100 / (1 + rs))
        return rsi
    except:
        return 50

def calculate_macd(prices, fast=12, slow=26, signal=9):
    """–†–∞—Å—á–µ—Ç MACD"""
    try:
        exp1 = pd.Series(prices).ewm(span=fast).mean()
        exp2 = pd.Series(prices).ewm(span=slow).mean()
        macd = exp1 - exp2
        macd_signal = macd.ewm(span=signal).mean()
        return macd.iloc[-1], macd_signal.iloc[-1]
    except:
        return 0, 0

def calculate_bollinger_bands(prices, period=20, std_dev=2):
    """–†–∞—Å—á–µ—Ç Bollinger Bands"""
    try:
        series = pd.Series(prices)
        sma = series.rolling(period).mean()
        std = series.rolling(period).std()
        upper_band = sma + (std * std_dev)
        lower_band = sma - (std * std_dev)
        return sma.iloc[-1], upper_band.iloc[-1], lower_band.iloc[-1]
    except:
        return 0, 0, 0

def format_price(price):
    """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω—ã"""
    if price >= 1000:
        return f"{price:,.0f}"
    elif price >= 1:
        return f"{price:.2f}"
    else:
        return f"{price:.6f}"

def format_percent(value):
    """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤"""
    return f"{value:+.2f}%"

def is_new_day(last_reset_date):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—É–ø–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –¥–Ω—è"""
    return datetime.now().date() != last_reset_date

def calculate_volatility(prices):
    """–†–∞—Å—á–µ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏"""
    try:
        returns = np.diff(prices) / prices[:-1]
        volatility = np.std(returns) * 100
        return volatility
    except:
        return 0.0

def validate_number_input(value, min_val, max_val):
    """–í–∞–ª–∏–¥–∞—Ü–∏—è —á–∏—Å–ª–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞"""
    try:
        num_value = float(value)
        return min_val <= num_value <= max_val
    except:
        return False
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: utils\logger.py
[FILE_CONTENT_BEGIN]
"""
–õ–û–ì–ì–ò–†–û–í–ê–ù–ò–ï
"""
import logging
import os
from datetime import datetime

def setup_logger():
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–≥–µ—Ä–∞"""
    # –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è –ª–æ–≥–æ–≤ –µ—Å–ª–∏ –µ–µ –Ω–µ—Ç
    if not os.path.exists('logs'):
        os.makedirs('logs')
    
    # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    formatter = logging.Formatter(
        '%(asctime)s - %(name)s - %(levelname)s - %(message)s',
        datefmt='%Y-%m-%d %H:%M:%S'
    )
    
    # –§–∞–π–ª–æ–≤—ã–π –ª–æ–≥–≥–µ—Ä
    file_handler = logging.FileHandler(
        f'logs/bot_{datetime.now().strftime("%Y%m%d")}.log',
        encoding='utf-8'
    )
    file_handler.setFormatter(formatter)
    
    # –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –ª–æ–≥–≥–µ—Ä
    console_handler = logging.StreamHandler()
    console_handler.setFormatter(formatter)
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ª–æ–≥–≥–µ—Ä–∞
    logger = logging.getLogger('TradingBot')
    logger.setLevel(logging.INFO)
    logger.addHandler(file_handler)
    logger.addHandler(console_handler)
    
    return logger

# –°–æ–∑–¥–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π –ª–æ–≥–≥–µ—Ä
logger = setup_logger()

def log_info(message):
    """–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è"""
    logger.info(message)

def log_error(message):
    """–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏"""
    logger.error(message)

def log_warning(message):
    """–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è"""
    logger.warning(message)

def log_debug(message):
    """–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏"""
    logger.debug(message)
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

[FILE_NAME]: utils\__init__.py
[FILE_CONTENT_BEGIN]
"""
–í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –£–¢–ò–õ–ò–¢–´
"""
from .logger import setup_logger, log_info, log_error, log_warning, log_debug
from .helpers import (calculate_ema, calculate_rsi, calculate_macd, 
                     calculate_bollinger_bands, format_price, format_percent, 
                     is_new_day, calculate_volatility, validate_number_input)

__all__ = ['setup_logger', 'log_info', 'log_error', 'log_warning', 'log_debug',
           'calculate_ema', 'calculate_rsi', 'calculate_macd', 'calculate_bollinger_bands',
           'format_price', 'format_percent', 'is_new_day', 'calculate_volatility', 
           'validate_number_input']
[FILE_CONTENT_END]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ


‚úÖ –í—Å–µ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ —Ñ–∞–π–ª–æ–≤: 37
üéØ –¢–∏–ø –ø—Ä–æ–µ–∫—Ç–∞: python
