<!DOCTYPE html>
<!DOCTYPE html>

<html lang="ru">
<html lang="ru">



<head>

  <head>

    <meta charset="UTF-8">
    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>AutoTrading Bot</title>
    <title>KuCoin Trading Bot</title>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
      <style>* {
        * {

          margin: 0;
          margin: 0;

          padding: 0;
          padding: 0;

          box-sizing: border-box;
          box-sizing: border-box;

        }
      }



      :root {
        body {

          --primary-color: #2196F3;
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;

          --success-color: #4CAF50;
          background-color: var(--tg-theme-bg-color, #ffffff);

          --danger-color: #f44336;
          color: var(--tg-theme-text-color, #000000);

          --warning-color: #ff9800;
          padding: 16px;

          --bg-primary: var(--tg-theme-bg-color, #ffffff);
          padding-bottom: 80px;

          --bg-secondary: var(--tg-theme-secondary-bg-color, #f5f5f5);
        }

        --text-primary: var(--tg-theme-text-color, #000000);

        --text-secondary: var(--tg-theme-hint-color, #999999);

        .header {

          --border-color: rgba(0, 0, 0, 0.1);
          text-align: center;

        }

        margin-bottom: 20px;

        padding: 16px;

        body {
          background: var(--tg-theme-secondary-bg-color, #f0f0f0);

          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
          border-radius: 12px;

          background-color: var(--bg-primary);
        }

        color: var(--text-primary);

        padding: 0;

        .header h1 {

          margin: 0;
          font-size: 24px;

          overflow-x: hidden;
          margin-bottom: 8px;

        }
      }



      /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
      .status-badge {

        .nav-bar {
          display: inline-block;

          position: fixed;
          padding: 6px 12px;

          top: 0;
          border-radius: 20px;

          left: 0;
          font-size: 14px;

          right: 0;
          font-weight: 600;

          background: var(--bg-secondary);
        }

        border-bottom: 1px solid var(--border-color);

        display: flex;

        .status-running {

          justify-content: space-around;
          background: #4CAF50;

          padding: 12px 0;
          color: white;

          z-index: 1000;
        }

        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);

      }

      .status-stopped {

        background: #f44336;

        .nav-item {
          color: white;

          display: flex;
        }

        flex-direction: column;

        align-items: center;

        .card {

          gap: 4px;
          background: var(--tg-theme-secondary-bg-color, #f0f0f0);

          padding: 8px 16px;
          border-radius: 12px;

          cursor: pointer;
          padding: 16px;

          border-radius: 8px;
          margin-bottom: 16px;

          transition: all 0.3s;
        }

        color: var(--text-secondary);

        text-decoration: none;

        .card h2 {}

        font-size: 18px;

        margin-bottom: 12px;

        .nav-item:hover,
        color: var(--tg-theme-text-color, #000000);

        .nav-item.active {}

        color: var(--primary-color);

        background: var(--bg-primary);

        .info-row {}

        display: flex;

        justify-content: space-between;

        .nav-icon {
          padding: 8px 0;

          font-size: 20px;
          border-bottom: 1px solid var(--tg-theme-hint-color, #ccc);

        }
      }



      .nav-label {
        .info-row:last-child {

          font-size: 11px;
          border-bottom: none;

          font-weight: 500;
        }

      }

      .info-label {

        /* –ö–æ–Ω—Ç–µ–Ω—Ç */
        color: var(--tg-theme-hint-color, #999);

        .content {
          font-size: 14px;

          padding: 80px 16px 16px;
        }

        max-width: 600px;

        margin: 0 auto;

        .info-value {}

        font-weight: 600;

        font-size: 14px;

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
      }

      .card {

        background: var(--bg-secondary);

        .positive {

          border-radius: 16px;
          color: #4CAF50;

          padding: 20px;
        }

        margin-bottom: 16px;

        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);

        .negative {

          transition: transform 0.2s;
          color: #f44336;

        }
      }



      .card:hover {
        .controls {

          transform: translateY(-2px);
          position: fixed;

          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
          bottom: 0;

        }

        left: 0;

        right: 0;

        .card-header {
          background: var(--tg-theme-bg-color, #ffffff);

          display: flex;
          padding: 16px;

          align-items: center;
          border-top: 1px solid var(--tg-theme-hint-color, #ccc);

          justify-content: space-between;
          display: flex;

          margin-bottom: 16px;
          gap: 12px;

        }
      }



      .card-title {
        .btn {

          font-size: 18px;
          flex: 1;

          font-weight: 600;
          padding: 14px;

          display: flex;
          border: none;

          align-items: center;
          border-radius: 8px;

          gap: 8px;
          font-size: 16px;

        }

        font-weight: 600;

        cursor: pointer;

        .card-icon {
          transition: opacity 0.2s;

          font-size: 24px;
        }

      }

      .btn:active {

        /* –°—Ç–∞—Ç—É—Å –±–µ–π–¥–∂–∏ */
        opacity: 0.7;

        .status-badge {}

        display: inline-flex;

        align-items: center;

        .btn-start {

          gap: 6px;
          background: #4CAF50;

          padding: 6px 12px;
          color: white;

          border-radius: 20px;
        }

        font-size: 13px;

        font-weight: 600;

        .btn-stop {

          text-transform: uppercase;
          background: #f44336;

          letter-spacing: 0.5px;
          color: white;

        }
      }



      .badge-success {
        .btn-refresh {

          background: var(--success-color);
          background: var(--tg-theme-button-color, #3390ec);

          color: white;
          color: var(--tg-theme-button-text-color, #ffffff);

        }
      }



      .badge-danger {
        .loader {

          background: var(--danger-color);
          text-align: center;

          color: white;
          padding: 40px;

        }

        color: var(--tg-theme-hint-color, #999);

      }

      .badge-warning {

        background: var(--warning-color);

        .error {

          color: white;
          background: #ffebee;

        }

        color: #c62828;

        padding: 12px;

        .badge-info {
          border-radius: 8px;

          background: var(--primary-color);
          margin-bottom: 16px;

          color: white;
          font-size: 14px;

        }
      }



      /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ */
      .metrics-grid {

        .info-row {
          display: grid;

          display: flex;
          grid-template-columns: 1fr 1fr;

          justify-content: space-between;
          gap: 12px;

          padding: 12px 0;
        }

        border-bottom: 1px solid var(--border-color);

      }

      .metric-card {

        background: var(--tg-theme-bg-color, #ffffff);

        .info-row:last-child {
          padding: 12px;

          border-bottom: none;
          border-radius: 8px;

        }

        text-align: center;

      }

      .info-label {

        color: var(--text-secondary);

        .metric-value {

          font-size: 14px;
          font-size: 24px;

        }

        font-weight: 700;

        margin-bottom: 4px;

        .info-value {}

        font-weight: 600;

        font-size: 14px;

        .metric-label {

          color: var(--text-primary);
          font-size: 12px;

        }

        color: var(--tg-theme-hint-color, #999);

      }

      .positive {

        color: var(--success-color);

        .last-update {}

        text-align: center;

        color: var(--tg-theme-hint-color, #999);

        .negative {
          font-size: 12px;

          color: var(--danger-color);
          margin-top: 16px;

        }
      }
    </style>

    /* –ö–Ω–æ–ø–∫–∏ */
  </head>

  .btn {

  width: 100%;

<body>

  padding: 14px; <div class="header">

    border: none; <h1>ü§ñ Trading Bot</h1>

    border-radius: 12px; <div id="statusBadge" class="status-badge">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

    font-size: 15px; </div>

  font-weight: 600;

  cursor: pointer; <div id="errorContainer"></div>

  transition: all 0.3s; <div id="content" class="loader">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>

  display: flex;

  align-items: center; <div class="controls">

    justify-content: center; <button id="btnStart" class="btn btn-start" onclick="startBot()">‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å</button>

    gap: 8px; <button id="btnStop" class="btn btn-stop" onclick="stopBot()">‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>

    margin-top: 12px; <button id="btnRefresh" class="btn btn-refresh" onclick="loadData()">üîÑ</button>

    } </div>



  .btn-primary {
  <script>

    background: var(--primary - color);    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App

    color: white; const tg = window.Telegram.WebApp;

    }    tg.ready();

    tg.expand();

    .btn - success {

      background: var(--success - color);    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É Telegram

      color: white; document.body.style.setProperty('--tg-theme-bg-color', tg.themeParams.bg_color || '#ffffff');

    } document.body.style.setProperty('--tg-theme-text-color', tg.themeParams.text_color || '#000000');

    document.body.style.setProperty('--tg-theme-hint-color', tg.themeParams.hint_color || '#999999');

    .btn - danger {
      document.body.style.setProperty('--tg-theme-button-color', tg.themeParams.button_color || '#3390ec');

      background: var(--danger - color); document.body.style.setProperty('--tg-theme-button-text-color', tg.themeParams.button_text_color || '#ffffff');

      color: white; document.body.style.setProperty('--tg-theme-secondary-bg-color', tg.themeParams.secondary_bg_color || '#f0f0f0');

    }

    // API –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å ‚Äî –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ —Ç–æ–º –∂–µ —Ö–æ—Å—Ç–µ)

    .btn:hover {
      const API_URL = '/api';

      opacity: 0.9; const initData = tg.initData;

      transform: scale(1.02);

    } let currentData = null;



    .btn:active {    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö

      transform: scale(0.98); async function loadData() {

      } try {

        showError('');

    .btn - group {

          display: flex;        // –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç—É—Å –±–æ—Ç–∞

          gap: 8px; const statusResponse = await fetch(`${API_URL}/status?init_data=${encodeURIComponent(initData)}`);

        } if (!statusResponse.ok) {

          throw new Error(`HTTP ${statusResponse.status}: ${statusResponse.statusText}`);

    .btn - group.btn { }

          flex: 1; const status = await statusResponse.json();

        }

        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ä—ã–Ω–∫–∞

    /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ */        const marketResponse = await fetch(`${API_URL}/market?init_data=${encodeURIComponent(initData)}`);

    .toggle - group {
          const market = await marketResponse.ok ? await marketResponse.json() : null;

          display: flex;

          flex - direction: column; currentData = { status, market };

          gap: 12px; renderData();

        }
      } catch (error) {

        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);

    .toggle - item {
          showError(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}`);

          display: flex;
        }

        justify - content: space - between;
      }

      align - items: center;

      padding: 12px;    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

      background: var(--bg - primary); function renderData() {

        border - radius: 12px; if (!currentData) return;

      }

      const { status, market } = currentData;

    .toggle - label {

        font - size: 15px;      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å

        font - weight: 500; const statusBadge = document.getElementById('statusBadge');

      } if (status.is_running) {

        statusBadge.textContent = 'üü¢ –†–∞–±–æ—Ç–∞–µ—Ç';

    .toggle -switch {
          statusBadge.className = 'status-badge status-running';

          position: relative;
        } else {

          width: 50px; statusBadge.textContent = 'üî¥ –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω';

          height: 28px; statusBadge.className = 'status-badge status-stopped';

        }
      }



    .toggle -switch input {      // –§–æ—Ä–º–∏—Ä—É–µ–º HTML –∫–æ–Ω—Ç–µ–Ω—Ç–∞

      opacity: 0; let html = '';

      width: 0;

      height: 0;      // –ë–∞–ª–∞–Ω—Å

    } if (status.balance) {

      html += `

    .toggle-slider {                    <div class="card">

      position: absolute;                        <h2>üí∞ –ë–∞–ª–∞–Ω—Å</h2>

      cursor: pointer;                        <div class="info-row">

      top: 0;                            <span class="info-label">USDT</span>

      left: 0;                            <span class="info-value">${formatNumber(status.balance.usdt || 0)} USDT</span>

      right: 0;                        </div>

      bottom: 0;                        <div class="info-row">

      background-color: #ccc;                            <span class="info-label">–û–±—â–∏–π (USDT)</span>

      transition: 0.4s;                            <span class="info-value">${formatNumber(status.balance.total_usdt || 0)} USDT</span>

      border-radius: 28px;                        </div>

    }                    </div>

                `;

    .toggle - slider:before { }

      position: absolute;

      content: "";      // –ü–æ–∑–∏—Ü–∏—è

      height: 20px; if (status.position) {

        width: 20px; html += `

      left: 4px;                    <div class="card">

      bottom: 4px;                        <h2>üìä –¢–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è</h2>

      background-color: white;                        <div class="info-row">

      transition: 0.4s;                            <span class="info-label">–°—Ç–∞—Ç—É—Å</span>

      border-radius: 50%;                            <span class="info-value">${status.position.position || '–ù–µ—Ç –ø–æ–∑–∏—Ü–∏–∏'}</span>

    }                        </div>

                        ${status.position.entry_price ? `

    input:checked+.toggle-slider {                        <div class="info-row">

      background-color: var(--success-color);                            <span class="info-label">–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞</span>

    }                            <span class="info-value">${formatNumber(status.position.entry_price)} USDT</span>

                        </div>

    input:checked+.toggle-slider:before {                        ` : ''}

      transform: translateX(22px);                        ${status.position.amount ? `

    }                        <div class="info-row">

                            <span class="info-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</span>

    /* –ò–Ω–ø—É—Ç—ã */                            <span class="info-value">${formatNumber(status.position.amount)}</span>

    .input-group {                        </div>

      margin-top: 12px;                        ` : ''}

    }                    </div>

                `;

    .input - label { }

        display: block;

        font - size: 14px;      // –†—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

        font - weight: 500; if (market) {

          margin - bottom: 8px; const priceChange = market.price_change_24h || 0;

          color: var(--text - secondary); const priceChangeClass = priceChange >= 0 ? 'positive' : 'negative';

        }

        html += `

    .input-field {                    <div class="card">

      width: 100%;                        <h2>üíπ –†—ã–Ω–æ–∫ (${market.symbol})</h2>

      padding: 12px;                        <div class="info-row">

      border: 2px solid var(--border-color);                            <span class="info-label">–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞</span>

      border-radius: 12px;                            <span class="info-value">${formatNumber(market.current_price)} USDT</span>

      font-size: 15px;                        </div>

      background: var(--bg-primary);                        <div class="info-row">

      color: var(--text-primary);                            <span class="info-label">–ò–∑–º–µ–Ω–µ–Ω–∏–µ 24—á</span>

      transition: border-color 0.3s;                            <span class="info-value ${priceChangeClass}">${priceChange > 0 ? '+' : ''}${formatNumber(priceChange)}%</span>

    }                        </div>

                        <div class="info-row">

    .input-field:focus {                            <span class="info-label">–ú–∞–∫—Å–∏–º—É–º 24—á</span>

      outline: none;                            <span class="info-value">${formatNumber(market.high_24h)} USDT</span>

      border-color: var(--primary-color);                        </div>

    }                        <div class="info-row">

                            <span class="info-label">–ú–∏–Ω–∏–º—É–º 24—á</span>

    /* –°–µ–ª–µ–∫—Ç—ã */                            <span class="info-value">${formatNumber(market.low_24h)} USDT</span>

    .select-group {                        </div>

      margin-top: 12px;                    </div>

    }                `;

      }

    .select - field {

        width: 100 %;      // –ù–∞—Å—Ç—Ä–æ–π–∫–∏

        padding: 12px; if (status.settings) {

          border: 2px solid var(--border - color); html += `

      border-radius: 12px;                    <div class="card">

      font-size: 15px;                        <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>

      background: var(--bg-primary);                        <div class="info-row">

      color: var(--text-primary);                            <span class="info-label">–¢–æ—Ä–≥–æ–≤–∞—è –ø–∞—Ä–∞</span>

      cursor: pointer;                            <span class="info-value">${status.settings.active_pair}</span>

    }                        </div>

                        <div class="info-row">

    /* –°–∫—Ä—ã–≤–∞–µ–º —Ä–∞–∑–¥–µ–ª—ã */                            <span class="info-label">–°—Ç—Ä–∞—Ç–µ–≥–∏—è</span>

    .section {                            <span class="info-value">${status.settings.active_strategy}</span>

      display: none;                        </div>

    }                        <div class="info-row">

                            <span class="info-label">–†–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É</span>

    .section.active {                            <span class="info-value">${status.settings.risk_per_trade}%</span>

      display: block;                        </div>

    }                    </div>

                `;

          /* –ó–∞–≥—Ä—É–∑–∫–∞ */
}

    .loader {

          border: 3px solid var(--border - color);      // –ú–µ—Ç—Ä–∏–∫–∏

          border - top: 3px solid var(--primary - color); if (status.metrics) {

            border - radius: 50 %; const winRate = status.metrics.total_trades > 0

            width: 30px;          ?(status.metrics.winning_trades / status.metrics.total_trades * 100).toFixed(1)

            height: 30px;          : 0;

            animation: spin 1s linear infinite;

            margin: 20px auto; html += `

    }                    <div class="card">

                        <h2>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>

    @keyframes spin {                        <div class="metrics-grid">

      0% {                            <div class="metric-card">

        transform: rotate(0deg);                                <div class="metric-value">${status.metrics.total_trades}</div>

      }                                <div class="metric-label">–í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫</div>

                            </div>

      100% {                            <div class="metric-card">

        transform: rotate(360deg);                                <div class="metric-value ${status.metrics.total_profit >= 0 ? 'positive' : 'negative'}">

      }                                    ${status.metrics.total_profit >= 0 ? '+' : ''}${formatNumber(status.metrics.total_profit)}

    }                                </div>

                                <div class="metric-label">–ü—Ä–∏–±—ã–ª—å USDT</div>

    /* –ü–æ–∑–∏—Ü–∏–∏ */                            </div>

    .position-card {                            <div class="metric-card">

      background: var(--bg-primary);                                <div class="metric-value positive">${status.metrics.winning_trades}</div>

      border-radius: 12px;                                <div class="metric-label">–ü—Ä–∏–±—ã–ª—å–Ω—ã—Ö</div>

      padding: 16px;                            </div>

      margin-top: 12px;                            <div class="metric-card">

      border: 2px solid var(--border-color);                                <div class="metric-value negative">${status.metrics.losing_trades}</div>

    }                                <div class="metric-label">–£–±—ã—Ç–æ—á–Ω—ã—Ö</div>

                            </div>

    .position-header {                        </div>

      display: flex;                        <div class="info-row" style="margin-top: 12px;">

      justify-content: space-between;                            <span class="info-label">–í–∏–Ω—Ä–µ–π—Ç</span>

      align-items: center;                            <span class="info-value">${winRate}%</span>

      margin-bottom: 12px;                        </div>

    }                    </div>

                `;

    .position - pair { }

            font - size: 16px;

            font - weight: 600;      // –í—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

          } html += `<div class="last-update">–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${new Date().toLocaleTimeString('ru-RU')}</div>`;



    .position - pnl {
            document.getElementById('content').innerHTML = html;

            font - size: 16px;
          }

          font - weight: 600;

        }    // –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

        async function startBot() {

    /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ grid */      try {

    .stats - grid {
              const response = await fetch(`${API_URL}/bot/start`, {

                display: grid; method: 'POST',

                grid- template - columns: repeat(2, 1fr); headers: {

                  gap: 12px; 'Content-Type': 'application/json',

                    margin - top: 12px;
                },

            } body: JSON.stringify({ init_data: initData })

          });

    .stat - item {

            background: var(--bg - primary); const result = await response.json();

            padding: 16px;

            border - radius: 12px;        // –ò—Å–ø–æ–ª—å–∑—É–µ–º showPopup –≤–º–µ—Å—Ç–æ showAlert –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã

            text - align: center; tg.showPopup({

            }          title: '–ë–æ—Ç',

              message: result.message || '–ì–æ—Ç–æ–≤–æ',

    .stat - value {
              buttons: [{ type: 'ok' }]

      font- size: 20px;
          });

          font - weight: 700;

          margin - bottom: 4px; loadData();

        }
      } catch (error) {

        tg.showPopup({

    .stat - label {
          title: '–û—à–∏–±–∫–∞',

          font- size: 12px; message: error.message || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞',

            color: var(--text - secondary); buttons: [{ type: 'ok' }]

        text - transform: uppercase;
      });

      letter - spacing: 0.5px;
    }

    }    }



    /* –¢–∞–±–ª–∏—Ü–∞ —Å–¥–µ–ª–æ–∫ */    // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞

    .trades - table {
      async function stopBot() {

        margin - top: 12px; try {

        }        const response = await fetch(`${API_URL}/bot/stop`, {

          method: 'POST',

    .trade - row {
          headers: {

            display: flex; 'Content-Type': 'application/json',

            justify- content: space- between;
      },

      padding: 12px; body: JSON.stringify({ init_data: initData })

      background: var(--bg - primary);
    });

    border - radius: 8px;

    margin - bottom: 8px; const result = await response.json();

    }

        // –ò—Å–ø–æ–ª—å–∑—É–µ–º showPopup –≤–º–µ—Å—Ç–æ showAlert –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã

    .trade - info {
      tg.showPopup({

        flex: 1; title: '–ë–æ—Ç',

      }          message: result.message || '–ì–æ—Ç–æ–≤–æ',

        buttons: [{ type: 'ok' }]

          .trade - pair {});

      font - weight: 600;

      margin - bottom: 4px; loadData();

    }      } catch (error) {

      tg.showPopup({

    .trade - time {
        title: '–û—à–∏–±–∫–∞',

        font- size: 12px; message: error.message || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞',

          color: var(--text - secondary); buttons: [{ type: 'ok' }]

    }        });

      }

    .trade - pnl { }

    text - align: right;

    font - weight: 600;    // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É

    }    function showError(message) {

      const container = document.getElementById('errorContainer');

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */      if (message) {

        @media(max - width: 400px) {
          container.innerHTML = `<div class="error">${message}</div>`;

      .nav - label { } else {

            display: none; container.innerHTML = '';

          }
        }

      }

      .nav - item {

        padding: 8px;    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–µ–ª

      } function formatNumber(num) {

      } if (num === null || num === undefined) return '0';

      return parseFloat(num).toLocaleString('ru-RU', {

    /* –ê–Ω–∏–º–∞—Ü–∏–∏ */        minimumFractionDigits: 2,

    @keyframes fadeIn {
        maximumFractionDigits: 8

      from {});

      opacity: 0;
    }

    transform: translateY(10px);

      }    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

    loadData();

      to {

      opacity: 1;    // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥

      transform: translateY(0); setInterval(loadData, 5000);

    }  </script>

  }
</body>



.card {

</html>
animation: fadeIn 0.3s ease-out;
}

/* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
.notification {
position: fixed;
top: 80px;
left: 50%;
transform: translateX(-50%);
background: var(--bg-secondary);
padding: 12px 24px;
border-radius: 12px;
box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
z-index: 2000;
display: none;
animation: slideDown 0.3s ease-out;
}

.notification.show {
display: block;
}

@keyframes slideDown {
from {
transform: translateX(-50%) translateY(-20px);
opacity: 0;
}

to {
transform: translateX(-50%) translateY(0);
opacity: 1;
}
}
</style>
</head>

<body>
  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
  <nav class="nav-bar">
    <div class="nav-item active" data-section="dashboard">
      <div class="nav-icon">üìä</div>
      <div class="nav-label">–î–∞—à–±–æ—Ä–¥</div>
    </div>
    <div class="nav-item" data-section="positions">
      <div class="nav-icon">üìà</div>
      <div class="nav-label">–ü–æ–∑–∏—Ü–∏–∏</div>
    </div>
    <div class="nav-item" data-section="settings">
      <div class="nav-icon">‚öôÔ∏è</div>
      <div class="nav-label">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
    </div>
    <div class="nav-item" data-section="analytics">
      <div class="nav-icon">üìâ</div>
      <div class="nav-label">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</div>
    </div>
  </nav>

  <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
  <div id="notification" class="notification"></div>

  <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
  <div class="content">
    <!-- –î–∞—à–±–æ—Ä–¥ -->
    <div id="dashboard" class="section active">
      <!-- –°—Ç–∞—Ç—É—Å –±–æ—Ç–∞ -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            <span class="card-icon">ü§ñ</span>
            Trading Bot
          </div>
          <span id="botStatus" class="status-badge badge-success">
            <span>‚óè</span> –†–∞–±–æ—Ç–∞–µ—Ç
          </span>
        </div>
      </div>

      <!-- –ë–∞–ª–∞–Ω—Å -->
      <div class="card">
        <div class="card-title">
          <span class="card-icon">üí∞</span>
          –ë–∞–ª–∞–Ω—Å
        </div>
        <div class="info-row">
          <span class="info-label">USDT</span>
          <span id="balanceUsdt" class="info-value">0.00 USDT</span>
        </div>
        <div class="info-row">
          <span class="info-label">–û–±—â–∏–π (USDT)</span>
          <span id="balanceTotal" class="info-value">0.00 USDT</span>
        </div>
      </div>

      <!-- –¢–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è -->
      <div class="card">
        <div class="card-title">
          <span class="card-icon">üìä</span>
          –¢–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è
        </div>
        <div id="currentPosition">
          <div class="info-row">
            <span class="info-label">–°—Ç–∞—Ç—É—Å</span>
            <span id="posStatus" class="info-value">-</span>
          </div>
          <div class="info-row">
            <span class="info-label">–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞</span>
            <span id="posEntry" class="info-value">-</span>
          </div>
          <div class="info-row">
            <span class="info-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</span>
            <span id="posAmount" class="info-value">-</span>
          </div>
          <div class="info-row">
            <span class="info-label">P&L</span>
            <span id="posPnl" class="info-value">-</span>
          </div>
        </div>
      </div>

      <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞ (–∫—Ä–∞—Ç–∫–∞—è –≤–µ—Ä—Å–∏—è) -->
      <div class="card">
        <div class="card-title">
          <span class="card-icon">‚öôÔ∏è</span>
          –ù–∞—Å—Ç—Ä–æ–π–∫–∏
        </div>
        <div class="info-row">
          <span class="info-label">–¢–æ—Ä–≥–æ–≤–∞—è –ø–∞—Ä–∞</span>
          <span id="tradingPair" class="info-value">BTC/USDT</span>
        </div>
        <div class="info-row">
          <span class="info-label">–°—Ç—Ä–∞—Ç–µ–≥–∏—è</span>
          <span id="strategy" class="info-value">ema_ml</span>
        </div>
        <div class="info-row">
          <span class="info-label">–†–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É</span>
          <span id="riskPercent" class="info-value">1%</span>
        </div>
      </div>

      <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
      <div class="card">
        <div class="card-title">
          <span class="card-icon">‚ö°</span>
          –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
        </div>
        <div class="btn-group">
          <button id="btnStartBot" class="btn btn-success">
            ‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å
          </button>
          <button id="btnStopBot" class="btn btn-danger">
            ‚è∏Ô∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
          </button>
        </div>
        <button id="btnRefresh" class="btn btn-primary">
          üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
        </button>
      </div>
    </div>

    <!-- –ü–æ–∑–∏—Ü–∏–∏ -->
    <div id="positions" class="section">
      <div class="card">
        <div class="card-title">
          <span class="card-icon">üìà</span>
          –û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏
        </div>
        <div id="positionsList">
          <p style="text-align: center; color: var(--text-secondary); padding: 20px;">
            –ù–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π
          </p>
        </div>
      </div>

      <!-- –ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫ -->
      <div class="card">
        <div class="card-title">
          <span class="card-icon">üìú</span>
          –ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫
        </div>
        <div id="tradeHistory" class="trades-table">
          <p style="text-align: center; color: var(--text-secondary); padding: 20px;">
            –ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞
          </p>
        </div>
      </div>
    </div>

    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
    <div id="settings" class="section">
      <!-- –¢–æ—Ä–≥–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
      <div class="card">
        <div class="card-title">
          <span class="card-icon">üí±</span>
          –¢–æ—Ä–≥–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        </div>

        <div class="input-group">
          <label class="input-label">–¢–æ—Ä–≥–æ–≤–∞—è –ø–∞—Ä–∞</label>
          <select id="selectPair" class="select-field">
            <option value="BTC/USDT">BTC/USDT</option>
            <option value="ETH/USDT">ETH/USDT</option>
            <option value="SOL/USDT">SOL/USDT</option>
          </select>
        </div>

        <div class="input-group">
          <label class="input-label">–°—Ç—Ä–∞—Ç–µ–≥–∏—è</label>
          <select id="selectStrategy" class="select-field">
            <option value="ema_ml">EMA + Machine Learning</option>
            <option value="bollinger">Bollinger Bands</option>
            <option value="macd_rsi">MACD + RSI</option>
            <option value="price_action">Price Action</option>
          </select>
        </div>

        <div class="input-group">
          <label class="input-label">–†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ (% –æ—Ç –±–∞–ª–∞–Ω—Å–∞)</label>
          <input id="inputTradeAmount" type="number" class="input-field" value="1" min="0.1" max="100" step="0.1">
        </div>

        <button id="btnSaveTradingSettings" class="btn btn-primary">
          üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        </button>
      </div>

      <!-- EMA –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
      <div class="card">
        <div class="card-title">
          <span class="card-icon">üìà</span>
          –ù–∞—Å—Ç—Ä–æ–π–∫–∏ EMA
        </div>

        <div class="input-group">
          <label class="input-label">–ë—ã—Å—Ç—Ä–∞—è EMA (–ø–µ—Ä–∏–æ–¥)</label>
          <input id="inputEmaFast" type="number" class="input-field" value="9" min="1" max="100">
        </div>

        <div class="input-group">
          <label class="input-label">–ú–µ–¥–ª–µ–Ω–Ω–∞—è EMA (–ø–µ—Ä–∏–æ–¥)</label>
          <input id="inputEmaSlow" type="number" class="input-field" value="21" min="1" max="200">
        </div>

        <div class="input-group">
          <label class="input-label">–ü–æ—Ä–æ–≥ EMA (%)</label>
          <input id="inputEmaThreshold" type="number" class="input-field" value="0.25" min="0" max="10" step="0.01">
        </div>

        <button id="btnSaveEmaSettings" class="btn btn-primary">
          üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å EMA
        </button>
      </div>

      <!-- –†–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç -->
      <div class="card">
        <div class="card-title">
          <span class="card-icon">üõ°Ô∏è</span>
          –†–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç
        </div>

        <div class="input-group">
          <label class="input-label">Take Profit (%)</label>
          <input id="inputTakeProfit" type="number" class="input-field" value="2" min="0.1" max="100" step="0.1">
        </div>

        <div class="input-group">
          <label class="input-label">Stop Loss (%)</label>
          <input id="inputStopLoss" type="number" class="input-field" value="1.5" min="0.1" max="100" step="0.1">
        </div>

        <div class="input-group">
          <label class="input-label">–ú–∞–∫—Å. –ø–æ–∑–∏—Ü–∏—è (USDT)</label>
          <input id="inputMaxPosition" type="number" class="input-field" value="100" min="1" step="1">
        </div>

        <div class="input-group">
          <label class="input-label">–ú–∞–∫—Å. —É–±—ã—Ç–æ–∫/–¥–µ–Ω—å (USDT)</label>
          <input id="inputMaxDailyLoss" type="number" class="input-field" value="10" min="0" step="0.1">
        </div>

        <button id="btnSaveRiskSettings" class="btn btn-primary">
          üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç
        </button>
      </div>

      <!-- ML –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
      <div class="card">
        <div class="card-title">
          <span class="card-icon">ü§ñ</span>
          Machine Learning
        </div>

        <div class="toggle-group">
          <div class="toggle-item">
            <span class="toggle-label">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ML</span>
            <label class="toggle-switch">
              <input id="toggleMl" type="checkbox" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <div class="input-group">
          <label class="input-label">–ü–æ—Ä–æ–≥ –ø–æ–∫—É–ø–∫–∏ ML</label>
          <input id="inputMlBuyThreshold" type="number" class="input-field" value="0.7" min="0" max="1" step="0.01">
        </div>

        <div class="input-group">
          <label class="input-label">–ü–æ—Ä–æ–≥ –ø—Ä–æ–¥–∞–∂–∏ ML</label>
          <input id="inputMlSellThreshold" type="number" class="input-field" value="0.3" min="0" max="1" step="0.01">
        </div>

        <button id="btnRetrainModel" class="btn btn-warning">
          üîÑ –ü–µ—Ä–µ–æ–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å
        </button>

        <button id="btnSaveMlSettings" class="btn btn-primary">
          üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ML
        </button>
      </div>

      <!-- –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
      <div class="card">
        <div class="card-title">
          <span class="card-icon">üîß</span>
          –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        </div>

        <div class="toggle-group">
          <div class="toggle-item">
            <span class="toggle-label">–¢–æ—Ä–≥–æ–≤–ª—è –≤–∫–ª—é—á–µ–Ω–∞</span>
            <label class="toggle-switch">
              <input id="toggleTrading" type="checkbox" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>

          <div class="toggle-item">
            <span class="toggle-label">–î–µ–º–æ —Ä–µ–∂–∏–º</span>
            <label class="toggle-switch">
              <input id="toggleDemo" type="checkbox">
              <span class="toggle-slider"></span>
            </label>
          </div>

          <div class="toggle-item">
            <span class="toggle-label">–û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω—ã</span>
            <label class="toggle-switch">
              <input id="togglePriceUpdates" type="checkbox" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>

          <div class="toggle-item">
            <span class="toggle-label">Trailing Stop</span>
            <label class="toggle-switch">
              <input id="toggleTrailingStop" type="checkbox">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <button id="btnSaveGeneralSettings" class="btn btn-primary">
          üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        </button>
      </div>
    </div>

    <!-- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ -->
    <div id="analytics" class="section">
      <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
      <div class="card">
        <div class="card-title">
          <span class="card-icon">üìä</span>
          –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏
        </div>

        <div class="stats-grid">
          <div class="stat-item">
            <div id="totalTrades" class="stat-value">0</div>
            <div class="stat-label">–í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫</div>
          </div>
          <div class="stat-item">
            <div id="winRate" class="stat-value">0%</div>
            <div class="stat-label">Win Rate</div>
          </div>
          <div class="stat-item">
            <div id="totalProfit" class="stat-value positive">+0 USDT</div>
            <div class="stat-label">–ü—Ä–∏–±—ã–ª—å</div>
          </div>
          <div class="stat-item">
            <div id="avgProfit" class="stat-value">0 USDT</div>
            <div class="stat-label">–°—Ä–µ–¥–Ω—è—è —Å–¥–µ–ª–∫–∞</div>
          </div>
        </div>
      </div>

      <!-- –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
      <div class="card">
        <div class="card-title">
          <span class="card-icon">üìà</span>
          –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        </div>
        <div class="info-row">
          <span class="info-label">–ü—Ä–∏–±—ã–ª—å–Ω—ã—Ö —Å–¥–µ–ª–æ–∫</span>
          <span id="winTrades" class="info-value positive">0</span>
        </div>
        <div class="info-row">
          <span class="info-label">–£–±—ã—Ç–æ—á–Ω—ã—Ö —Å–¥–µ–ª–æ–∫</span>
          <span id="lossTrades" class="info-value negative">0</span>
        </div>
        <div class="info-row">
          <span class="info-label">–°—Ä–µ–¥–Ω—è—è –ø—Ä–∏–±—ã–ª—å</span>
          <span id="avgWin" class="info-value positive">0 USDT</span>
        </div>
        <div class="info-row">
          <span class="info-label">–°—Ä–µ–¥–Ω–∏–π —É–±—ã—Ç–æ–∫</span>
          <span id="avgLoss" class="info-value negative">0 USDT</span>
        </div>
        <div class="info-row">
          <span class="info-label">–ú–∞–∫—Å. –ø—Ä–∏–±—ã–ª—å</span>
          <span id="maxWin" class="info-value positive">0 USDT</span>
        </div>
        <div class="info-row">
          <span class="info-label">–ú–∞–∫—Å. —É–±—ã—Ç–æ–∫</span>
          <span id="maxLoss" class="info-value negative">0 USDT</span>
        </div>
      </div>

      <!-- –î–µ–π—Å—Ç–≤–∏—è -->
      <div class="card">
        <button id="btnResetStats" class="btn btn-danger">
          üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        </button>
      </div>
    </div>
  </div>

  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
    const tg = window.Telegram.WebApp;
    tg.expand();
    tg.ready();

    // –ü–æ–ª—É—á–∞–µ–º initData –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    const initData = tg.initData || '';

    // API –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    const API_BASE = '';  // –ü—É—Å—Ç–æ–π, —Ç.–∫. –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏

    // –£—Ç–∏–ª–∏—Ç—ã
    function showNotification(message, duration = 3000) {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.classList.add('show');
      setTimeout(() => {
        notification.classList.remove('show');
      }, duration);
    }

    function formatNumber(num, decimals = 2) {
      return parseFloat(num).toFixed(decimals);
    }

    function formatPercent(num) {
      return `${formatNumber(num, 2)}%`;
    }

    // API –∑–∞–ø—Ä–æ—Å—ã
    async function apiRequest(endpoint, options = {}) {
      try {
        const url = `${API_BASE}/api${endpoint}${endpoint.includes('?') ? '&' : '?'}init_data=${encodeURIComponent(initData)}`;
        const response = await fetch(url, {
          ...options,
          headers: {
            'Content-Type': 'application/json',
            ...options.headers
          }
        });

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }

        return await response.json();
      } catch (error) {
        console.error('API Error:', error);
        showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
        throw error;
      }
    }

    // –ù–∞–≤–∏–≥–∞—Ü–∏—è
    document.querySelectorAll('.nav-item').forEach(item => {
      item.addEventListener('click', () => {
        const section = item.dataset.section;

        // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        item.classList.add('active');

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é —Å–µ–∫—Ü–∏—é
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(section).classList.add('active');

        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ
        if (section === 'dashboard') loadDashboard();
        if (section === 'positions') loadPositions();
        if (section === 'settings') loadSettings();
        if (section === 'analytics') loadAnalytics();
      });
    });

    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞—à–±–æ—Ä–¥–∞
    async function loadDashboard() {
      try {
        const status = await apiRequest('/status');

        // –°—Ç–∞—Ç—É—Å –±–æ—Ç–∞
        const botStatus = document.getElementById('botStatus');
        if (status.trading_enabled) {
          botStatus.className = 'status-badge badge-success';
          botStatus.innerHTML = '<span>‚óè</span> –†–∞–±–æ—Ç–∞–µ—Ç';
        } else {
          botStatus.className = 'status-badge badge-danger';
          botStatus.innerHTML = '<span>‚óè</span> –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω';
        }

        // –ë–∞–ª–∞–Ω—Å
        document.getElementById('balanceUsdt').textContent = `${formatNumber(status.balance?.USDT || 0, 4)} USDT`;
        document.getElementById('balanceTotal').textContent = `${formatNumber(status.balance?.total_usdt || 0, 4)} USDT`;

        // –¢–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è
        const position = status.current_position;
        if (position && position.status !== 'closed') {
          document.getElementById('posStatus').textContent = position.status || '-';
          document.getElementById('posEntry').textContent = `${formatNumber(position.entry_price, 6)} USDT`;
          document.getElementById('posAmount').textContent = formatNumber(position.amount, 8);

          const pnl = position.pnl || 0;
          const pnlElem = document.getElementById('posPnl');
          pnlElem.textContent = `${pnl > 0 ? '+' : ''}${formatNumber(pnl, 2)} USDT`;
          pnlElem.className = `info-value ${pnl >= 0 ? 'positive' : 'negative'}`;
        } else {
          document.getElementById('posStatus').textContent = '–ù–µ—Ç –ø–æ–∑–∏—Ü–∏–∏';
          document.getElementById('posEntry').textContent = '-';
          document.getElementById('posAmount').textContent = '-';
          document.getElementById('posPnl').textContent = '-';
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
        document.getElementById('tradingPair').textContent = status.settings?.active_pair || 'BTC/USDT';
        document.getElementById('strategy').textContent = status.settings?.active_strategy || 'ema_ml';
        document.getElementById('riskPercent').textContent = formatPercent(status.settings?.trade_amount_percent * 100 || 1);

      } catch (error) {
        console.error('Error loading dashboard:', error);
      }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–∑–∏—Ü–∏–π
    async function loadPositions() {
      try {
        const positions = await apiRequest('/positions');
        const positionsList = document.getElementById('positionsList');

        if (positions && positions.length > 0) {
          positionsList.innerHTML = positions.map(pos => `
            <div class="position-card">
              <div class="position-header">
                <span class="position-pair">${pos.pair}</span>
                <span class="position-pnl ${pos.pnl >= 0 ? 'positive' : 'negative'}">
                  ${pos.pnl > 0 ? '+' : ''}${formatNumber(pos.pnl, 2)} USDT
                </span>
              </div>
              <div class="info-row">
                <span class="info-label">–°—Ç–∞—Ç—É—Å</span>
                <span class="info-value">${pos.status}</span>
              </div>
              <div class="info-row">
                <span class="info-label">–í—Ö–æ–¥</span>
                <span class="info-value">${formatNumber(pos.entry_price, 6)}</span>
              </div>
              <div class="info-row">
                <span class="info-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</span>
                <span class="info-value">${formatNumber(pos.amount, 8)}</span>
              </div>
              <button class="btn btn-danger" onclick="closePosition('${pos.id}')">
                –ó–∞–∫—Ä—ã—Ç—å –ø–æ–∑–∏—Ü–∏—é
              </button>
            </div>
          `).join('');
        } else {
          positionsList.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 20px;">–ù–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π</p>';
        }

        // –ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫
        const history = await apiRequest('/trade-history');
        const tradeHistory = document.getElementById('tradeHistory');

        if (history && history.length > 0) {
          tradeHistory.innerHTML = history.slice(0, 10).map(trade => `
            <div class="trade-row">
              <div class="trade-info">
                <div class="trade-pair">${trade.pair}</div>
                <div class="trade-time">${new Date(trade.timestamp).toLocaleString('ru-RU')}</div>
              </div>
              <div class="trade-pnl ${trade.pnl >= 0 ? 'positive' : 'negative'}">
                ${trade.pnl > 0 ? '+' : ''}${formatNumber(trade.pnl, 2)} USDT
              </div>
            </div>
          `).join('');
        } else {
          tradeHistory.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 20px;">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</p>';
        }

      } catch (error) {
        console.error('Error loading positions:', error);
      }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
    async function loadSettings() {
      try {
        const settings = await apiRequest('/settings');

        // –¢–æ—Ä–≥–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        document.getElementById('selectPair').value = settings.active_pair || 'BTC/USDT';
        document.getElementById('selectStrategy').value = settings.active_strategy || 'ema_ml';
        document.getElementById('inputTradeAmount').value = (settings.trade_amount_percent || 0.01) * 100;

        // EMA –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        const emaSettings = settings.strategy_settings?.ema_ml || {};
        document.getElementById('inputEmaFast').value = emaSettings.ema_fast_period || 9;
        document.getElementById('inputEmaSlow').value = emaSettings.ema_slow_period || 21;
        document.getElementById('inputEmaThreshold').value = (emaSettings.ema_threshold || 0.0025) * 100;

        // –†–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç
        document.getElementById('inputTakeProfit').value = emaSettings.take_profit_percent || 2;
        document.getElementById('inputStopLoss').value = emaSettings.stop_loss_percent || 1.5;
        document.getElementById('inputMaxPosition').value = settings.risk_settings?.max_position_size || 100;
        document.getElementById('inputMaxDailyLoss').value = settings.risk_settings?.max_daily_loss || 10;

        // ML –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        const mlEnabled = emaSettings.ml_enabled !== false;
        document.getElementById('toggleMl').checked = mlEnabled;
        document.getElementById('inputMlBuyThreshold').value = emaSettings.ml_buy_threshold || 0.7;
        document.getElementById('inputMlSellThreshold').value = emaSettings.ml_sell_threshold || 0.3;

        // –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        document.getElementById('toggleTrading').checked = settings.trading_enabled !== false;
        document.getElementById('toggleDemo').checked = settings.demo_mode === true;
        document.getElementById('togglePriceUpdates').checked = settings.enable_price_updates !== false;
        document.getElementById('toggleTrailingStop').checked = emaSettings.trailing_stop === true;

      } catch (error) {
        console.error('Error loading settings:', error);
      }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
    async function loadAnalytics() {
      try {
        const analytics = await apiRequest('/analytics');

        document.getElementById('totalTrades').textContent = analytics.total_trades || 0;
        document.getElementById('winRate').textContent = formatPercent(analytics.win_rate || 0);

        const totalProfit = analytics.total_profit || 0;
        const totalProfitElem = document.getElementById('totalProfit');
        totalProfitElem.textContent = `${totalProfit > 0 ? '+' : ''}${formatNumber(totalProfit, 2)} USDT`;
        totalProfitElem.className = `stat-value ${totalProfit >= 0 ? 'positive' : 'negative'}`;

        document.getElementById('avgProfit').textContent = `${formatNumber(analytics.avg_profit || 0, 2)} USDT`;
        document.getElementById('winTrades').textContent = analytics.winning_trades || 0;
        document.getElementById('lossTrades').textContent = analytics.losing_trades || 0;
        document.getElementById('avgWin').textContent = `${formatNumber(analytics.avg_win || 0, 2)} USDT`;
        document.getElementById('avgLoss').textContent = `${formatNumber(analytics.avg_loss || 0, 2)} USDT`;
        document.getElementById('maxWin').textContent = `${formatNumber(analytics.max_win || 0, 2)} USDT`;
        document.getElementById('maxLoss').textContent = `${formatNumber(analytics.max_loss || 0, 2)} USDT`;

      } catch (error) {
        console.error('Error loading analytics:', error);
      }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    document.getElementById('btnStartBot').addEventListener('click', async () => {
      try {
        await apiRequest('/start', { method: 'POST' });
        showNotification('‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω');
        loadDashboard();
      } catch (error) {
        showNotification('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞');
      }
    });

    document.getElementById('btnStopBot').addEventListener('click', async () => {
      try {
        await apiRequest('/stop', { method: 'POST' });
        showNotification('‚è∏Ô∏è –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
        loadDashboard();
      } catch (error) {
        showNotification('‚ùå –û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–æ—Ç–∞');
      }
    });

    document.getElementById('btnRefresh').addEventListener('click', () => {
      loadDashboard();
      showNotification('üîÑ –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
    });

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
    document.getElementById('btnSaveTradingSettings').addEventListener('click', async () => {
      try {
        const settings = {
          active_pair: document.getElementById('selectPair').value,
          active_strategy: document.getElementById('selectStrategy').value,
          trade_amount_percent: parseFloat(document.getElementById('inputTradeAmount').value) / 100
        };
        await apiRequest('/settings', {
          method: 'POST',
          body: JSON.stringify(settings)
        });
        showNotification('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
      } catch (error) {
        showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
      }
    });

    document.getElementById('btnSaveEmaSettings').addEventListener('click', async () => {
      try {
        const settings = {
          strategy: 'ema_ml',
          ema_fast_period: parseInt(document.getElementById('inputEmaFast').value),
          ema_slow_period: parseInt(document.getElementById('inputEmaSlow').value),
          ema_threshold: parseFloat(document.getElementById('inputEmaThreshold').value) / 100
        };
        await apiRequest('/settings/strategy', {
          method: 'POST',
          body: JSON.stringify(settings)
        });
        showNotification('‚úÖ EMA –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
      } catch (error) {
        showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
      }
    });

    document.getElementById('btnSaveRiskSettings').addEventListener('click', async () => {
      try {
        const settings = {
          take_profit_percent: parseFloat(document.getElementById('inputTakeProfit').value),
          stop_loss_percent: parseFloat(document.getElementById('inputStopLoss').value),
          max_position_size: parseFloat(document.getElementById('inputMaxPosition').value),
          max_daily_loss: parseFloat(document.getElementById('inputMaxDailyLoss').value)
        };
        await apiRequest('/settings/risk', {
          method: 'POST',
          body: JSON.stringify(settings)
        });
        showNotification('‚úÖ –†–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
      } catch (error) {
        showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
      }
    });

    document.getElementById('btnSaveMlSettings').addEventListener('click', async () => {
      try {
        const settings = {
          ml_enabled: document.getElementById('toggleMl').checked,
          ml_buy_threshold: parseFloat(document.getElementById('inputMlBuyThreshold').value),
          ml_sell_threshold: parseFloat(document.getElementById('inputMlSellThreshold').value)
        };
        await apiRequest('/settings/ml', {
          method: 'POST',
          body: JSON.stringify(settings)
        });
        showNotification('‚úÖ ML –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
      } catch (error) {
        showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
      }
    });

    document.getElementById('btnSaveGeneralSettings').addEventListener('click', async () => {
      try {
        const settings = {
          trading_enabled: document.getElementById('toggleTrading').checked,
          demo_mode: document.getElementById('toggleDemo').checked,
          enable_price_updates: document.getElementById('togglePriceUpdates').checked,
          trailing_stop: document.getElementById('toggleTrailingStop').checked
        };
        await apiRequest('/settings/general', {
          method: 'POST',
          body: JSON.stringify(settings)
        });
        showNotification('‚úÖ –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
      } catch (error) {
        showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
      }
    });

    document.getElementById('btnRetrainModel').addEventListener('click', async () => {
      try {
        showNotification('‚è≥ –ü–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏...');
        await apiRequest('/ml/retrain', { method: 'POST' });
        showNotification('‚úÖ –ú–æ–¥–µ–ª—å –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∞');
      } catch (error) {
        showNotification('‚ùå –û—à–∏–±–∫–∞ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è');
      }
    });

    document.getElementById('btnResetStats').addEventListener('click', async () => {
      if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É?')) {
        try {
          await apiRequest('/analytics/reset', { method: 'POST' });
          showNotification('‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—á–∏—â–µ–Ω–∞');
          loadAnalytics();
        } catch (error) {
          showNotification('‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏');
        }
      }
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏
    async function closePosition(positionId) {
      if (confirm('–ó–∞–∫—Ä—ã—Ç—å –ø–æ–∑–∏—Ü–∏—é?')) {
        try {
          await apiRequest(`/position/${positionId}/close`, { method: 'POST' });
          showNotification('‚úÖ –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∞');
          loadPositions();
        } catch (error) {
          showNotification('‚ùå –û—à–∏–±–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏');
        }
      }
    }

    // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
    setInterval(() => {
      const activeSection = document.querySelector('.section.active');
      if (activeSection.id === 'dashboard') {
        loadDashboard();
      }
    }, 30000);

    // –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
    loadDashboard();
  </script>
</body>

</html>